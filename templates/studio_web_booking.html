<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="description" content="Book dance workshops at {{ studio_name }}. Discover and book classes from top choreographers in your area.">
    <meta name="keywords" content="dance workshop, {{ studio_name }}, dance classes, choreography, booking">
    <meta property="og:title" content="{{ studio_name }} - Workshops">
    <meta property="og:description" content="Book dance workshops at {{ studio_name }}. Discover and book classes from top choreographers.">
    <meta property="og:image" content="{{ studio.image_url if studio.image_url else '/static/assets/logo.png' }}">
    <meta property="og:url" content="{{ current_url }}">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <title>{{ studio_name }} - Dance Workshops | Nachna</title>
    <link rel="icon" type="image/png" href="/static/assets/logo.png">
    <link rel="apple-touch-icon" href="/static/assets/logo.png">
    
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
            --background-gradient: linear-gradient(135deg, #0A0A0F 0%, #1A1A2E 25%, #16213E 50%, #0F3460 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --accent-blue: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            --accent-green: linear-gradient(135deg, #10B981 0%, #059669 100%);
            --accent-purple: #8B5CF6;
            --accent-pink: linear-gradient(135deg, #FF006E 0%, #DC2626 100%);
            --instagram-gradient: linear-gradient(135deg, #E4405F 0%, #C13584 50%, #833AB4 100%);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --hover-shadow: 0 12px 40px rgba(0, 212, 255, 0.2);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            padding: 2rem;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #00D4FF;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* Main Container */
        .main-container {
            min-height: 100vh;
            position: relative;
        }
        
        /* Back Button */
        .back-button {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0.75rem;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            width: 44px;
            height: 44px;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }
        
        .back-button svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        /* Content Container */
        .content {
            padding-top: 6rem;
            padding-bottom: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }
        
        /* Studio Header Card */
        .studio-header {
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1.5px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: var(--card-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .studio-header-content {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
        }
        
        .studio-image-container {
            flex-shrink: 0;
            position: relative;
        }
        
        .studio-image {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            object-fit: cover;
            border: 2px solid var(--glass-border);
            background: var(--primary-gradient);
        }
        
        .studio-image-fallback {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--glass-border);
        }
        
        .studio-info {
            flex: 1;
            min-width: 0;
        }
        
        .studio-name-row {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .studio-name {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 1.2px;
            line-height: 1.3;
            flex: 1;
            min-width: 0;
            overflow-wrap: break-word;
        }
        
        .instagram-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--instagram-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .instagram-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(228, 64, 95, 0.4);
        }
        
        .instagram-icon svg {
            width: 18px;
            height: 18px;
            fill: white;
        }
        
        .studio-badges {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .studio-type-badge {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #00D4FF;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .share-button {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            padding: 0.5rem;
            color: #00D4FF;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-button:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: scale(1.05);
        }
        
        .share-button svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
        
        /* Section Headers */
        .section-header {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .section-icon-container {
            background: rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .section-icon {
            width: 20px;
            height: 20px;
            fill: #00D4FF;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #00D4FF;
            letter-spacing: 0.5px;
        }
        
        /* Day Sections */
        .day-section {
            background: var(--glass-bg);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(2px);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .day-header {
            background: var(--accent-blue);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .workshops-grid {
            display: grid;
            gap: 1rem;
        }
        
        /* Workshop Cards */
        .workshop-card {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .workshop-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .workshop-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .workshop-card:hover::before {
            opacity: 1;
        }
        
        .workshop-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            gap: 1rem;
        }
        
        .workshop-artist-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.3;
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .workshop-date-badge {
            background: var(--accent-blue);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .workshop-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .artist-avatars {
            flex-shrink: 0;
        }
        
        .single-avatar {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: var(--primary-gradient);
        }
        
        .avatar-fallback {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .multiple-avatars {
            position: relative;
            width: 66px;
            height: 42px;
        }
        
        .avatar-stack {
            position: absolute;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 2px solid white;
            object-fit: cover;
        }
        
        .avatar-stack:nth-child(1) { left: 0; }
        .avatar-stack:nth-child(2) { left: 20px; }
        .avatar-stack:nth-child(3) { left: 40px; }
        
        .avatar-count {
            position: absolute;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
        }
        
        .workshop-details {
            flex: 1;
            min-width: 0;
        }
        
        .workshop-song {
            color: #00D4FF;
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .workshop-info-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }
        
        .workshop-info-row svg {
            width: 14px;
            height: 14px;
            fill: var(--text-secondary);
            flex-shrink: 0;
        }
        
        .workshop-info-text {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .workshop-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }
        
        .action-buttons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .choreo-button, .artist-instagram-button {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--instagram-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            position: relative;
        }
        
        .choreo-button:hover, .artist-instagram-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(228, 64, 95, 0.4);
        }
        
        .choreo-button svg, .artist-instagram-button svg {
            width: 18px;
            height: 18px;
            fill: white;
        }
        
        .artist-instagram-button {
            background: linear-gradient(45deg, #E4405F, #833AB4);
        }
        
        .multiple-instagram-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #FF006E;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }
        
        .register-button {
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            min-width: 100px;
        }
        
        .register-button.nachna {
            background: var(--primary-gradient);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }
        
        .register-button.external {
            background: var(--accent-blue);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .register-button.disabled {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-tertiary);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .register-button:not(.disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .empty-message {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* Error State */
        .error-state {
            text-align: center;
            padding: 3rem 1.5rem;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 24px;
            border: 1px solid rgba(220, 38, 38, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #DC2626;
        }
        
        .error-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #DC2626;
            margin-bottom: 0.5rem;
        }
        
        .error-message {
            color: rgba(220, 38, 38, 0.8);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        .retry-button {
            background: #DC2626;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .retry-button:hover {
            background: #B91C1C;
            transform: translateY(-1px);
        }
        
        /* Share Modal */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .share-modal.show {
            display: flex;
        }
        
        .share-content {
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px);
            padding: 2rem;
            max-width: 400px;
            width: calc(100% - 2rem);
        }
        
        .share-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .share-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .share-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .share-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .share-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text-primary);
        }
        
        .share-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .share-option-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .share-option-text {
            font-weight: 600;
            flex: 1;
        }
        
        .share-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        /* MOBILE APP-LIKE DESIGN - EXACT MATCH TO FLUTTER APP */
        @media (max-width: 768px) {
            /* Reset base styles for mobile */
            body {
                font-size: 14px;
                line-height: 1.4;
                -webkit-text-size-adjust: 100%;
                padding: 0;
                margin: 0;
            }
            
            /* Back button - positioned like app's SafeArea */
            .back-button {
                position: fixed;
                top: calc(env(safe-area-inset-top, 0px) + 2rem);
                left: 1.5rem;
                width: 32px;
                height: 32px;
                padding: 8px;
                background: transparent;
                border: none;
                z-index: 1000;
            }
            
            .back-button svg {
                width: 16px;
                height: 16px;
                fill: white;
            }
            
            /* Main content - matches ListView padding in app */
            .content {
                padding-top: calc(env(safe-area-inset-top, 0px) + 5rem);
                padding-left: 1.5rem;
                padding-right: 1.5rem;
                padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1rem);
            }
            
            /* Studio Header - exact match to app's Container with decoration */
            .studio-header {
                margin-bottom: 1.5rem;
                padding: 1.5rem;
                border-radius: 20px;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
                border: 1.5px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
            }
            
            .studio-header-content {
                display: flex;
                align-items: flex-start;
                gap: 1.5rem;
            }
            
            /* Studio image - matches app's avatarSizeLarge */
            .studio-image, .studio-image-fallback {
                width: 80px;
                height: 80px;
                border-radius: 16px;
                border: 1.5px solid rgba(255, 255, 255, 0.2);
                flex-shrink: 0;
            }
            
            .studio-image-fallback {
                background: linear-gradient(135deg, rgba(0, 212, 255, 0.3) 0%, rgba(157, 78, 221, 0.3) 100%);
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .studio-info {
                flex: 1;
                min-width: 0;
            }
            
            /* Studio name row - matches app's Row with crossAxisAlignment.center */
            .studio-name-row {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .studio-name {
                font-size: 1.375rem;
                font-weight: 700;
                letter-spacing: 0.5px;
                color: white;
                line-height: 1.2;
                flex: 1;
                min-width: 0;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            }
            
            /* Instagram icon - matches app's small icon size */
            .instagram-icon {
                width: 20px;
                height: 20px;
                border-radius: 4px;
                background: var(--instagram-gradient);
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
                cursor: pointer;
            }
            
            .instagram-icon svg {
                width: 12px;
                height: 12px;
                fill: white;
            }
            
            /* Studio badges row - matches app's Row layout */
            .studio-badges {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-top: 0.5rem;
            }
            
            /* Dance Studio badge - matches app's Container with gradient */
            .studio-type-badge {
                display: flex;
                align-items: center;
                gap: 0.375rem;
                padding: 0.375rem 0.75rem;
                border-radius: 16px;
                background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(157, 78, 221, 0.2) 100%);
                border: 1px solid rgba(0, 212, 255, 0.3);
                font-size: 0.75rem;
                font-weight: 600;
                color: #00D4FF;
            }
            
            .studio-type-badge svg {
                width: 12px;
                height: 12px;
                fill: currentColor;
            }
            
            /* Share button - matches app's small GestureDetector */
            .share-button {
                width: 32px;
                height: 32px;
                padding: 0.375rem;
                border-radius: 8px;
                background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(157, 78, 221, 0.2) 100%);
                border: 1px solid rgba(0, 212, 255, 0.3);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                color: #00D4FF;
            }
            
            .share-button svg {
                width: 12px;
                height: 12px;
                fill: currentColor;
            }
            
            /* Section headers - app style */
            .section-header {
                padding: 1rem 1.25rem;
                margin-bottom: 1rem;
                border-radius: 16px;
            }
            
            .section-title {
                font-size: 1rem;
                font-weight: 700;
            }
            
            /* Day sections - compact like app */
            .day-section {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 16px;
            }
            
            .day-header {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
                font-weight: 700;
                border-radius: 10px;
                margin-bottom: 0.75rem;
            }
            
            .workshops-grid {
                gap: 0.75rem;
                grid-template-columns: 1fr;
            }
            
            /* Workshop cards - matches app's _buildWorkshopCard exactly */
            .workshop-card {
                margin-bottom: 1rem;
                border-radius: 16px;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%);
                border: 1px solid rgba(255, 255, 255, 0.15);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                backdrop-filter: blur(2px);
                overflow: hidden;
                padding: 1rem;
            }
            
            .workshop-card:hover {
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 100%);
                transform: none;
            }
            
            /* Workshop header - matches app's header Row with artist name and date */
            .workshop-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.75rem;
                gap: 0.75rem;
            }
            
            /* Artist name - matches app's main title style */
            .workshop-artist-name {
                font-size: 1rem;
                font-weight: 700;
                line-height: 1.2;
                color: white;
                flex: 1;
                min-width: 0;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            /* Date badge - matches app's blue gradient badge */
            .workshop-date-badge {
                font-size: 0.75rem;
                font-weight: 600;
                padding: 0.375rem 0.75rem;
                border-radius: 8px;
                background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
                color: white;
                flex-shrink: 0;
                white-space: nowrap;
                text-align: center;
                min-width: 90px;
            }
            
            /* Workshop content - matches app's main content Row */
            .workshop-content {
                display: flex;
                align-items: center;
                gap: 0;
                justify-content: space-between;
            }
            
            /* Action buttons container */
            .action-buttons {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                flex-shrink: 0;
            }
            
            /* Register button styling */
            .register-button {
                flex: 0 0 auto;
                padding: 0.75rem 1.25rem;
                font-size: 0.875rem;
                font-weight: 600;
                border-radius: 8px;
                border: none;
                color: white;
                cursor: pointer;
                min-width: 85px;
                text-align: center;
                text-decoration: none;
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
                transition: all 0.2s ease;
            }
            
            .register-button:hover:not(.disabled) {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            }
            
            .register-button.nachna {
                background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
                box-shadow: 0 2px 8px rgba(0, 212, 255, 0.3);
            }
            
            .register-button.disabled {
                background: rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.5);
                cursor: not-allowed;
                box-shadow: none;
            }
            
            /* Artist avatars - matches app's _buildArtistAvatars exactly */
            .artist-avatars {
                flex-shrink: 0;
            }
            
            .single-avatar, .avatar-fallback {
                width: 42px;
                height: 42px;
                border-radius: 10px;
                border: 2px solid rgba(255, 255, 255, 0.2);
                object-fit: cover;
            }
            
            .avatar-fallback {
                font-size: 1.1rem;
                font-weight: 700;
                background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* Multiple avatars - matches app's overlapping avatar system */
            .multiple-avatars {
                width: 66px;
                height: 42px;
                position: relative;
            }
            
            .avatar-stack {
                position: absolute;
                width: 36px;
                height: 36px;
                border-radius: 8px;
                border: 2px solid white;
                object-fit: cover;
                box-shadow: 0 2px 4px rgba(0, 212, 255, 0.2);
            }
            
            .avatar-stack:nth-child(1) { left: 0; z-index: 3; }
            .avatar-stack:nth-child(2) { left: 24px; z-index: 2; }
            .avatar-stack:nth-child(3) { left: 48px; z-index: 1; }
            
            .avatar-count {
                position: absolute;
                right: 0;
                width: 36px;
                height: 36px;
                border-radius: 8px;
                background: rgba(26, 26, 46, 0.9);
                border: 2px solid white;
                font-size: 0.7rem;
                font-weight: 700;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 4;
            }
            
            /* Workshop details - matches app's info column */
            .workshop-details {
                flex: 1;
                min-width: 0;
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }
            
            /* Song name - matches app's blue song title */
            .workshop-song {
                font-size: 0.8rem;
                font-weight: 600;
                color: #00D4FF;
                line-height: 1.2;
                margin-bottom: 0.125rem;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            /* Info rows - matches app's icon + text rows */
            .workshop-info-row {
                display: flex;
                align-items: center;
                gap: 0.375rem;
                margin-bottom: 0.125rem;
            }
            
            .workshop-info-row svg {
                width: 12px;
                height: 12px;
                flex-shrink: 0;
                opacity: 0.7;
            }
            
            .workshop-info-text {
                font-size: 0.75rem;
                font-weight: 500;
                color: rgba(255, 255, 255, 0.8);
                line-height: 1.2;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            
            .action-buttons {
                display: flex;
                align-items: center;
                gap: 0.375rem;
                flex-shrink: 0;
            }
            
            /* Action buttons - matches app's Instagram buttons */
            .artist-instagram-button {
                width: 36px;
                height: 36px;
                border-radius: 8px;
                background: var(--instagram-gradient);
                border: none;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                position: relative;
                flex-shrink: 0;
                box-shadow: 0 2px 6px rgba(225, 48, 108, 0.3);
                transition: all 0.2s ease;
            }
            
            .artist-instagram-button:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(225, 48, 108, 0.4);
            }
            
            .artist-instagram-button svg {
                width: 16px;
                height: 16px;
                fill: white;
            }
            
            .multiple-instagram-count {
                position: absolute;
                top: -4px;
                right: -4px;
                width: 18px;
                height: 18px;
                border-radius: 50%;
                background: #FF006E;
                color: white;
                font-size: 0.6rem;
                font-weight: 700;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 2px solid white;
            }
            
            
            /* Upcoming workshops grid - single column like app */
            #upcoming-content.workshops-grid {
                grid-template-columns: 1fr;
            }
            
            /* Empty/Error states - mobile sizing */
            .empty-state, .error-state {
                padding: 2rem 1.5rem;
                margin: 1rem 0;
                border-radius: 16px;
            }
            
            .empty-icon, .error-icon {
                font-size: 2.5rem;
            }
            
            .empty-title, .error-title {
                font-size: 1.125rem;
                font-weight: 700;
            }
            
            .empty-message, .error-message {
                font-size: 0.875rem;
                line-height: 1.4;
            }
            
            /* Share modal - full mobile experience */
            .share-modal {
                padding: 0;
                align-items: flex-end;
            }
            
            .share-content {
                margin: 0;
                width: 100%;
                max-width: none;
                border-radius: 20px 20px 0 0;
                padding: 1.5rem 1rem calc(env(safe-area-inset-bottom, 0px) + 1rem);
            }
            
            .share-title {
                font-size: 1.125rem;
                font-weight: 700;
            }
            
            .share-subtitle {
                font-size: 0.875rem;
            }
            
            .share-option {
                padding: 1rem;
                border-radius: 12px;
                font-size: 0.9rem;
            }
            
            .share-option-icon {
                width: 32px;
                height: 32px;
                border-radius: 8px;
            }
            
            .share-close {
                width: 28px;
                height: 28px;
                font-size: 1.25rem;
                font-weight: 700;
            }
        }
        
        /* iPhone SE and very small screens */
        @media (max-width: 375px) {
            .content {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            .studio-header {
                padding: 1.25rem;
            }
            
            .studio-name {
                font-size: 1.375rem;
            }
            
            .workshop-card {
                padding: 0.875rem;
            }
            
            .workshop-artist-name {
                font-size: 0.95rem;
            }
            
            .workshop-song {
                font-size: 0.8rem;
            }
            
            .register-button {
                font-size: 0.75rem;
                padding: 0.625rem 0.75rem;
            }
        }
        
        @media (min-width: 769px) {
            .content {
                padding-left: 2rem;
                padding-right: 2rem;
            }
            
            .workshops-grid {
                grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            }
        }
        
        @media (min-width: 1024px) {
            .workshops-grid {
                grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            }
        }
        
        /* Touch-friendly improvements for mobile */
        @media (max-width: 768px) {
            /* Better mobile scrolling */
            html {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            body {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            /* Prevent text selection on interactive elements */
            .workshop-card,
            .register-button,
            .choreo-button,
            .artist-instagram-button,
            .share-button,
            .back-button,
            .instagram-icon {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Touch feedback for buttons */
            .register-button:active {
                transform: scale(0.96);
                transition: transform 0.1s ease;
            }
            
            .choreo-button:active,
            .artist-instagram-button:active,
            .share-button:active,
            .instagram-icon:active {
                transform: scale(0.9);
                transition: transform 0.1s ease;
            }
            
            .back-button:active {
                transform: scale(0.85);
                transition: transform 0.1s ease;
            }
            
            .workshop-card:active {
                background: rgba(255, 255, 255, 0.15);
                transition: background 0.1s ease;
            }
            
            /* Remove desktop hover effects on mobile */
            .workshop-card:hover {
                transform: none !important;
            }
            
            .register-button:hover,
            .choreo-button:hover,
            .artist-instagram-button:hover {
                transform: none !important;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus States */
        .register-button:focus,
        .choreo-button:focus,
        .artist-instagram-button:focus,
        .back-button:focus,
        .share-button:focus,
        .instagram-icon:focus {
            outline: 2px solid #00D4FF;
            outline-offset: 2px;
        }
        
        /* Mobile Focus States */
        @media (max-width: 768px) {
            .register-button:focus,
            .choreo-button:focus,
            .artist-instagram-button:focus {
                outline: 3px solid #00D4FF;
                outline-offset: 1px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading studio details...</div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="main-container" class="main-container" style="display: none;">
        <!-- Back Button -->
        <a href="/" class="back-button" aria-label="Go back to home">
            <svg viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
            </svg>
        </a>
        
        <!-- Content -->
        <div class="content">
            <!-- Studio Header -->
            <div class="studio-header">
                <div class="studio-header-content">
                    <!-- Studio Image -->
                    <div class="studio-image-container">
                        <img id="studio-image" class="studio-image" src="" alt="Studio" loading="lazy" style="display: none;">
                        <div id="studio-image-fallback" class="studio-image-fallback">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
                                <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Studio Info -->
                    <div class="studio-info">
                        <div class="studio-name-row">
                            <h1 id="studio-name" class="studio-name">Loading...</h1>
                            <div id="instagram-icon" class="instagram-icon" style="display: none;">
                                <svg viewBox="0 0 24 24">
                                    <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3z"/>
                                </svg>
                            </div>
                        </div>
                        
                        <div class="studio-badges">
                            <div class="studio-type-badge">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                                </svg>
                                Dance Studio
                            </div>
                            <div class="share-button" onclick="openShareModal()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.50-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- This Week Section -->
            <div id="this-week-section" style="display: none;">
                <div class="section-header">
                    <div class="section-icon-container">
                        <svg class="section-icon" viewBox="0 0 24 24">
                            <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2-7h-3V2h-2v2H8V2H6v2H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H3V8h14v12z"/>
                        </svg>
                    </div>
                    <h2 class="section-title">This Week</h2>
                </div>
                <div id="this-week-content"></div>
            </div>
            
            <!-- Upcoming Section -->
            <div id="upcoming-section" style="display: none;">
                <div class="section-header">
                    <div class="section-icon-container">
                        <svg class="section-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <h2 class="section-title">Upcoming Workshops</h2>
                </div>
                <div id="upcoming-content" class="workshops-grid"></div>
            </div>
            
            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">🎭</div>
                <h3 class="empty-title">No Workshops Scheduled</h3>
                <p class="empty-message">This studio doesn't have any workshops scheduled at the moment. Check back later for new updates!</p>
            </div>
            
            <!-- Error State -->
            <div id="error-state" class="error-state" style="display: none;">
                <div class="error-icon">❌</div>
                <h3 class="error-title">Error Loading Workshops</h3>
                <p id="error-message" class="error-message">Failed to load workshops. Please check your internet connection and try again.</p>
                <button class="retry-button" onclick="loadData()">Try Again</button>
            </div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div id="share-modal" class="share-modal">
        <div class="share-content">
            <div class="share-close" onclick="closeShareModal()">×</div>
            <div class="share-header">
                <h3 class="share-title">Share Studio</h3>
                <p class="share-subtitle">Let others know about this amazing studio!</p>
            </div>
            <div class="share-options">
                <a href="#" id="whatsapp-share" class="share-option">
                    <div class="share-option-icon" style="background: #25D366;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.488"/>
                        </svg>
                    </div>
                    <span class="share-option-text">Share on WhatsApp</span>
                </a>
                
                <a href="#" id="instagram-share" class="share-option">
                    <div class="share-option-icon" style="background: linear-gradient(45deg, #E4405F, #C13584, #833AB4);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3z"/>
                        </svg>
                    </div>
                    <span class="share-option-text">Share to Instagram Story</span>
                </a>
                
                <a href="#" id="generic-share" class="share-option">
                    <div class="share-option-icon" style="background: var(--primary-gradient);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.50-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                        </svg>
                    </div>
                    <span class="share-option-text">More...</span>
                </a>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let studioData = null;
        let workshopsData = null;
        const studioId = "{{ studio_id }}";
        
        // DOM Elements
        const loadingOverlay = document.getElementById('loading-overlay');
        const mainContainer = document.getElementById('main-container');
        const studioImage = document.getElementById('studio-image');
        const studioImageFallback = document.getElementById('studio-image-fallback');
        const studioName = document.getElementById('studio-name');
        const instagramIcon = document.getElementById('instagram-icon');
        const thisWeekSection = document.getElementById('this-week-section');
        const upcomingSection = document.getElementById('upcoming-section');
        const thisWeekContent = document.getElementById('this-week-content');
        const upcomingContent = document.getElementById('upcoming-content');
        const emptyState = document.getElementById('empty-state');
        const errorState = document.getElementById('error-state');
        const errorMessage = document.getElementById('error-message');
        const shareModal = document.getElementById('share-modal');
        
        // Utility functions
        function toTitleCase(str) {
            if (!str) return '';
            return str.toLowerCase().split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        // Load image with gzip compression support
        async function loadImageWithCompression(imageElement, url) {
            console.log('🔄 loadImageWithCompression called with URL:', url);
            try {
                // Use fetch to load image with gzip compression
                console.log('📡 Making fetch request to:', url);
                const response = await fetch(url, {
                    headers: {
                        'Accept': 'image/*,*/*;q=0.8',
                        'Accept-Encoding': 'gzip, deflate, br'
                    }
                });
                console.log('📡 Fetch response status:', response.status, response.statusText);
                
                if (response.ok) {
                    console.log('✅ Response OK, processing blob...');
                    const blob = await response.blob();
                    console.log('✅ Blob created, size:', blob.size);
                    const imageUrl = URL.createObjectURL(blob);
                    console.log('✅ Object URL created:', imageUrl);
                    
                    // Store the original onload handler
                    const originalOnLoad = imageElement.onload;
                    
                    imageElement.src = imageUrl;
                    console.log('✅ Image src set to blob URL');
                    
                    // Set up cleanup and call original handler
                    imageElement.onload = function() {
                        console.log('✅ Image onload triggered via compression');
                        URL.revokeObjectURL(imageUrl);
                        if (originalOnLoad) {
                            originalOnLoad.call(this);
                        }
                    };
                    
                    // Also handle onerror to clean up
                    const originalOnError = imageElement.onerror;
                    imageElement.onerror = function() {
                        console.log('❌ Image onerror triggered via compression');
                        URL.revokeObjectURL(imageUrl);
                        if (originalOnError) {
                            originalOnError.call(this);
                        }
                    };
                    
                    return Promise.resolve();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.log(`Failed to load image with compression from ${url}:`, error);
                // Fallback to direct assignment - trigger onerror if it fails
                const originalOnError = imageElement.onerror;
                imageElement.onerror = function() {
                    console.log(`Direct image load also failed for ${url}`);
                    if (originalOnError) {
                        originalOnError.call(this);
                    }
                };
                imageElement.src = url;
                return Promise.reject(error);
            }
        }
        
        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ').map(word => word.charAt(0).toUpperCase()).join('').slice(0, 2);
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return 'TBA';
            return timeStr;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return 'TBA';
            return dateStr;
        }
        
        function showLoading() {
            loadingOverlay.style.display = 'flex';
            mainContainer.style.display = 'none';
        }
        
        function hideLoading() {
            loadingOverlay.style.display = 'none';
            mainContainer.style.display = 'block';
        }
        
        function showError(message) {
            hideLoading();
            errorMessage.textContent = message;
            errorState.style.display = 'block';
            thisWeekSection.style.display = 'none';
            upcomingSection.style.display = 'none';
            emptyState.style.display = 'none';
        }
        
        function showEmpty() {
            hideLoading();
            emptyState.style.display = 'block';
            thisWeekSection.style.display = 'none';
            upcomingSection.style.display = 'none';
            errorState.style.display = 'none';
        }
        
        // Load studio data
        async function loadStudioData() {
            try {
                // First try to get all studios and find the specific one
                const studiosResponse = await fetch(`/api/studios`);
                if (!studiosResponse.ok) {
                    throw new Error(`Failed to load studios (${studiosResponse.status})`);
                }
                
                const allStudios = await studiosResponse.json();
                console.log('All studios loaded:', allStudios.length, 'studios');
                console.log('Looking for studio ID:', studioId);
                console.log('Available studio IDs:', allStudios.map(s => s.id));
                
                studioData = allStudios.find(studio => studio.id === studioId);
                console.log('Found studio data:', studioData);
                
                if (!studioData) {
                    throw new Error(`Studio with ID ${studioId} not found`);
                }
                
                displayStudioInfo();
            } catch (error) {
                console.error('Error loading studio data:', error);
                throw error;
            }
        }
        
        // Load workshops data
        async function loadWorkshopsData() {
            try {
                const response = await fetch(`/api/workshops_by_studio/${studioId}`);
                if (!response.ok) {
                    throw new Error(`Failed to load workshops (${response.status})`);
                }
                workshopsData = await response.json();
                displayWorkshops();
            } catch (error) {
                console.error('Error loading workshops data:', error);
                throw error;
            }
        }
        
        // Display studio information
        function displayStudioInfo() {
            if (!studioData) return;
            
            // Debug: log studio data to see what we have
            console.log('Studio data:', studioData);
            
            // Update studio name
            studioName.textContent = toTitleCase(studioData.name);
            document.title = `${toTitleCase(studioData.name)} - Dance Workshops | Nachna`;
            
            // Handle studio image - Try centralized API first, fallback to proxy
            const studioIdForImage = studioData.id;
            console.log('Studio data for image loading:', studioData);
            console.log('Studio ID for image loading:', studioIdForImage);
            
            if (studioIdForImage) {
                console.log('Loading studio image from centralized API:', studioIdForImage);
                
                // Try the new centralized image API first
                const centralizedImageUrl = `https://nachna.com/api/image/studio/${studioIdForImage}`;
                console.log('Centralized image URL:', centralizedImageUrl);
                
                // Add visual feedback that we're trying to load the image
                studioImageFallback.style.background = 'linear-gradient(45deg, #ff006e, #00d4ff)';
                studioImageFallback.innerHTML = '<div style="color: white; font-size: 12px; text-align: center;">Loading...</div>';
                
                // Set up onload handler first
                studioImage.onload = function() {
                    console.log('✅ Studio image loaded successfully from centralized API');
                    studioImage.style.display = 'block';
                    studioImageFallback.style.display = 'none';
                };
                
                // Load image with gzip compression support
                console.log('🚀 About to call loadImageWithCompression');
                
                // Try simple direct loading first for debugging
                console.log('🧪 TESTING: Direct image load as fallback');
                const testImg = new Image();
                testImg.onload = () => console.log('🧪 DIRECT LOAD SUCCESS!');
                testImg.onerror = () => console.log('🧪 DIRECT LOAD FAILED!');
                testImg.src = centralizedImageUrl;
                
                loadImageWithCompression(studioImage, centralizedImageUrl).then(() => {
                    console.log('🎉 loadImageWithCompression completed successfully');
                }).catch(error => {
                    console.log('💥 loadImageWithCompression failed:', error);
                });
                
                studioImage.onerror = function() {
                    console.log('❌ Centralized image failed, trying proxy fallback...');
                    // Update visual feedback
                    studioImageFallback.style.background = 'linear-gradient(45deg, #ffaa00, #ff6600)';
                    studioImageFallback.innerHTML = '<div style="color: white; font-size: 12px; text-align: center;">Fallback...</div>';
                    
                    // Fallback to proxy approach (backward compatibility)
                    const imageUrl = studioData.image_url || studioData.imageUrl || studioData.img_url;
                    
                    if (imageUrl && imageUrl.trim()) {
                        const proxyImageUrl = `https://nachna.com/api/proxy-image/?url=${encodeURIComponent(imageUrl)}`;
                        console.log('Trying proxy fallback:', proxyImageUrl);
                        
                        studioImage.src = proxyImageUrl;
                        studioImage.onload = function() {
                            console.log('Studio image loaded successfully via proxy fallback');
                            studioImage.style.display = 'block';
                            studioImageFallback.style.display = 'none';
                        };
                        
                        studioImage.onerror = function() {
                            console.log('💥 Both centralized and proxy failed, showing fallback');
                            studioImage.style.display = 'none';
                            studioImageFallback.style.display = 'flex';
                            // Reset fallback to original style
                            studioImageFallback.style.background = '';
                            studioImageFallback.innerHTML = '<svg width="40" height="40" viewBox="0 0 24 24" fill="white"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></svg>';
                        };
                    } else {
                        console.log('No image URL for proxy fallback, showing fallback');
                        studioImage.style.display = 'none';
                        studioImageFallback.style.display = 'flex';
                    }
                };
            } else {
                console.log('No studio ID found, showing fallback');
                studioImage.style.display = 'none';
                studioImageFallback.style.display = 'flex';
            }
            
            // Handle Instagram icon
            if (studioData.instagram_link) {
                instagramIcon.style.display = 'flex';
                instagramIcon.onclick = function() {
                    window.open(studioData.instagram_link, '_blank', 'noopener,noreferrer');
                };
            } else {
                instagramIcon.style.display = 'none';
            }
        }
        
        // Create artist avatars using centralized image API
        function createArtistAvatars(workshop) {
            const artistIds = workshop.artist_id_list || [];
            const validArtistIds = artistIds.filter(id => id && id.trim());
            
            if (validArtistIds.length <= 1) {
                // Single avatar
                const container = document.createElement('div');
                container.className = 'artist-avatars';
                
                if (validArtistIds.length === 1) {
                    const img = document.createElement('img');
                    img.className = 'single-avatar';
                    img.src = `https://nachna.com/api/image/artist/${validArtistIds[0]}`;
                    img.alt = workshop.by || 'Artist';
                    img.onerror = function() {
                        // Fallback to proxy if centralized API fails
                        const artistImageUrls = workshop.artist_image_urls || [];
                        if (artistImageUrls[0]) {
                            img.src = `https://nachna.com/api/proxy-image/?url=${encodeURIComponent(artistImageUrls[0])}`;
                            img.onerror = function() {
                                const fallback = document.createElement('div');
                                fallback.className = 'avatar-fallback';
                                fallback.textContent = getInitials(workshop.by);
                                container.replaceChild(fallback, img);
                            };
                        } else {
                            const fallback = document.createElement('div');
                            fallback.className = 'avatar-fallback';
                            fallback.textContent = getInitials(workshop.by);
                            container.replaceChild(fallback, img);
                        }
                    };
                    container.appendChild(img);
                } else {
                    const fallback = document.createElement('div');
                    fallback.className = 'avatar-fallback';
                    fallback.textContent = getInitials(workshop.by);
                    container.appendChild(fallback);
                }
                
                return container;
            } else {
                // Multiple avatars
                const container = document.createElement('div');
                container.className = 'artist-avatars';
                
                const multipleContainer = document.createElement('div');
                multipleContainer.className = 'multiple-avatars';
                
                const maxAvatars = Math.min(validArtistIds.length, 3);
                for (let i = 0; i < maxAvatars; i++) {
                    const img = document.createElement('img');
                    img.className = 'avatar-stack';
                    img.src = `https://nachna.com/api/image/artist/${validArtistIds[i]}`;
                    img.alt = `Artist ${i + 1}`;
                    img.onerror = function() {
                        // Fallback to proxy if centralized API fails
                        const artistImageUrls = workshop.artist_image_urls || [];
                        if (artistImageUrls[i]) {
                            img.src = `https://nachna.com/api/proxy-image/?url=${encodeURIComponent(artistImageUrls[i])}`;
                            img.onerror = function() {
                                const fallback = document.createElement('div');
                                fallback.className = 'avatar-stack avatar-fallback';
                                fallback.style.width = '36px';
                                fallback.style.height = '36px';
                                fallback.style.fontSize = '0.8rem';
                                fallback.textContent = getInitials(workshop.by);
                                multipleContainer.replaceChild(fallback, img);
                            };
                        } else {
                            const fallback = document.createElement('div');
                            fallback.className = 'avatar-stack avatar-fallback';
                            fallback.style.width = '36px';
                            fallback.style.height = '36px';
                            fallback.style.fontSize = '0.8rem';
                            fallback.textContent = getInitials(workshop.by);
                            multipleContainer.replaceChild(fallback, img);
                        }
                    };
                    multipleContainer.appendChild(img);
                }
                
                // Show count if more than 3 artists
                if (validArtistIds.length > 3) {
                    const countDiv = document.createElement('div');
                    countDiv.className = 'avatar-count';
                    countDiv.textContent = `+${validArtistIds.length - 2}`;
                    multipleContainer.appendChild(countDiv);
                }
                
                container.appendChild(multipleContainer);
                return container;
            }
        }
        
        // Create workshop card
        function createWorkshopCard(workshop) {
            const card = document.createElement('div');
            card.className = 'workshop-card';
            
            // Header: Artist name and date badge
            const header = document.createElement('div');
            header.className = 'workshop-header';
            
            const artistName = document.createElement('div');
            artistName.className = 'workshop-artist-name';
            artistName.textContent = toTitleCase(workshop.by || 'Dance Workshop');
            
            const dateBadge = document.createElement('div');
            dateBadge.className = 'workshop-date-badge';
            dateBadge.textContent = formatDate(workshop.date);
            
            header.appendChild(artistName);
            header.appendChild(dateBadge);
            
            // Content row: Avatar + Studio info + Action buttons
            const content = document.createElement('div');
            content.className = 'workshop-content';
            
            // Artist avatar
            const avatars = createArtistAvatars(workshop);
            content.appendChild(avatars);
            
            // Studio building icon (matches the screenshot)
            const studioIcon = document.createElement('div');
            studioIcon.style.cssText = `
                width: 20px;
                height: 20px;
                margin-left: 8px;
                margin-right: 8px;
                opacity: 0.7;
                flex-shrink: 0;
            `;
            studioIcon.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="rgba(255,255,255,0.7)">
                    <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                </svg>
            `;
            content.appendChild(studioIcon);
            
            // Check mark icon (matches the screenshot)
            const checkIcon = document.createElement('div');
            checkIcon.style.cssText = `
                width: 20px;
                height: 20px;
                margin-right: 12px;
                opacity: 0.7;
                flex-shrink: 0;
            `;
            checkIcon.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="rgba(255,255,255,0.7)">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            `;
            content.appendChild(checkIcon);
            
            // Action buttons container
            const actionButtons = document.createElement('div');
            actionButtons.className = 'action-buttons';
            
            // Artist Instagram button
            const artistInstagramLinks = workshop.artist_instagram_links || [];
            const validInstagramLinks = artistInstagramLinks.filter(link => link && link.trim());
            
            if (validInstagramLinks.length > 0) {
                const artistInstagramBtn = document.createElement('button');
                artistInstagramBtn.className = 'artist-instagram-button';
                artistInstagramBtn.title = 'View artist on Instagram';
                artistInstagramBtn.onclick = function() {
                    if (validInstagramLinks.length === 1) {
                        trackArtistInstagramClick(validInstagramLinks[0], workshop);
                        window.open(validInstagramLinks[0], '_blank', 'noopener,noreferrer');
                    } else {
                        showArtistInstagramModal(validInstagramLinks, workshop);
                    }
                };
                artistInstagramBtn.innerHTML = `
                    <svg viewBox="0 0 24 24">
                        <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3z"/>
                    </svg>
                `;
                actionButtons.appendChild(artistInstagramBtn);
            }
            
            content.appendChild(actionButtons);
            
            // Register button (takes remaining space)
            const registerBtn = document.createElement('button');
            if (workshop.payment_link && workshop.payment_link.trim()) {
                registerBtn.className = `register-button ${workshop.payment_link_type?.toLowerCase() === 'nachna' ? 'nachna' : 'external'}`;
                registerBtn.textContent = 'Register';
                registerBtn.onclick = function() {
                    trackWorkshopClick(workshop);
                    window.open(workshop.payment_link, '_blank', 'noopener,noreferrer');
                };
            } else {
                registerBtn.className = 'register-button disabled';
                registerBtn.textContent = 'Register';
                registerBtn.disabled = true;
            }
            
            content.appendChild(registerBtn);
            
            card.appendChild(header);
            card.appendChild(content);
            
            return card;
        }
        
        // Display workshops
        function displayWorkshops() {
            if (!workshopsData) return;
            
            const hasThisWeek = workshopsData.this_week && workshopsData.this_week.length > 0;
            const hasUpcoming = workshopsData.post_this_week && workshopsData.post_this_week.length > 0;
            
            if (!hasThisWeek && !hasUpcoming) {
                showEmpty();
                return;
            }
            
            hideLoading();
            errorState.style.display = 'none';
            emptyState.style.display = 'none';
            
            // Display this week workshops
            if (hasThisWeek) {
                thisWeekSection.style.display = 'block';
                thisWeekContent.innerHTML = '';
                
                workshopsData.this_week.forEach(daySchedule => {
                    const daySection = document.createElement('div');
                    daySection.className = 'day-section';
                    
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'day-header';
                    dayHeader.textContent = daySchedule.day;
                    daySection.appendChild(dayHeader);
                    
                    const workshopsGrid = document.createElement('div');
                    workshopsGrid.className = 'workshops-grid';
                    
                    daySchedule.workshops.forEach(workshop => {
                        const workshopCard = createWorkshopCard(workshop);
                        workshopsGrid.appendChild(workshopCard);
                    });
                    
                    daySection.appendChild(workshopsGrid);
                    thisWeekContent.appendChild(daySection);
                });
            }
            
            // Display upcoming workshops
            if (hasUpcoming) {
                upcomingSection.style.display = 'block';
                upcomingContent.innerHTML = '';
                
                workshopsData.post_this_week.forEach(workshop => {
                    const workshopCard = createWorkshopCard(workshop);
                    upcomingContent.appendChild(workshopCard);
                });
            }
        }
        
        // Analytics tracking
        function trackWorkshopClick(workshop) {
            console.log('Workshop clicked:', {
                workshop_id: workshop.uuid,
                song_name: workshop.song,
                artist_name: workshop.by,
                studio_id: studioId,
                studio_name: studioData?.name
            });
            
            // Send analytics event if available
            if (typeof gtag !== 'undefined') {
                gtag('event', 'workshop_book_click', {
                    workshop_id: workshop.uuid,
                    song_name: workshop.song,
                    artist_name: workshop.by,
                    studio_id: studioId,
                    studio_name: studioData?.name
                });
            }
        }
        
        function trackArtistInstagramClick(instagramUrl, workshop) {
            console.log('Artist Instagram clicked:', {
                instagram_url: instagramUrl,
                workshop_id: workshop.uuid,
                artist_name: workshop.by,
                studio_id: studioId,
                studio_name: studioData?.name
            });
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'artist_instagram_click', {
                    instagram_url: instagramUrl,
                    workshop_id: workshop.uuid,
                    artist_name: workshop.by,
                    studio_id: studioId,
                    studio_name: studioData?.name
                });
            }
        }
        
        function trackChoreoClick(choreoUrl, workshop) {
            console.log('Choreography video clicked:', {
                choreo_url: choreoUrl,
                workshop_id: workshop.uuid,
                song_name: workshop.song,
                artist_name: workshop.by,
                studio_id: studioId,
                studio_name: studioData?.name
            });
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'choreo_video_click', {
                    choreo_url: choreoUrl,
                    workshop_id: workshop.uuid,
                    song_name: workshop.song,
                    artist_name: workshop.by,
                    studio_id: studioId,
                    studio_name: studioData?.name
                });
            }
        }
        
        // Share functionality
        function openShareModal() {
            if (!studioData) return;
            
            const shareUrl = window.location.href;
            const shareText = `Check out ${toTitleCase(studioData.name)} on Nachna! 💃🕺\n\nDiscover amazing dance workshops at this studio.\n\nView workshops: ${shareUrl}\n\nDon't have Nachna yet? Download it here:\nhttps://apps.apple.com/in/app/nachna/id6746702742`;
            
            // Update share links
            const whatsappShare = document.getElementById('whatsapp-share');
            const instagramShare = document.getElementById('instagram-share');
            const genericShare = document.getElementById('generic-share');
            
            whatsappShare.href = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
            instagramShare.onclick = function(e) {
                e.preventDefault();
                // Instagram story sharing would require the mobile app
                if (navigator.share) {
                    navigator.share({
                        title: `${toTitleCase(studioData.name)} - Nachna`,
                        text: shareText,
                        url: shareUrl
                    });
                } else {
                    copyToClipboard(shareText);
                }
            };
            genericShare.onclick = function(e) {
                e.preventDefault();
                if (navigator.share) {
                    navigator.share({
                        title: `${toTitleCase(studioData.name)} - Nachna`,
                        text: shareText,
                        url: shareUrl
                    });
                } else {
                    copyToClipboard(shareText);
                }
            };
            
            shareModal.classList.add('show');
        }
        
        function closeShareModal() {
            shareModal.classList.remove('show');
        }
        
        // Artist Instagram modal functionality
        function showArtistInstagramModal(instagramLinks, workshop) {
            const artistNames = (workshop.by || 'Artists').split(' X ');
            
            // Create modal content dynamically
            const modalContent = `
                <div class="share-content">
                    <div class="share-close" onclick="closeArtistInstagramModal()">×</div>
                    <div class="share-header">
                        <h3 class="share-title">Artist Instagram</h3>
                        <p class="share-subtitle">Choose which artist to view on Instagram</p>
                    </div>
                    <div class="share-options" id="artist-instagram-options">
                        ${instagramLinks.map((link, index) => `
                            <a href="${link}" target="_blank" rel="noopener,noreferrer" class="share-option" 
                               onclick="trackArtistInstagramClick('${link}', ${JSON.stringify(workshop).replace(/"/g, '&quot;')}); closeArtistInstagramModal();">
                                <div class="share-option-icon" style="background: linear-gradient(45deg, #E4405F, #833AB4);">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                        <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3z"/>
                                    </svg>
                                </div>
                                <span class="share-option-text">${artistNames[index] || `Artist ${index + 1}`}</span>
                            </a>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Create or reuse artist Instagram modal
            let artistInstagramModal = document.getElementById('artist-instagram-modal');
            if (!artistInstagramModal) {
                artistInstagramModal = document.createElement('div');
                artistInstagramModal.id = 'artist-instagram-modal';
                artistInstagramModal.className = 'share-modal';
                document.body.appendChild(artistInstagramModal);
                
                // Close modal when clicking outside
                artistInstagramModal.addEventListener('click', function(e) {
                    if (e.target === artistInstagramModal) {
                        closeArtistInstagramModal();
                    }
                });
            }
            
            artistInstagramModal.innerHTML = modalContent;
            artistInstagramModal.classList.add('show');
        }
        
        function closeArtistInstagramModal() {
            const artistInstagramModal = document.getElementById('artist-instagram-modal');
            if (artistInstagramModal) {
                artistInstagramModal.classList.remove('show');
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Link copied to clipboard!');
            });
        }
        
        // Main load function
        async function loadData() {
            showLoading();
            errorState.style.display = 'none';
            
            try {
                await Promise.all([
                    loadStudioData(),
                    loadWorkshopsData()
                ]);
            } catch (error) {
                console.error('Error loading data:', error);
                showError(error.message || 'Failed to load studio data. Please try again.');
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
        
        // Close modal when clicking outside
        shareModal.addEventListener('click', function(e) {
            if (e.target === shareModal) {
                closeShareModal();
            }
        });
        
        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                const now = new Date().getTime();
                const lastLoad = parseInt(localStorage.getItem('lastStudioLoad') || '0');
                if (now - lastLoad > 5 * 60 * 1000) { // 5 minutes
                    loadData();
                    localStorage.setItem('lastStudioLoad', now.toString());
                }
            }
        });
        
        // Set initial load timestamp
        localStorage.setItem('lastStudioLoad', new Date().getTime().toString());
        
        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                if (shareModal.classList.contains('show')) {
                    closeShareModal();
                }
                const artistInstagramModal = document.getElementById('artist-instagram-modal');
                if (artistInstagramModal && artistInstagramModal.classList.contains('show')) {
                    closeArtistInstagramModal();
                }
            }
        });
    </script>
</body>
</html>
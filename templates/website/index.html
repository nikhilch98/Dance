<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Browse dance workshops by studios, artists, and more" />
  <meta name="theme-color" content="#f8f9fa" />
  <title>Dance Workshops - Browse By Category</title>

  <!-- Enhanced Critical CSS -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --primary-color: #007bff;
      --accent-color: #0056b3;
      --secondary-color: #6c757d;
      --background-color: #121824;
      --card-background: #ffffff;
      --text-color: #f0f4f8;
      --shadow-color: rgba(0, 0, 0, 0.25);
      --transition-speed: 0.3s;
      --border-radius: 12px;
      --spacing-unit: 24px;
    }

    /* Base reset & typography */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--background-color);
      background-image: linear-gradient(135deg, #121824 0%, #1a2436 50%, #121830 100%);
      color: var(--text-color);
      margin: 0;
      padding: var(--spacing-unit);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      margin-bottom: var(--spacing-unit);
      text-align: center;
    }

    h1 {
      font-weight: 600;
      font-size: 2.25rem;
      color: #ffffff;
      margin: 0;
      text-shadow: 0 2px 6px rgba(0, 123, 255, 0.2);
    }

    main {
      flex-grow: 1;
      width: 100%;
      max-width: 1200px;
    }

    /* Tab Navigation */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: var(--spacing-unit);
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 8px;
    }

    .tabs button {
      padding: 12px 24px;
      border: none;
      background: transparent;
      font-weight: 600;
      font-size: 1.125rem;
      cursor: pointer;
      color: var(--secondary-color);
      border-bottom: 3px solid transparent;
      transition: all var(--transition-speed);
    }

    .tabs button[aria-selected="true"],
    .tabs button:hover {
      color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .tabs button:focus-visible {
      outline: 3px solid var(--accent-color);
      outline-offset: 4px;
    }

    /* Tab Panels */
    .tab-panel {
      display: none;
      animation: fadeIn 0.5s ease forwards;
    }

    .tab-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: var(--spacing-unit);
      width: 100%;
    }

    .card {
      background-color: var(--card-background);
      border-radius: var(--border-radius);
      box-shadow: 0 8px 16px var(--shadow-color);
      overflow: hidden;
      cursor: pointer;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      will-change: transform;
      padding-bottom: 1.5em;
      position: relative;
    }

    .card:hover,
    .card:focus-visible {
      transform: translateY(-6px) scale(1.04);
      box-shadow: 0 12px 24px rgba(0, 123, 255, 0.3);
      outline: none;
      z-index: 4;
    }

    .card:focus-visible {
      outline: 3px solid var(--accent-color);
      outline-offset: 4px;
      z-index: 5;
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      pointer-events: none;
      transition: transform var(--transition-speed);
    }

    .card h3 {
      margin: 12px 10px 0 10px;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary-color);
    }

    .instagram-link {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color var(--transition-speed);
      z-index: 5;
    }

    .instagram-link:hover,
    .instagram-link:focus-visible {
      background: rgba(0, 0, 0, 0.85);
      outline: none;
    }

    .instagram-link img {
      width: 24px !important;
      height: 24px !important;
      margin: 0 !important;
      user-select: none;
      pointer-events: none;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      padding: var(--spacing-unit) 0;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--background-color);
      padding: var(--spacing-unit);
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color var(--transition-speed);
    }

    .close-btn:hover,
    .close-btn:focus-visible {
      background: #a71d2a;
      outline: none;
    }

    .workshop-container {
      margin-top: 20px;
    }

    .workshop-item {
      background: rgba(30, 40, 58, 0.8);
      padding: 20px;
      margin: 16px 0;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      font-size: 1.05rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .workshop-item p {
      margin: 10px 0;
      color: #f0f4f8;
    }
    
    .modal-content h2 {
      font-size: 2rem;
      color: #4d9eff;
      margin-bottom: 15px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 15px;
      font-weight: 700;
    }

    .register-link {
      display: inline-block;
      background: var(--primary-color);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 700;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
    }

    .register-link:hover,
    .register-link:focus-visible {
      background: var(--accent-color);
      outline: none;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
    }

    /* Table container for Apple Vision Pro look */
    #workshops-section {
      padding: 20px;
      position: relative;
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
    }

    /* Controls button styling */
    .controls .btn {
      background: rgba(30, 40, 58, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
      font-weight: 500;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      border-radius: 8px;
      padding: 10px 20px;
    }

    .controls .btn:hover {
      background: rgba(0, 123, 255, 0.3);
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
      border-color: rgba(0, 123, 255, 0.3);
    }

    /* Workshop table */
    .workshop-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 0; /* Add horizontal spacing between cells */
      background-color: rgba(30, 40, 58, 0.6);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      overflow: hidden;
      font-size: 0.95rem;
      border: none;
      transform: translateY(0);
      transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
      margin: 20px 0;
      table-layout: fixed; /* Use fixed layout for better column control */
    }
    
    /* Add global cell styling */
    .workshop-table td {
      overflow: hidden;
      text-overflow: ellipsis;
      vertical-align: middle;
      padding: 16px 10px; /* Add padding to all cells */
    }
    
    /* Add more spacing between columns */
    .workshop-table th,
    .workshop-table td {
      border-right: 3px solid rgba(18, 28, 46, 0.9); /* Add visual separator */
    }
    
    /* Remove border from last column */
    .workshop-table th:last-child,
    .workshop-table td:last-child {
      border-right: none;
    }
    
    /* Date column */
    .workshop-table th:nth-child(1),
    .workshop-table td:nth-child(1) {
      width: 160px;
    }
    
    /* Time column */
    .workshop-table th:nth-child(2),
    .workshop-table td:nth-child(2) {
      width: 120px;
    }
    
    /* Instructor column */
    .workshop-table th:nth-child(3),
    .workshop-table td:nth-child(3) {
      width: 18%;
    }
    
    /* Song column */
    .workshop-table th:nth-child(4),
    .workshop-table td:nth-child(4) {
      width: 16%;
      white-space: normal; /* Allow text wrapping */
    }
    
    /* Pricing column - needs more space */
    .workshop-table th:nth-child(5),
    .workshop-table td:nth-child(5) {
      width: 20%;
      white-space: normal; /* Allow text wrapping */
      word-break: normal;
      line-height: 1.2;
    }
    
    /* Studio column */
    .workshop-table th:nth-child(6),
    .workshop-table td:nth-child(6) {
      width: 16%;
    }
    
    /* Register column */
    .workshop-table th:nth-child(7),
    .workshop-table td:nth-child(7) {
      width: 110px;
      text-align: center;
    }
    
    /* Workshop table container to enable horizontal scrolling if needed */
    .workshop-table-container {
      width: 100%;
      overflow-x: auto;
      padding-bottom: 5px; /* Add some padding to avoid scrollbar covering content */
    }

    /* Floating effect on page load */
    .workshop-table:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.15);
    }

    .workshop-table thead {
      background-color: rgba(0, 123, 255, 0.2);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid rgba(0, 123, 255, 0.3);
    }

    .workshop-table tbody tr {
      transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .workshop-table tbody tr:hover {
      background-color: rgba(0, 123, 255, 0.25) !important;
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      transform: scale(1.008);
      box-shadow: 0 4px 20px rgba(0, 123, 255, 0.25);
    }

    .workshop-table tbody tr:nth-child(even) {
      background-color: rgba(30, 40, 58, 0.8);
    }

    .workshop-table tbody tr:nth-child(odd) {
      background-color: rgba(20, 30, 48, 0.8);
    }

    .workshop-table th,
    .workshop-table td {
      padding: 16px 12px;
      text-align: left;
      border-bottom: none;
      vertical-align: middle;
      color: rgba(255, 255, 255, 0.95);
      border-right: 1px solid rgba(255, 255, 255, 0.08);
      position: relative;
    }
    
    .workshop-table th:last-child,
    .workshop-table td:last-child {
      border-right: none;
      padding: 10px;
    }

    .workshop-table th:nth-child(1),
    .workshop-table td:nth-child(1) {
      width: auto;  /* Date - content-based width */
      min-width: 150px;  /* Increase from 100px to 150px */
      white-space: nowrap;
    }

    .workshop-table th:nth-child(2),
    .workshop-table td:nth-child(2) {
      width: auto;  /* Time - content-based width */
      min-width: 150px;  /* Increase from 100px to 150px */
      white-space: nowrap;
    }

    .workshop-table th:nth-child(3),
    .workshop-table td:nth-child(3) {
      width: 20%;  /* Instructor */
      padding-right: 25px;
      word-break: break-word;
      white-space: normal;
      max-height: 50px;
      line-height: 1.4;
    }

    .workshop-instructor-link {
      color: #4d9eff;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 95%;
    }
    
    .instructor-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: calc(100% - 30px);
    }
    
    .instructor-instagram {
      flex-shrink: 0;
      width: 22px;
      height: 22px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      border: 1px solid rgba(255, 255, 255, 0.15);
      margin-left: 8px;
    }
    
    .instructor-instagram:hover {
      background: rgba(0, 123, 255, 0.4);
      transform: translateY(-2px);
    }
    
    .instructor-instagram img {
      width: 14px;
      height: 14px;
      filter: brightness(1);
    }

    .workshop-table th:nth-child(4),
    .workshop-table td:nth-child(4) {
      min-width: 150px; /* Song column */
      color: rgba(255, 255, 255, 0.95);
    }

    .workshop-table th {
      font-weight: 600;
      color: #4d9eff;
      position: relative;
      letter-spacing: 0.7px;
      text-transform: uppercase;
      font-size: 0.8rem;
      padding-bottom: 20px;
    }

    .sort-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: rgba(255, 255, 255, 0.8);
      padding: 0 4px;
      font-size: 0.9rem;
      user-select: none;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      vertical-align: middle;
    }

    .sort-btn:hover,
    .sort-btn:focus-visible {
      color: #4d9eff;
      outline: none;
      transform: translateY(-1px);
    }

    /* Cell content styling */
    .workshop-table td:nth-child(5) {
      overflow: visible;
      white-space: normal;
      font-weight: 500;
      color: rgba(66, 214, 96, 1);
    }

    /* Add a subtle highlight for registration options */
    .workshop-table th:nth-child(7),
    .workshop-table td:nth-child(7) {
      min-width: 120px;
      white-space: nowrap;
      text-align: center;
      border-left: none;
      background: transparent;
    }

    .workshop-table .register-link {
      display: inline-block;
      width: 90%;
      text-align: center;
      padding: 8px 5px;
      margin: 0 auto;
    }

    /* Loading and Error */
    .loading, .error {
      text-align: center;
      padding: var(--spacing-unit);
      font-size: 1.1rem;
      font-weight: 300;
      color: rgba(255, 255, 255, 0.7);
      letter-spacing: 0.3px;
    }

    .error {
      color: rgba(255, 82, 82, 0.9);
    }

    .controls {
      display: flex;
      justify-content: flex-start;
      gap: var(--spacing-unit);
      flex-wrap: wrap;
      margin-bottom: var(--spacing-unit);
    }

    /* Accessibility */
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0,0,0,0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 10px !important;
      }

      /* Complete mobile table redesign */
      .workshop-table, 
      .workshop-table tbody, 
      .workshop-table tr,
    .workshop-table td {
        display: block !important;
        width: 100% !important;
      }
      
      .workshop-table {
        border: none !important;
        background: transparent !important;
        box-shadow: none !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      .workshop-table thead {
        display: none !important;
      }
      
      /* Individual workshop cards */
      .workshop-table tr {
        margin-bottom: 15px !important;
        padding: 15px !important;
        background: rgba(25, 35, 50, 0.9) !important;
        border-radius: 10px !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        position: relative !important;
      }
      
      /* Force each field to display properly */
      .workshop-table td {
        display: block !important;
        width: 100% !important;
        padding: 7px 0 !important;
        margin: 0 !important;
        border: none !important;
        text-align: left !important;
        position: relative !important;
        color: #ffffff !important;
        overflow: visible !important; /* Ensure content isn't cut off */
        white-space: normal !important; /* Allow text to wrap */
      }
      
      /* Clear label styling */
      .workshop-table td:before {
        content: attr(data-label) !important;
        width: 80px !important;
        min-width: 80px !important;
        display: inline-block !important;
        font-weight: 600 !important;
        color: #4d9eff !important;
        margin-right: 10px !important;
      }
      
      /* Make sure content is visible */
      .workshop-table td span,
      .workshop-table td a:not(.register-link) {
        display: inline-block !important;
        width: calc(100% - 90px) !important;
        vertical-align: top !important;
        word-break: break-word !important;
      }
      
      /* Fix date/time display */
      .workshop-table td[data-label="Date"] {
        padding-top: 0 !important;
        font-weight: 600 !important;
        font-size: 1.05rem !important; /* Slightly larger font for better visibility */
      }
      
      .workshop-table td[data-label="Time"] {
        padding-top: 0 !important;
        font-size: 1.05rem !important; /* Slightly larger font for better visibility */
      }
      
      /* Fix Register button */
    .workshop-table td:last-child {
        padding-top: 15px !important;
        margin-top: 5px !important;
        border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
      }
      
      .workshop-table td:last-child:before {
        display: none !important;
      }
      
      .workshop-table .register-link {
        display: inline-block !important;
        width: auto !important;
        min-width: 120px !important;
        padding: 10px 20px !important;
        margin: 5px 0 !important;
        background: rgba(0, 123, 255, 0.6) !important;
        color: white !important;
        text-align: center !important;
        font-weight: 600 !important;
        border-radius: 6px !important;
      }
      
      /* Fix Instagram icon */
      .workshop-instructor-link {
        display: inline-block !important;
        width: calc(100% - 90px) !important;
        vertical-align: top !important;
      }
      
      .instructor-name {
        display: inline !important;
        vertical-align: middle !important;
      }
      
      .instructor-instagram {
        display: inline-block !important;
        vertical-align: middle !important;
        margin-left: 5px !important;
      }
      
      /* Adjust card spacing for studios/artists */
      .cards-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
      }
      
      /* Fix pricing display to be consistent with other fields */
      .workshop-table td[data-label="Pricing"] {
        display: flex !important;
        align-items: flex-start !important;
        padding-top: 10px !important;
        padding-bottom: 10px !important;
        flex-wrap: nowrap !important;
        width: 100% !important;
      }
      
      .workshop-table td[data-label="Pricing"]:before {
        display: inline-block !important;
        min-width: 80px !important;
        width: 80px !important;
        margin-right: 10px !important;
        flex-shrink: 0 !important;
      }
      
      .workshop-table td[data-label="Pricing"] span {
        display: inline-block !important;
        flex: 1 !important;
        width: auto !important;
        max-width: 85% !important;
        vertical-align: top !important;
        word-wrap: normal !important;
        word-break: normal !important;
        white-space: normal !important;
        text-align: left !important;
        line-height: 1.4 !important;
        font-size: 0.95rem !important;
        letter-spacing: -0.2px !important;
      }
    }

    /* Extra small screens */
    @media (max-width: 480px) {
      .cards-grid {
        grid-template-columns: 1fr !important;
      }
    }

    /* Touch device optimizations */
    @media (hover: none) {
      .card:hover {
        transform: none;
        box-shadow: 0 8px 16px var(--shadow-color);
      }

      .card:active {
        transform: scale(0.98);
      }
    }

    /* Print styles */
    @media print {
      .tabs, .controls, .sort-btn, .close-btn {
        display: none;
      }
      
      .card {
        break-inside: avoid;
        box-shadow: none;
      }
      
      .workshop-table {
        box-shadow: none;
      }
      
      .workshop-table th,
      .workshop-table td {
        border: 1px solid #aaa;
      }
    }

    /* Studio Cards Specific Styling */
    #studios-panel .cards-grid {
      gap: 30px;
      padding: 10px;
    }
    
    #studios-panel .card {
      background: rgba(30, 40, 58, 0.6);
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
      height: 280px;
      position: relative;
    }
    
    #studios-panel .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 123, 255, 0.3);
      border-color: rgba(0, 123, 255, 0.3);
    }
    
    #studios-panel .card img {
      height: 200px;
      object-fit: cover;
      transition: transform 0.5s;
    }
    
    #studios-panel .card:hover img {
      transform: scale(1.05);
    }
    
    #studios-panel .card h3 {
      color: #ffffff;
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 12px;
      padding: 0 15px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      transition: color 0.3s;
      position: absolute;
      bottom: 15px;
      left: 0;
      right: 0;
      text-align: center;
    }
    
    #studios-panel .card:hover h3 {
      color: #4d9eff;
    }
    
    #studios-panel .instagram-link {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 8px;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.2s;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    #studios-panel .instagram-link:hover {
      background: rgba(0, 123, 255, 0.6);
      transform: translateY(-3px);
    }
    
    #studios-panel .instagram-link img {
      width: 20px !important;
      height: 20px !important;
      filter: brightness(1);
    }

    /* Artists Cards Specific Styling - matching studios styling */
    #artists-panel .cards-grid {
      gap: 30px;
      padding: 10px;
    }
    
    #artists-panel .card {
      background: rgba(30, 40, 58, 0.6);
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
      height: 280px;
      position: relative;
    }
    
    #artists-panel .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 123, 255, 0.3);
      border-color: rgba(0, 123, 255, 0.3);
    }
    
    #artists-panel .card img {
      height: 200px;
      object-fit: cover;
      transition: transform 0.5s;
    }
    
    #artists-panel .card:hover img {
      transform: scale(1.05);
    }
    
    #artists-panel .card h3 {
      color: #ffffff;
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 12px;
      padding: 0 15px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      transition: color 0.3s;
      position: absolute;
      bottom: 15px;
      left: 0;
      right: 0;
      text-align: center;
    }
    
    #artists-panel .card:hover h3 {
      color: #4d9eff;
    }
    
    #artists-panel .instagram-link {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 8px;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.2s;
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    #artists-panel .instagram-link:hover {
      background: rgba(0, 123, 255, 0.6);
      transform: translateY(-3px);
    }
    
    #artists-panel .instagram-link img {
      width: 20px !important;
      height: 20px !important;
      filter: brightness(1);
    }

    /* Add styling for the section headings and no-workshops message */
    .section-heading {
      color: #4d9eff;
      font-size: 1.5rem;
      margin: 0;
      padding: 15px 20px;
      border-radius: 10px 10px 0 0;
      background: rgba(18, 28, 46, 0.9);
      border-left: 4px solid #4d9eff;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }
    
    .workshop-section {
      margin-bottom: 40px;
      background: rgba(20, 30, 48, 0.5);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .workshop-section:last-child {
      margin-bottom: 0;
    }
    
    .section-divider {
      height: 4px;
      background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(77,158,255,0.5) 50%, rgba(0,0,0,0) 100%);
      margin: 30px 0;
      border-radius: 2px;
    }
    
    .workshop-items-container {
      padding: 15px;
    }
    
    .no-workshops {
      color: rgba(255, 255, 255, 0.7);
      font-style: italic;
      padding: 20px;
      text-align: center;
      background: rgba(0, 0, 0, 0.2);
      margin: 15px;
      border-radius: 8px;
    }

    /* Coming soon text styling */
    .coming-soon {
      color: rgba(255, 255, 255, 0.6);
      font-style: italic;
      font-size: 0.9rem;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px 10px;
      border-radius: 4px;
    }

    /* Cell content styling specific to All Workshops section */
    .workshop-table {
      table-layout: fixed;
      width: 100%;
      border-spacing: 0;
      border-collapse: separate;
      padding: 0;
      margin: 0;
    }
    
    /* Common cell styling for all cells to prevent overflow */
    .workshop-table td {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 14px 10px;
    }
    
    .workshop-table th:nth-child(1),
    .workshop-table td:nth-child(1) {
      width: auto;  /* Date - content-based width */
      min-width: 150px;  /* Increase from 100px to 150px */
      white-space: nowrap;
    }
    
    .workshop-table th:nth-child(2),
    .workshop-table td:nth-child(2) {
      width: auto;  /* Time - content-based width */
      min-width: 150px;  /* Increase from 100px to 150px */
      white-space: nowrap;
    }
    
    .workshop-table th:nth-child(3),
    .workshop-table td:nth-child(3) {
      width: 20%;  /* Instructor */
      padding-right: 25px;
      word-break: break-word;
      white-space: normal;
      max-height: 50px;
      line-height: 1.4;
    }
    
    .workshop-table th:nth-child(4),
    .workshop-table td:nth-child(4) {
      width: 14%;  /* Song */
      white-space: normal;
      line-height: 1.3;
    }
    
    .workshop-table th:nth-child(5),
    .workshop-table td:nth-child(5) {
      width: 14%;  /* Pricing */
      white-space: normal;
      line-height: 1.3;
    }
    
    .workshop-table th:nth-child(6),
    .workshop-table td:nth-child(6) {
      width: 16%;  /* Studio */
    }
    
    .workshop-table th:nth-child(7),
    .workshop-table td:nth-child(7) {
      width: 16%;  /* Register */
      padding: 8px;
    }

    /* Search bar for artists */
    .search-container {
      margin-bottom: 20px;
      width: 100%;
      max-width: 500px;
      margin: 0 auto 20px;
    }
    
    .search-bar {
      width: 100%;
      padding: 12px 20px;
      border-radius: 30px;
      border: none;
      background: rgba(30, 40, 58, 0.8);
      color: #fff;
      font-size: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .search-bar:focus {
      outline: none;
      box-shadow: 0 4px 20px rgba(0, 123, 255, 0.4);
      border-color: rgba(0, 123, 255, 0.4);
    }
    
    .search-bar::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    @media (max-width: 768px) {
      .search-container {
        max-width: 100%;
        padding: 0 10px;
      }
    }

    /* Day header for studio workshops */
    .day-header {
      background: rgba(0, 123, 255, 0.2);
      color: white;
      padding: 12px 15px;
      margin: 25px 0 15px 0;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      border-left: 3px solid #4d9eff;
    }
    
    .day-header:first-of-type {
      margin-top: 0;
    }
    
    .day-date {
      color: #4d9eff;
      font-weight: 500;
    }
    
    @media (max-width: 768px) {
      .day-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
        padding: 10px 15px;
      }
    }

    /* Additional styles for filters */
    .filter-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      width: 100%;
      align-items: flex-start;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      min-width: 200px;
      flex: 1;
    }
    
    .filter-label {
      font-size: 0.9rem;
      color: #4d9eff;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    .filter-select {
      background: rgba(30, 40, 58, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      width: 100%;
      font-size: 0.95rem;
      cursor: pointer;
      outline: none;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 16px;
      height: 42px;
      box-sizing: border-box;
    }
    
    .filter-select:focus {
      border-color: #4d9eff;
      box-shadow: 0 0 0 2px rgba(77, 158, 255, 0.3);
    }
    
    .filter-select option {
      background-color: #1a2436;
    }
    
    .multiselect-dropdown {
      position: relative;
      width: 100%;
    }
    
    .multiselect-dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: rgba(30, 40, 58, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      z-index: 100;
      max-height: 250px;
      overflow-y: auto;
      display: none;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      margin-top: 5px;
    }
    
    .multiselect-dropdown-list.active {
      display: block;
    }
    
    .multiselect-option {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .multiselect-option:hover {
      background: rgba(77, 158, 255, 0.2);
    }
    
    .multiselect-option input {
      margin: 0;
    }
    
    .multiselect-option label {
      cursor: pointer;
      flex: 1;
    }
    
    .multiselect-trigger {
      background: rgba(30, 40, 58, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      width: 100%;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 42px;
      box-sizing: border-box;
    }
    
    .multiselect-trigger:hover {
      background: rgba(30, 40, 58, 0.9);
    }
    
    .multiselect-trigger:after {
      content: "▼";
      font-size: 0.8rem;
      opacity: 0.8;
    }
    
    .active-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .filter-pill {
      background: rgba(30, 40, 85, 0.7);
      border: 1px solid rgba(77, 158, 255, 0.3);
      color: white;
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .remove-filter {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      line-height: 0.8;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      opacity: 0.7;
    }
    
    .remove-filter:hover {
      background: rgba(255, 255, 255, 0.2);
      opacity: 1;
    }
    
    .filters-summary {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 15px;
      margin-bottom: 15px;
      padding-left: 5px;
    }
    
    .reset-filters-btn {
      background: rgba(30, 40, 58, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      min-width: 140px;
      justify-content: center;
      height: 42px;
      box-sizing: border-box;
      align-self: flex-end;
      margin-bottom: 0;
    }
    
    .reset-filters-btn:hover {
      background: rgba(255, 82, 82, 0.3);
      border-color: rgba(255, 82, 82, 0.5);
    }
    
    .reset-filters-btn:before {
      content: "↺";
      font-size: 1.1rem;
    }
    
    @media (max-width: 768px) {
      .filter-container {
        flex-direction: column;
        gap: 10px;
      }
      
      .filter-group, .filter-select, .multiselect-trigger {
        max-width: 100%;
        width: 100%;
      }
      
      .multiselect-dropdown-list {
        max-width: 100%;
      }
      
      .reset-filters-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Dance Workshops</h1>
  </header>

  <nav class="tabs" role="tablist" aria-label="Main Sections">
    <button role="tab" aria-selected="true" aria-controls="studios-panel" id="tab-studios" tabindex="0">Studios</button>
    <button role="tab" aria-selected="false" aria-controls="artists-panel" id="tab-artists" tabindex="-1">Artists</button>
    <button role="tab" aria-selected="false" aria-controls="workshops-panel" id="tab-workshops" tabindex="-1">All Workshops</button>
  </nav>

  <main>
    <section id="studios-panel" class="tab-panel active" role="tabpanel" aria-labelledby="tab-studios" tabindex="0" aria-hidden="false">
      <div class="cards-grid" id="studio-cards" aria-live="polite" aria-atomic="true">
        <p class="loading">Loading studios...</p>
      </div>
    </section>

    <section id="artists-panel" class="tab-panel" role="tabpanel" aria-labelledby="tab-artists" tabindex="0" aria-hidden="true">
      <div class="search-container">
        <input type="text" id="artist-search" class="search-bar" placeholder="Search artists...">
      </div>
      <div class="cards-grid" id="artist-cards" aria-live="polite" aria-atomic="true">
        <p class="loading">Loading artists...</p>
      </div>
    </section>

    <section id="workshops-panel" class="tab-panel" role="tabpanel" aria-labelledby="tab-workshops" tabindex="0" aria-hidden="true">
      <div id="workshops-section" aria-live="polite" aria-atomic="true">
        <div class="controls">
          <div class="filter-container">
            <div class="filter-group">
              <label class="filter-label">Date</label>
              <div class="multiselect-dropdown" id="date-filter">
                <div class="multiselect-trigger" tabindex="0">Select Dates</div>
                <div class="multiselect-dropdown-list" id="date-options">
                  <!-- Will be populated dynamically -->
                </div>
                <div class="active-filters" id="active-date-filters"></div>
              </div>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">Instructor</label>
              <div class="multiselect-dropdown" id="instructor-filter">
                <div class="multiselect-trigger" tabindex="0">Select Instructors</div>
                <div class="multiselect-dropdown-list" id="instructor-options">
                  <!-- Will be populated dynamically -->
                </div>
                <div class="active-filters" id="active-instructor-filters"></div>
              </div>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">Studio</label>
              <div class="multiselect-dropdown" id="studio-filter">
                <div class="multiselect-trigger" tabindex="0">Select Studios</div>
                <div class="multiselect-dropdown-list" id="studio-options">
                  <!-- Will be populated dynamically -->
                </div>
                <div class="active-filters" id="active-studio-filters"></div>
              </div>
            </div>
          </div>
          
          <button class="reset-filters-btn" id="reset-filters" type="button" aria-label="Reset all filters">Reset Filters</button>
          
          <div class="filters-summary" id="filters-summary"></div>
        </div>
        <div class="workshop-table-container">
          <table id="workshop-table" class="workshop-table" role="grid" aria-describedby="workshops-desc">
            <thead>
              <tr>
                <th scope="col">Date <button class="sort-btn" data-column="date" aria-label="Sort by Date">▲</button></th>
                <th scope="col">Time <button class="sort-btn" data-column="time" aria-label="Sort by Time">▲</button></th>
                <th scope="col">Instructor <button class="sort-btn" data-column="by" aria-label="Sort by Instructor">▲</button></th>
                <th scope="col">Song <button class="sort-btn" data-column="song" aria-label="Sort by Song">▲</button></th>
                <th scope="col">Pricing</th>
                <th scope="col">Studio <button class="sort-btn" data-column="studio_id" aria-label="Sort by Studio">▲</button></th>
                <th scope="col">Register</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="workshop-error" class="error" style="display:none;"></div>
      </div>
    </section>
  </main>

  <div class="modal" id="detail-modal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal-content">
      <button class="close-btn" aria-label="Close modal">&times;</button>
      <div id="detail-content"></div>
    </div>
  </div>

  <script>
    // Global variables
    let studioData = [];
    let artistData = [];
    let workshopData = [];
    let currentSort = { column: 'date', direction: 'asc' };
    let activeFilters = {
      dates: [],
      instructors: [],
      studios: []
    };

    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', () => {
      const tabButtons = document.querySelectorAll('nav.tabs button');
      const sections = document.querySelectorAll('section.tab-panel');
      
      // Tab switching
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Update ARIA attributes
          tabButtons.forEach(btn => {
            btn.setAttribute('aria-selected', 'false');
            btn.tabIndex = -1;
          });
          button.setAttribute('aria-selected', 'true');
          button.tabIndex = 0;
          
          // Get target section id from aria-controls
          const targetId = button.getAttribute('aria-controls');
          
          // Show the target section
          sections.forEach(section => {
            section.classList.remove('active');
            section.setAttribute('aria-hidden', 'true');
          });
          
          const targetSection = document.getElementById(targetId);
          targetSection.classList.add('active');
          targetSection.setAttribute('aria-hidden', 'false');
          
          // Load data if needed
          if (targetId === 'studios-panel' && studioData.length === 0) {
            loadStudios();
          } else if (targetId === 'artists-panel' && artistData.length === 0) {
            loadArtists();
          } else if (targetId === 'workshops-panel' && workshopData.length === 0) {
            loadWorkshops();
        }
      });
    });

      // Initialize first tab data load
      loadStudios();
      
      // Close modal when clicking the background
      const modal = document.getElementById('detail-modal');
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeModal();
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
        }
      });
      
      // Setup sort buttons
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const column = btn.dataset.column;
          sortTable(column);
        });
      });
      
      // Reset filters button
      document.getElementById('reset-filters').addEventListener('click', function(e) {
        e.preventDefault();
        // Reset filter values
        activeFilters = {
          dates: [],
          instructors: [],
          studios: []
        };
        
        // Reset UI
        document.querySelectorAll('#date-options input[type="checkbox"]').forEach(checkbox => {
          checkbox.checked = false;
        });
        
        document.querySelectorAll('#instructor-options input[type="checkbox"], #studio-options input[type="checkbox"]').forEach(checkbox => {
          checkbox.checked = false;
        });
        
        document.getElementById('active-date-filters').innerHTML = '';
        document.getElementById('active-instructor-filters').innerHTML = '';
        document.getElementById('active-studio-filters').innerHTML = '';
        
        // Reset sort
        currentSort = { column: 'date', direction: 'asc' };
        
        // Update UI
        updateFiltersSummary();
        renderWorkshopsTable();
        
        // Update sort buttons
        document.querySelectorAll('.sort-btn').forEach(btn => {
          btn.textContent = btn.dataset.column === 'date' ? '↑' : '▲';
        });
      });
    });
    
    // Modal functions
    function openModal(type, id) {
    const modal = document.getElementById('detail-modal');
      const content = document.getElementById('detail-content');
      let title, endpoint;
      
      if (type === 'studio') {
        const studio = studioData.find(s => s.id === id);
        if (!studio) return;
        title = studio.name;
        endpoint = `/api/workshops_by_studio/${id}?version=v2`;
      } else if (type === 'artist') {
        const artist = artistData.find(a => a.id === id);
        if (!artist) return;
        title = artist.name;
        endpoint = `/api/workshops_by_artist/${id}?version=v2`;
      } else {
        return;
      }
      
      content.innerHTML = `
        <h2>${title}</h2>
        <div class="workshop-container">
          <p class="loading">Loading workshops...</p>
        </div>
      `;
      
      // Fetch workshops
      fetch(endpoint)
        .then(response => {
          if (!response.ok) throw new Error('Failed to load workshops');
          return response.json();
        })
        .then(data => {
          const workshopContainer = content.querySelector('.workshop-container');
          
          if (type === 'studio') {
            // Handle CategorizedWorkshopResponse for studios
            const allWorkshops = [];
            let hasThisWeekWorkshops = false;
            let hasPostThisWeekWorkshops = false;
            
            workshopContainer.innerHTML = '';
            
            // Create section for "This Weekend"
            const thisWeekendSection = document.createElement('div');
            thisWeekendSection.className = 'workshop-section';
            
            // Add heading for "This Weekend" section
            const weekendHeading = document.createElement('h3');
            weekendHeading.textContent = 'This Weekend';
            weekendHeading.className = 'section-heading';
            thisWeekendSection.appendChild(weekendHeading);
            
            // Create container for workshop items
            const thisWeekendItems = document.createElement('div');
            thisWeekendItems.className = 'workshop-items-container';
            thisWeekendSection.appendChild(thisWeekendItems);
            
            // Process this_week workshops
            if (data.this_week && data.this_week.length > 0) {
              // Group workshops by day
              const workshopsByDay = {};
              
              data.this_week.forEach(day => {
                if (day.workshops && day.workshops.length > 0) {
                  hasThisWeekWorkshops = true;
                  
                  // Extract day name from the date (e.g., "27th Apr (Sun)" -> "Sunday")
                  const dateStr = day.workshops[0].date;
                  let dayName = "Day";
                  
                  // Try to extract day name from format like "27th Apr (Sun)"
                  const dayMatch = dateStr.match(/\(([^)]+)\)/);
                  if (dayMatch && dayMatch[1]) {
                    const shortDay = dayMatch[1];
                    // Convert abbreviated day to full name
                    const dayMap = {
                      'Mon': 'Monday',
                      'Tue': 'Tuesday', 
                      'Wed': 'Wednesday',
                      'Thu': 'Thursday',
                      'Fri': 'Friday',
                      'Sat': 'Saturday',
                      'Sun': 'Sunday'
                    };
                    dayName = dayMap[shortDay] || shortDay;
                  }
                  
                  // Create day header
                  const dayHeader = document.createElement('div');
                  dayHeader.className = 'day-header';
                  dayHeader.innerHTML = `
                    <span>${dayName}</span>
                    <span class="day-date">${dateStr}</span>
                  `;
                  thisWeekendItems.appendChild(dayHeader);
                  
                  // Sort day's workshops by timestamp_epoch before adding them
                  const sortedDayWorkshops = [...day.workshops].sort((a, b) => {
                    return (a.timestamp_epoch || 0) - (b.timestamp_epoch || 0);
                  });
                  
                  // Add workshops for this day
                  sortedDayWorkshops.forEach(workshop => {
                    const workshopItem = document.createElement('div');
                    workshopItem.className = 'workshop-item';
                    workshopItem.innerHTML = `
                      <p><strong>${workshop.time}</strong></p>
                      <p>Instructor: ${workshop.artist || 'TBA'}</p>
                      <p>Song: ${workshop.song || 'TBA'}</p>
                      <p>Pricing: ${workshop.pricing_info || 'TBA'}</p>
                      ${workshop.payment_link ? 
                        `<a href="${workshop.payment_link}" target="_blank" class="register-link">Register</a>` : 
                        ''}
                    `;
                    thisWeekendItems.appendChild(workshopItem);
                  });
                }
              });
            }
            
            // Add message if no workshops this weekend
            if (!hasThisWeekWorkshops) {
              const noWorkshops = document.createElement('p');
              noWorkshops.className = 'no-workshops';
              noWorkshops.textContent = 'No workshops scheduled for this weekend.';
              thisWeekendItems.appendChild(noWorkshops);
            }
            
            // Add "This Weekend" section to container
            workshopContainer.appendChild(thisWeekendSection);
            
            // Add a visual divider between sections
            const divider = document.createElement('div');
            divider.className = 'section-divider';
            workshopContainer.appendChild(divider);
            
            // Create section for "Upcoming Workshops"
            const upcomingSection = document.createElement('div');
            upcomingSection.className = 'workshop-section';
            
            // Add heading for "Upcoming Workshops" section
            const upcomingHeading = document.createElement('h3');
            upcomingHeading.textContent = 'Upcoming Workshops';
            upcomingHeading.className = 'section-heading';
            upcomingSection.appendChild(upcomingHeading);
            
            // Create container for upcoming workshop items
            const upcomingItems = document.createElement('div');
            upcomingItems.className = 'workshop-items-container';
            upcomingSection.appendChild(upcomingItems);
            
            // Group post_this_week workshops by date
            const upcomingWorkshopsByDate = {};
            
            // Process post_this_week workshops
            if (data.post_this_week && data.post_this_week.length > 0) {
              // Post this weekend workshops sorted by timestamp
              data.post_this_week.forEach(workshop => {
                hasPostThisWeekWorkshops = true;
                
                // Group by date
                if (!upcomingWorkshopsByDate[workshop.date]) {
                  upcomingWorkshopsByDate[workshop.date] = [];
                }
                upcomingWorkshopsByDate[workshop.date].push(workshop);
              });
              
              // Display workshops grouped by date
              Object.keys(upcomingWorkshopsByDate).forEach(dateStr => {
                // Try to extract day name
                let dayName = "Day";
                const dayMatch = dateStr.match(/\(([^)]+)\)/);
                if (dayMatch && dayMatch[1]) {
                  const shortDay = dayMatch[1];
                  // Convert abbreviated day to full name
                  const dayMap = {
                    'Mon': 'Monday',
                    'Tue': 'Tuesday', 
                    'Wed': 'Wednesday',
                    'Thu': 'Thursday',
                    'Fri': 'Friday',
                    'Sat': 'Saturday',
                    'Sun': 'Sunday'
                  };
                  dayName = dayMap[shortDay] || shortDay;
                }
                
                // Create day header
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `
                  <span>${dayName}</span>
                  <span class="day-date">${dateStr}</span>
                `;
                upcomingItems.appendChild(dayHeader);
                
                // Sort workshops for this date by timestamp_epoch
                const sortedWorkshops = upcomingWorkshopsByDate[dateStr].sort((a, b) => {
                  return (a.timestamp_epoch || 0) - (b.timestamp_epoch || 0);
                });
                
                // Add workshops for this date
                sortedWorkshops.forEach(workshop => {
                  const workshopItem = document.createElement('div');
                  workshopItem.className = 'workshop-item';
                  workshopItem.innerHTML = `
                    <p><strong>${workshop.time}</strong></p>
                    <p>Instructor: ${workshop.artist || 'TBA'}</p>
                    <p>Song: ${workshop.song || 'TBA'}</p>
                    <p>Pricing: ${workshop.pricing_info || 'TBA'}</p>
                    ${workshop.payment_link ? 
                      `<a href="${workshop.payment_link}" target="_blank" class="register-link">Register</a>` : 
                      ''}
                  `;
                  upcomingItems.appendChild(workshopItem);
                });
              });
            }
            
            // Add message if no upcoming workshops
            if (!hasPostThisWeekWorkshops) {
              const noWorkshops = document.createElement('p');
              noWorkshops.className = 'no-workshops';
              noWorkshops.textContent = 'No upcoming workshops scheduled at this time.';
              upcomingItems.appendChild(noWorkshops);
            }
            
            // Add "Upcoming Workshops" section to container
            workshopContainer.appendChild(upcomingSection);
            
            // Empty state handling if no workshops at all
            if (!hasThisWeekWorkshops && !hasPostThisWeekWorkshops) {
              workshopContainer.innerHTML = `<p class="no-workshops">No workshops currently scheduled.</p>`;
            }
          } else if (type === 'artist') {
            // Handle List<WorkshopSession> for artists
            if (data.length > 0) {
              // Sort by timestamp_epoch
              const sortedWorkshops = [...data].sort((a, b) => {
                return (a.timestamp_epoch || 0) - (b.timestamp_epoch || 0);
              });
              
              workshopContainer.innerHTML = '';
              sortedWorkshops.forEach(workshop => {
                workshopContainer.innerHTML += `
                  <div class="workshop-item">
                    <p><strong>${workshop.date} at ${workshop.time}</strong></p>
                    <p>Studio: ${workshop.studio_id || 'TBA'}</p>
                    <p>Song: ${workshop.song || 'TBA'}</p>
                    <p>Pricing: ${workshop.pricing_info || 'TBA'}</p>
                    ${workshop.payment_link ? 
                      `<a href="${workshop.payment_link}" target="_blank" class="register-link">Register</a>` : 
                      ''}
                  </div>
                `;
              });
            } else {
              workshopContainer.innerHTML = `<p>No upcoming workshops found.</p>`;
            }
          }
        })
        .catch(error => {
          console.error('Error loading workshops:', error);
          content.querySelector('.workshop-container').innerHTML = 
            '<div class="error">Failed to load workshops. Please try again later.</div>';
        });
      
      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      
      // Focus close button for accessibility
      setTimeout(() => {
        modal.querySelector('.close-btn').focus();
      }, 100);
    }
    
    function closeModal() {
      const modal = document.getElementById('detail-modal');
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
    
    // Data loading functions
    function loadStudios() {
      const studioCards = document.getElementById('studio-cards');
      studioCards.innerHTML = '<p class="loading">Loading studios...</p>';
      
    fetch('/api/studios?version=v2')
        .then(response => {
          if (!response.ok) throw new Error('Failed to load studios');
          return response.json();
        })
      .then(data => {
          studioData = data || [];
          
          if (studioData.length > 0) {
            // Preload first few images for faster initial display
            const imagesToPreload = studioData.slice(0, 6).map(studio => {
              return studio.image_url 
                ? `/proxy-image/?url=${encodeURIComponent(studio.image_url)}` 
                : '/static/assets/studios/studios.png';
            });
            
            // Start preloading immediately
            imagesToPreload.forEach(url => {
              const img = new Image();
              img.src = url;
            });
            
            // Prepare all cards HTML first, then append at once for better performance
            const cardsHTML = studioData.map((studio, index) => {
              const imageUrl = studio.image_url 
                ? `/proxy-image/?url=${encodeURIComponent(studio.image_url)}` 
                : '/static/assets/studios/studios.png';
                
              const fetchPriority = index < 6 ? 'fetchpriority="high"' : '';
              
              return `
                <div class="card" tabindex="0" role="button" 
                     aria-label="${studio.name} studio details"
                     data-studio-id="${studio.id}">
                  <img src="${imageUrl}" 
                       alt="${studio.name}" 
                       ${fetchPriority}
                       loading="lazy"
                       onerror="this.src='/static/assets/studios/studios.png'">
                  <h3>${studio.name}</h3>
                  ${studio.instagram_link ? `
                    <a href="${studio.instagram_link}" 
                       target="_blank" 
                       class="instagram-link"
                       aria-label="Visit ${studio.name} on Instagram"
                       onclick="event.stopPropagation()">
                      <img src="/static/assets/instagram-icon.png" alt="Instagram">
                    </a>
                  ` : ''}
                </div>
              `;
            }).join('');
            
            studioCards.innerHTML = cardsHTML;
            
            // Add event listeners after HTML is inserted
            document.querySelectorAll('#studio-cards .card').forEach(card => {
              const studioId = card.dataset.studioId;
              card.addEventListener('click', () => openModal('studio', studioId));
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                  e.preventDefault();
                  openModal('studio', studioId);
                }
              });
            });
          } else {
            studioCards.innerHTML = '<p class="error">No studios found.</p>';
          }
        })
        .catch(error => {
          console.error('Error loading studios:', error);
          studioCards.innerHTML = '<p class="error">Failed to load studios. Please try again later.</p>';
        });
    }
    
    function loadArtists() {
      const artistCards = document.getElementById('artist-cards');
      artistCards.innerHTML = '<p class="loading">Loading artists...</p>';
      
    fetch('/api/artists?version=v2')
        .then(response => {
          if (!response.ok) throw new Error('Failed to load artists');
          return response.json();
        })
      .then(data => {
          artistData = data || [];
          renderArtists(artistData);
          
          // Set up search functionality
          const searchInput = document.getElementById('artist-search');
          searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const filteredArtists = artistData.filter(artist => {
              if (!searchTerm) return true; // Show all artists when search is empty
              
              // Split artist name into words and check if any word starts with the search term
              const words = artist.name.toLowerCase().split(/\s+/);
              return words.some(word => word.startsWith(searchTerm)) || 
                     // Also match multiple word searches
                     searchTerm.split(/\s+/).every(term => 
                       words.some(word => word.startsWith(term))
                     );
            });
            renderArtists(filteredArtists);
        });
      })
        .catch(error => {
          console.error('Error loading artists:', error);
          artistCards.innerHTML = '<p class="error">Failed to load artists. Please try again later.</p>';
        });
    }
    
    function renderArtists(artists) {
      const artistCards = document.getElementById('artist-cards');
      
      if (artists.length > 0) {
        // Preload first few images for faster initial display
        const imagesToPreload = artists.slice(0, 6).map(artist => {
          return artist.image_url 
            ? `/proxy-image/?url=${encodeURIComponent(artist.image_url)}` 
            : '/static/assets/artists/artists.png';
        });
        
        // Start preloading immediately
        imagesToPreload.forEach(url => {
          const img = new Image();
          img.src = url;
        });
        
        // Prepare all cards HTML first, then append at once for better performance
        const cardsHTML = artists.map((artist, index) => {
          const imageUrl = artist.image_url 
            ? `/proxy-image/?url=${encodeURIComponent(artist.image_url)}` 
            : '/static/assets/artists/artists.png';
          
          const fetchPriority = index < 6 ? 'fetchpriority="high"' : '';
          
          return `
            <div class="card" tabindex="0" role="button" 
                 aria-label="${artist.name} artist details"
                 data-artist-id="${artist.id}">
              <img src="${imageUrl}" 
                   alt="${artist.name}" 
                   ${fetchPriority}
                   loading="lazy"
                   onerror="this.src='/static/assets/artists/artists.png'">
              <h3>${artist.name}</h3>
              ${artist.instagram_link ? `
                <a href="${artist.instagram_link}" 
                   target="_blank" 
                   class="instagram-link"
                   aria-label="Visit ${artist.name} on Instagram"
                   onclick="event.stopPropagation()">
                  <img src="/static/assets/instagram-icon.png" alt="Instagram">
                </a>
              ` : ''}
            </div>
          `;
        }).join('');
        
        artistCards.innerHTML = cardsHTML;
        
        // Add event listeners after HTML is inserted
        document.querySelectorAll('#artist-cards .card').forEach(card => {
          const artistId = card.dataset.artistId;
          card.addEventListener('click', () => openModal('artist', artistId));
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              openModal('artist', artistId);
            }
          });
        });
      } else {
        artistCards.innerHTML = '<p class="error">No artists found matching your search.</p>';
      }
    }
    
    function loadWorkshops() {
      const tableBody = document.querySelector('#workshop-table tbody');
      tableBody.innerHTML = '<tr><td colspan="7"><p class="loading">Loading workshops...</p></td></tr>';
      
      fetch('/api/workshops?version=v2')
        .then(response => {
          if (!response.ok) throw new Error('Failed to load workshops');
          return response.json();
        })
        .then(data => {
          // Each workshop is now a single session, so just use the data as-is
          workshopData = data.map(workshop => ({
            date: workshop.date,
            time: workshop.time,
            instructor: workshop.by || 'TBA',
            instructor_instagram: workshop.instagram_link || null,
            song: workshop.song || 'TBA',
            pricing: workshop.pricing_info || 'TBA',
            studio: workshop.studio_name || workshop.studio_id || 'TBA',
            registration_link: workshop.payment_link || null,
            timestamp_epoch: workshop.timestamp_epoch || 0
          }));
          
          // Initialize filters once data is loaded
          initializeFilters();
          
          renderWorkshopsTable();
          
          // Update sort arrows
          document.querySelectorAll('.sort-btn').forEach(btn => {
            const column = btn.dataset.column;
            btn.textContent = column === currentSort.column ? 
              (currentSort.direction === 'asc' ? '↑' : '↓') : '▲';
          });
        })
        .catch(error => {
          console.error('Error loading workshops:', error);
          document.getElementById('workshop-error').textContent = 'Failed to load workshops. Please try again later.';
          document.getElementById('workshop-error').style.display = 'block';
          tableBody.innerHTML = '';
        });
    }
    
    function initializeFilters() {
      // Extract unique values for each filter
      const dates = [...new Set(workshopData.map(w => w.date))].filter(d => d).sort();
      const instructors = [...new Set(workshopData.map(w => w.instructor))].filter(i => i && i !== 'TBA').sort();
      const studios = [...new Set(workshopData.map(w => w.studio))].filter(s => s && s !== 'TBA').sort();
      
      // Populate date filter
      const dateOptions = document.getElementById('date-options');
      dateOptions.innerHTML = '';
      dates.forEach(date => {
        dateOptions.innerHTML += `
          <div class="multiselect-option">
            <input type="checkbox" id="date-${date.replace(/\s+/g, '-')}" value="${date}">
            <label for="date-${date.replace(/\s+/g, '-')}" >${date}</label>
          </div>
        `;
      });
      // Date dropdown open/close
      const dateDropdown = document.getElementById('date-filter');
      const dateTrigger = dateDropdown.querySelector('.multiselect-trigger');
      dateTrigger.addEventListener('click', function() {
        const dropdownList = dateDropdown.querySelector('.multiselect-dropdown-list');
        dropdownList.classList.toggle('active');
        // Close other dropdowns if open
        document.getElementById('instructor-options').classList.remove('active');
        document.getElementById('studio-options').classList.remove('active');
      });
      // Date checkbox change events
      dateOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          if (this.checked) {
            activeFilters.dates.push(this.value);
          } else {
            activeFilters.dates = activeFilters.dates.filter(d => d !== this.value);
          }
          renderWorkshopsTable();
          updateActiveFilters('date');
          updateFiltersSummary();
        });
      });
      
      // Populate instructor filter
      const instructorOptions = document.getElementById('instructor-options');
      instructors.forEach(instructor => {
        instructorOptions.innerHTML += `
          <div class="multiselect-option">
            <input type="checkbox" id="instructor-${instructor.replace(/\s+/g, '-')}" value="${instructor}">
            <label for="instructor-${instructor.replace(/\s+/g, '-')}">${instructor}</label>
          </div>
        `;
      });
      
      // Populate studio filter
      const studioOptions = document.getElementById('studio-options');
      studios.forEach(studio => {
        studioOptions.innerHTML += `
          <div class="multiselect-option">
            <input type="checkbox" id="studio-${studio.replace(/\s+/g, '-')}" value="${studio}">
            <label for="studio-${studio.replace(/\s+/g, '-')}">${studio}</label>
          </div>
        `;
      });
      
      // Set up instructor multiselect
      const instructorDropdown = document.getElementById('instructor-filter');
      const instructorTrigger = instructorDropdown.querySelector('.multiselect-trigger');
      
      instructorTrigger.addEventListener('click', function() {
        const dropdownList = instructorDropdown.querySelector('.multiselect-dropdown-list');
        dropdownList.classList.toggle('active');
        
        // Close other dropdowns if open
        document.getElementById('studio-options').classList.remove('active');
        document.getElementById('date-options').classList.remove('active');
      });
      
      // Set up studio multiselect
      const studioDropdown = document.getElementById('studio-filter');
      const studioTrigger = studioDropdown.querySelector('.multiselect-trigger');
      
      studioTrigger.addEventListener('click', function() {
        const dropdownList = studioDropdown.querySelector('.multiselect-dropdown-list');
        dropdownList.classList.toggle('active');
        
        // Close other dropdowns if open
        document.getElementById('instructor-options').classList.remove('active');
        document.getElementById('date-options').classList.remove('active');
      });
      
      // Instructor checkbox change events
      instructorOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          if (this.checked) {
            activeFilters.instructors.push(this.value);
          } else {
            activeFilters.instructors = activeFilters.instructors.filter(i => i !== this.value);
          }
          renderWorkshopsTable();
          updateActiveFilters('instructor');
          updateFiltersSummary();
        });
      });
      
      // Studio checkbox change events
      studioOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          if (this.checked) {
            activeFilters.studios.push(this.value);
          } else {
            activeFilters.studios = activeFilters.studios.filter(s => s !== this.value);
          }
          renderWorkshopsTable();
          updateActiveFilters('studio');
          updateFiltersSummary();
        });
      });
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.multiselect-dropdown')) {
          document.querySelectorAll('.multiselect-dropdown-list').forEach(list => {
            list.classList.remove('active');
          });
        }
      });
    }
    
    function updateActiveFilters(type) {
      if (type === 'date') {
        const container = document.getElementById('active-date-filters');
        container.innerHTML = '';
        activeFilters.dates.forEach(date => {
          const pill = document.createElement('div');
          pill.className = 'filter-pill';
          pill.innerHTML = `
            ${date}
            <button class="remove-filter" data-type="date" data-value="${date}" aria-label="Remove ${date} filter">×</button>
          `;
          container.appendChild(pill);
        });
        // Update dropdown text
        const trigger = document.querySelector('#date-filter .multiselect-trigger');
        trigger.textContent = activeFilters.dates.length > 0 ? 
          `${activeFilters.dates.length} Selected` : 'Select Dates';
      } else if (type === 'instructor') {
        const container = document.getElementById('active-instructor-filters');
        container.innerHTML = '';
        
        activeFilters.instructors.forEach(instructor => {
          const pill = document.createElement('div');
          pill.className = 'filter-pill';
          pill.innerHTML = `
            ${instructor}
            <button class="remove-filter" data-type="instructor" data-value="${instructor}" aria-label="Remove ${instructor} filter">×</button>
          `;
          container.appendChild(pill);
        });
        
        // Update dropdown text
        const trigger = document.querySelector('#instructor-filter .multiselect-trigger');
        trigger.textContent = activeFilters.instructors.length > 0 ? 
          `${activeFilters.instructors.length} Selected` : 'Select Instructors';
      } else if (type === 'studio') {
        const container = document.getElementById('active-studio-filters');
        container.innerHTML = '';
        
        activeFilters.studios.forEach(studio => {
          const pill = document.createElement('div');
          pill.className = 'filter-pill';
          pill.innerHTML = `
            ${studio}
            <button class="remove-filter" data-type="studio" data-value="${studio}" aria-label="Remove ${studio} filter">×</button>
          `;
          container.appendChild(pill);
        });
        
        // Update dropdown text
        const trigger = document.querySelector('#studio-filter .multiselect-trigger');
        trigger.textContent = activeFilters.studios.length > 0 ? 
          `${activeFilters.studios.length} Selected` : 'Select Studios';
      }
      
      // Add event listeners to remove buttons
      document.querySelectorAll('.remove-filter').forEach(btn => {
        btn.addEventListener('click', function() {
          const type = this.dataset.type;
          const value = this.dataset.value;
          
          if (type === 'date') {
            activeFilters.dates = activeFilters.dates.filter(d => d !== value);
            document.getElementById(`date-${value.replace(/\s+/g, '-')}`).checked = false;
            updateActiveFilters('date');
          } else if (type === 'instructor') {
            activeFilters.instructors = activeFilters.instructors.filter(i => i !== value);
            document.getElementById(`instructor-${value.replace(/\s+/g, '-')}`).checked = false;
            updateActiveFilters('instructor');
          } else if (type === 'studio') {
            activeFilters.studios = activeFilters.studios.filter(s => s !== value);
            document.getElementById(`studio-${value.replace(/\s+/g, '-')}`).checked = false;
            updateActiveFilters('studio');
          }
          
          renderWorkshopsTable();
          updateFiltersSummary();
        });
      });
    }
    
    function updateFiltersSummary() {
      const summary = document.getElementById('filters-summary');
      const activeFilterCount = activeFilters.dates.length + 
                               activeFilters.instructors.length + 
                               activeFilters.studios.length;
      if (activeFilterCount === 0) {
        summary.textContent = 'No filters applied';
        return;
      }
      let summaryText = 'Showing workshops';
      if (activeFilters.dates.length > 0) {
        summaryText += ` on ${activeFilters.dates.join(', ')}`;
      }
      if (activeFilters.instructors.length > 0) {
        const instructorsText = activeFilters.instructors.length === 1 
          ? activeFilters.instructors[0]
          : `any of ${activeFilters.instructors.length} selected instructors`;
        summaryText += activeFilters.dates.length > 0 ? ` with ${instructorsText}` : ` by ${instructorsText}`;
      }
      if (activeFilters.studios.length > 0) {
        const studiosText = activeFilters.studios.length === 1 
          ? activeFilters.studios[0]
          : `any of ${activeFilters.studios.length} selected studios`;
        summaryText += ` at ${studiosText}`;
      }
      summary.textContent = summaryText;
    }
    
    function renderWorkshopsTable() {
      const tableBody = document.querySelector('#workshop-table tbody');
      const errorElem = document.getElementById('workshop-error');
      errorElem.style.display = 'none';
      
      if (workshopData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="7"><p class="error">No workshops found.</p></td></tr>';
        return;
      }
      
      // Filter the data based on active filters
      let filteredData = workshopData.filter(workshop => {
        // Date filter
        if (activeFilters.dates.length > 0 && !activeFilters.dates.includes(workshop.date)) {
          return false;
        }
        
        // Instructor filter
        if (activeFilters.instructors.length > 0 && !activeFilters.instructors.includes(workshop.instructor)) {
          return false;
        }
        
        // Studio filter
        if (activeFilters.studios.length > 0 && !activeFilters.studios.includes(workshop.studio)) {
          return false;
        }
        
        return true;
      });
      
      // Sort the filtered data
      filteredData.sort((a, b) => {
        let valueA, valueB;
        
        switch (currentSort.column) {
          case 'date':
            // Use timestamp_epoch for date-based sorting
            valueA = a.timestamp_epoch || 0;
            valueB = b.timestamp_epoch || 0;
            break;
          case 'time':
            // For time sorting, first group by date, then sort by time within same date
            // Extract date parts from the formatted date strings
            const dateA = a.date ? new Date(a.date.replace(/(\d+)(st|nd|rd|th)/, '$1')) : new Date(0);
            const dateB = b.date ? new Date(b.date.replace(/(\d+)(st|nd|rd|th)/, '$1')) : new Date(0);
            
            // If dates are different, sort by date first
            if (dateA.getTime() !== dateB.getTime()) {
              valueA = dateA.getTime();
              valueB = dateB.getTime();
            } else {
              // If same date, sort by timestamp_epoch (which includes time)
              valueA = a.timestamp_epoch || 0;
              valueB = b.timestamp_epoch || 0;
            }
            break;
          case 'by':
            valueA = a.instructor?.toLowerCase() || '';
            valueB = b.instructor?.toLowerCase() || '';
            break;
          case 'song':
            valueA = a.song?.toLowerCase() || '';
            valueB = b.song?.toLowerCase() || '';
            break;
          case 'studio_id':
            valueA = a.studio?.toLowerCase() || '';
            valueB = b.studio?.toLowerCase() || '';
            break;
          default:
            // Default sorting also uses timestamp_epoch
            valueA = a.timestamp_epoch || 0;
            valueB = b.timestamp_epoch || 0;
        }
        
        const direction = currentSort.direction === 'asc' ? 1 : -1;
        
        // Special handling for numeric timestamp values
        if (currentSort.column === 'date' || currentSort.column === 'time') {
          return (valueA - valueB) * direction;
        }
        
        // String comparison for other columns
        return (valueA > valueB ? 1 : -1) * direction;
      });
      
      // Check if no results after filtering
      if (filteredData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="7"><p class="error">No workshops match your filter criteria.</p></td></tr>';
        return;
      }
      
      tableBody.innerHTML = '';
      
      filteredData.forEach(workshop => {
        // Use the date directly from the API as it's already formatted
        const formattedDate = workshop.date || 'TBA';
        
        // Format time more compactly if it contains a dash
        let displayTime = workshop.time || 'TBA';
        if (displayTime.includes('-')) {
          // Convert "7:00 PM - 8:30 PM" to "7-8:30 PM"
          displayTime = displayTime.replace(/(\d+):(\d+)\s+(AM|PM)\s+-\s+(\d+):(\d+)\s+(AM|PM)/g, 
            (match, h1, m1, ampm1, h2, m2, ampm2) => {
              // If both times are in the same AM/PM period
              if (ampm1 === ampm2) {
                return `${h1}${m1 !== '00' ? ':'+m1 : ''}-${h2}${m2 !== '00' ? ':'+m2 : ''} ${ampm1}`;
              }
              // If times span AM/PM
              return `${h1}${m1 !== '00' ? ':'+m1 : ''} ${ampm1}-${h2}${m2 !== '00' ? ':'+m2 : ''} ${ampm2}`;
            }
          );
        }
        
        const row = document.createElement('tr');
        
        // Format instructor content with Instagram link if available
        const instructorContent = workshop.instructor_instagram ? 
          `<a href="${workshop.instructor_instagram}" class="workshop-instructor-link" target="_blank">
             <span class="instructor-name">${workshop.instructor}</span>
             <span class="instructor-instagram">
               <img src="/static/assets/instagram-icon.png" alt="Instagram">
             </span>
           </a>` : 
          `<span class="instructor-name">${workshop.instructor}</span>`;
        
        row.innerHTML = `
          <td data-label="Date">${formattedDate}</td>
          <td data-label="Time">${displayTime}</td>
          <td data-label="Instructor">${instructorContent}</td>
          <td data-label="Song">${workshop.song || 'TBA'}</td>
          <td data-label="Pricing">${workshop.pricing}</td>
          <td data-label="Studio">${workshop.studio || 'TBA'}</td>
          <td>
            ${workshop.registration_link ? 
              `<a href="${workshop.registration_link}" target="_blank" class="register-link">Register</a>` : 
              '<span class="coming-soon">Coming soon</span>'}
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    }
    
    function sortTable(column) {
      // Update button state
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.textContent = '▲';
      });
      
      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
      }
      
      // Update current sort button
      const currentButton = document.querySelector(`.sort-btn[data-column="${column}"]`);
      currentButton.textContent = currentSort.direction === 'asc' ? '↑' : '↓';
      
      renderWorkshopsTable();
    }
    
    // Close button for modal
    document.querySelector('.close-btn').addEventListener('click', closeModal);
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="description" content="View {{ artist_name }}'s dance workshops and classes. Book sessions with this amazing choreographer.">
    <meta name="keywords" content="dance artist, {{ artist_name }}, choreographer, dance classes, workshops">
    <meta property="og:title" content="{{ artist_name }} - Dance Artist">
    <meta property="og:description" content="View {{ artist_name }}'s dance workshops and classes. Book sessions with this amazing choreographer.">
    <meta property="og:image" content="{{ artist.image_url if artist.image_url else '/static/assets/logo.png' }}">
    <meta property="og:url" content="{{ current_url }}">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <title>{{ artist_name }} - Dance Artist | Nachna</title>
    <link rel="icon" type="image/png" href="/static/assets/logo.png">
    <link rel="apple-touch-icon" href="/static/assets/logo.png">
    <link rel="stylesheet" href="/static/css/auth_components.css">

    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
            --artist-gradient: linear-gradient(135deg, #FF006E 0%, #8338EC 100%);
            --background-gradient: linear-gradient(135deg, #0A0A0F 0%, #1A1A2E 25%, #16213E 50%, #0F3460 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --accent-blue: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            --accent-green: linear-gradient(135deg, #10B981 0%, #059669 100%);
            --accent-purple: #8B5CF6;
            --accent-pink: linear-gradient(135deg, #FF006E 0%, #DC2626 100%);
            --instagram-gradient: linear-gradient(135deg, #E4405F 0%, #C13584 50%, #833AB4 100%);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --hover-shadow: 0 12px 40px rgba(255, 0, 110, 0.2);
            --like-color: #FF006E;
            --follow-color: #8338EC;
            --share-color: #00D4FF;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            padding: 2rem;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #FF006E;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* Main Container */
        .main-container {
            min-height: 100vh;
            position: relative;
        }
        
        /* Back Button */
        .back-button {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0.75rem;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            width: 44px;
            height: 44px;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }
        
        .back-button svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        /* Content Container */
        .content {
            padding-top: 6rem;
            padding-bottom: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }
        
        /* Artist Header Card */
        .artist-header {
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1.5px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: var(--card-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .artist-header-content {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
        }
        
        .artist-image-container {
            flex-shrink: 0;
            position: relative;
        }
        
        .artist-image {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            object-fit: cover;
            background: var(--artist-gradient);
        }
        
        .artist-image-fallback {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            background: var(--artist-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .artist-info {
            flex: 1;
            min-width: 0;
        }
        
        .artist-name {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 1.2px;
            line-height: 1.3;
            margin-bottom: 0.75rem;
            overflow-wrap: break-word;
        }
        
        .artist-badges-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .instructor-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(255, 0, 110, 0.2) 0%, rgba(131, 56, 236, 0.2) 100%);
            border: 1px solid rgba(255, 0, 110, 0.3);
            color: var(--like-color);
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .instagram-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--instagram-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .instagram-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(228, 64, 95, 0.4);
        }
        
        .instagram-icon svg {
            width: 18px;
            height: 18px;
            fill: white;
        }
        
        /* Action Buttons Row */
        .action-buttons-row {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-button {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            min-height: 44px;
        }
        
        .like-button {
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid rgba(255, 0, 110, 0.3);
            color: white;
        }
        
        .like-button.liked {
            background: rgba(255, 0, 110, 0.4);
            border: 1px solid rgba(255, 0, 110, 0.6);
        }
        
        .follow-button {
            background: rgba(131, 56, 236, 0.2);
            border: 1px solid rgba(131, 56, 236, 0.3);
            color: white;
        }
        
        .follow-button.following {
            background: rgba(131, 56, 236, 0.4);
            border: 1px solid rgba(131, 56, 236, 0.6);
        }
        
        .share-button-action {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: white;
        }
        
        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(255, 0, 110, 0.3);
        }
        
        .action-button svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
        
        /* Workshops Section */
        .workshops-section {
            margin-bottom: 3rem;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid rgba(255, 0, 110, 0.3);
            border-radius: 16px;
        }
        
        .section-icon-container {
            background: rgba(255, 0, 110, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .section-icon {
            width: 20px;
            height: 20px;
            fill: var(--like-color);
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--like-color);
            letter-spacing: 0.5px;
        }
        
        /* Workshop Cards Grid */
        .workshops-grid {
            display: grid;
            gap: 1rem;
        }
        
        /* Studio Avatar Styles */
        .workshop-studio-column {
            flex-shrink: 0;
            margin-right: 1rem;
            display: flex;
            align-items: flex-start;
        }
        
        .studio-avatar-container {
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .studio-avatar-container:hover {
            transform: scale(1.05);
        }
        
        .studio-avatar {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            object-fit: cover;
            background: var(--primary-gradient);
        }
        
        .studio-avatar-fallback {
            width: 42px;
            height: 42px;
            border-radius: 10px;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1rem;
        }
        
        /* Enhanced Studio Info */
        .studio-info-enhanced {
            margin-bottom: 0.75rem;
        }
        
        .workshop-studio-name {
            cursor: pointer;
            transition: color 0.2s ease;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .workshop-studio-name:hover {
            color: var(--share-color);
        }
        
        /* Workshop Card Styles - Artist Detail Layout */
        .workshop-card {
            margin-bottom: 1rem;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(255, 0, 110, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 1.5rem;
        }
        
        .workshop-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--artist-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .workshop-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .workshop-card:hover::before {
            opacity: 1;
        }
        
        /* Workshop Header - Date and Action Buttons Row */
        .workshop-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            gap: 1rem;
        }
        
        .workshop-date-main {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.3;
            flex: 1;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        
        .choreo-button-header {
            width: 44px;
            height: 32px;
            border-radius: 8px;
            background: var(--instagram-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 6px rgba(225, 48, 108, 0.3);
        }
        
        .choreo-button-header:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(225, 48, 108, 0.4);
        }
        
        .choreo-button-header svg {
            width: 18px;
            height: 18px;
            fill: white;
        }
        
        .time-badge {
            background: var(--artist-gradient);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        /* Main Content Row */
        .workshop-main-row {
            display: flex;
            gap: 1rem;
        }
        
        /* Left Side - Workshop Details */
        .workshop-info-column {
            flex: 1;
            min-width: 0;
        }
        
        .workshop-song-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--like-color);
            margin-bottom: 0.75rem;
            line-height: 1.2;
        }
        
        .workshop-detail-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .workshop-detail-row svg {
            width: 14px;
            height: 14px;
            fill: rgba(255, 255, 255, 0.7);
            flex-shrink: 0;
        }
        
        .workshop-detail-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .workshop-pricing-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            font-weight: 400;
            line-height: 1.2;
        }
        
        /* Right Side - Register Button */
        .workshop-register-column {
            flex-shrink: 0;
            display: flex;
            align-items: center;
        }
        
        .register-button-main {
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            min-width: 100px;
            flex-shrink: 0;
        }
        
        .register-button-main.nachna {
            background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
            box-shadow: 0 4px 16px rgba(0, 212, 255, 0.4);
            font-weight: 700;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .register-button-main.nachna::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .register-button-main.nachna:hover::before {
            left: 100%;
        }

        .register-button-main.nachna:hover {
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.6);
            transform: translateY(-2px);
        }

        .register-button-main.whatsapp {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .register-button-main.external {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .register-button-main.url {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .register-button-main.disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .register-button-main:not(.disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }
        
        .register-button-main svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
        
        .choreo-button {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--instagram-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .choreo-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(228, 64, 95, 0.4);
        }
        
        .choreo-button svg {
            width: 18px;
            height: 18px;
            fill: white;
        }
        
        .book-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }
        
        .book-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }
        
        .book-button.external {
            background: var(--accent-blue);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .book-button.disabled {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-tertiary);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .empty-message {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* Error State */
        .error-state {
            text-align: center;
            padding: 3rem 1.5rem;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 24px;
            border: 1px solid rgba(220, 38, 38, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #DC2626;
        }
        
        .error-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #DC2626;
            margin-bottom: 0.5rem;
        }
        
        .error-message {
            color: rgba(220, 38, 38, 0.8);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        .retry-button {
            background: #DC2626;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .retry-button:hover {
            background: #B91C1C;
            transform: translateY(-1px);
        }
        
        /* Share Modal */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .share-modal.show {
            display: flex;
        }
        
        .share-content {
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px);
            padding: 2rem;
            max-width: 400px;
            width: calc(100% - 2rem);
            position: relative;
        }
        
        .share-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .share-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .share-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .share-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .share-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text-primary);
        }
        
        .share-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        .share-option-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .share-option-text {
            font-weight: 600;
            flex: 1;
        }
        
        .share-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            /* Reset base styles for mobile */
            body {
                font-size: 14px;
                line-height: 1.4;
                -webkit-text-size-adjust: 100%;
                padding: 0;
                margin: 0;
            }
            
            /* Studio avatars mobile */
            .workshop-studio-column {
                margin-right: 0.75rem;
            }
            
            .studio-avatar, .studio-avatar-fallback {
                width: 32px;
                height: 32px;
                border-radius: 8px;
                font-size: 0.8rem;
            }
            
            /* Back button - positioned like app's SafeArea */
            .back-button {
                position: fixed;
                top: calc(env(safe-area-inset-top, 0px) + 2rem);
                left: 1.5rem;
                width: 32px;
                height: 32px;
                padding: 8px;
                background: transparent;
                border: none;
                z-index: 1000;
            }
            
            .back-button svg {
                width: 16px;
                height: 16px;
                fill: white;
            }
            
            /* Main content - matches ListView padding in app */
            .content {
                padding-top: calc(env(safe-area-inset-top, 0px) + 5rem);
                padding-left: 1.5rem;
                padding-right: 1.5rem;
                padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 1rem);
            }
            
            /* Artist Header - exact match to app's Container with decoration */
            .artist-header {
                margin-bottom: 1.5rem;
                padding: 1.5rem;
                border-radius: 20px;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
                border: 1.5px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
            }
            
            .artist-header-content {
                display: flex;
                align-items: flex-start;
                gap: 1.5rem;
            }
            
            /* Artist image - larger than studio (1.4x) */
            .artist-image, .artist-image-fallback {
                width: 112px;
                height: 112px;
                border-radius: 16px;
                flex-shrink: 0;
            }
            
            .artist-image-fallback {
                background: linear-gradient(135deg, rgba(255, 0, 110, 0.3) 0%, rgba(131, 56, 236, 0.3) 100%);
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .artist-info {
                flex: 1;
                min-width: 0;
            }
            
            /* Artist name */
            .artist-name {
                font-size: 1.5rem;
                font-weight: 700;
                letter-spacing: 0.5px;
                color: white;
                line-height: 1.2;
                margin-bottom: 0.75rem;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
            }
            
            /* Artist badges row */
            .artist-badges-row {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 1rem;
                flex-wrap: wrap;
            }
            
            /* Dance Instructor badge */
            .instructor-badge {
                display: flex;
                align-items: center;
                gap: 0.375rem;
                padding: 0.375rem 0.75rem;
                border-radius: 16px;
                background: linear-gradient(135deg, rgba(255, 0, 110, 0.2) 0%, rgba(131, 56, 236, 0.2) 100%);
                border: 1px solid rgba(255, 0, 110, 0.3);
                font-size: 0.75rem;
                font-weight: 600;
                color: var(--like-color);
            }
            
            .instructor-badge svg {
                width: 12px;
                height: 12px;
                fill: currentColor;
            }
            
            /* Instagram icon */
            .instagram-icon {
                width: 24px;
                height: 24px;
                border-radius: 6px;
                background: var(--instagram-gradient);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                flex-shrink: 0;
            }
            
            .instagram-icon svg {
                width: 12px;
                height: 12px;
                fill: white;
            }
            
            /* Action buttons row */
            .action-buttons-row {
                display: flex;
                gap: 0.375rem;
                margin-top: 0.5rem;
            }
            
            .action-button {
                flex: 1;
                padding: 0.6rem 0.75rem;
                border-radius: 8px;
                font-size: 0.8rem;
                font-weight: 600;
                min-height: 36px;
            }
            
            .action-button svg {
                width: 16px;
                height: 16px;
            }
            
            /* Workshops grid - single column like app */
            .workshops-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            /* Workshop cards - mobile app layout */
            .workshop-card {
                padding: 1.5rem;
                border-radius: 16px;
                margin-bottom: 1rem;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%);
                border: 1px solid rgba(255, 255, 255, 0.15);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(255, 0, 110, 0.05);
                backdrop-filter: blur(2px);
            }
            
            /* Header row - date + choreo + time */
            .workshop-header-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
                gap: 1rem;
            }
            
            .workshop-date-main {
                font-size: 0.95rem;
                font-weight: 700;
                color: white;
                flex: 1;
                line-height: 1.2;
            }
            
            .header-actions {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                flex-shrink: 0;
            }
            
            .choreo-button-header {
                width: 38px;
                height: 28px;
                border-radius: 6px;
            }
            
            .choreo-button-header svg {
                width: 16px;
                height: 16px;
            }
            
            .time-badge {
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
                border-radius: 6px;
                background: var(--artist-gradient);
            }
            
            /* Main content row */
            .workshop-main-row {
                display: flex;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .workshop-info-column {
                flex: 1;
                min-width: 0;
            }
            
            .workshop-song-title {
                font-size: 0.8rem;
                font-weight: 600;
                color: var(--like-color);
                margin-bottom: 0.5rem;
                line-height: 1.2;
            }
            
            .workshop-detail-row {
                display: flex;
                align-items: center;
                gap: 0.4rem;
                margin-bottom: 0.375rem;
            }
            
            .workshop-detail-row svg {
                width: 12px;
                height: 12px;
                flex-shrink: 0;
            }
            
            .workshop-detail-text {
                font-size: 0.75rem;
                font-weight: 500;
                color: rgba(255, 255, 255, 0.9);
                line-height: 1.2;
            }
            
            .workshop-pricing-text {
                font-size: 0.7rem;
                font-weight: 400;
                color: rgba(255, 255, 255, 0.8);
                line-height: 1.2;
            }
            
            .workshop-register-column {
                flex-shrink: 0;
                align-self: flex-end;
            }
            
            .register-button-main {
                padding: 0.75rem 1rem;
                border-radius: 8px;
                font-size: 0.75rem;
                font-weight: 600;
                min-width: 80px;
                min-height: 36px;
            }

            .register-button-main.nachna {
                background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
                box-shadow: 0 2px 8px rgba(0, 212, 255, 0.3);
            }

            .register-button-main.whatsapp {
                background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
                box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
            }

            .register-button-main.external,
            .register-button-main.url {
                background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            }

            .register-button-main.disabled {
                background: rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.5);
                cursor: not-allowed;
                box-shadow: none;
            }

            .register-button-main:hover:not(.disabled) {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            }
            
            .register-button-main svg {
                width: 14px;
                height: 14px;
            }
            
            /* Section header mobile */
            .section-header {
                padding: 1rem 1.25rem;
                margin-bottom: 1rem;
                border-radius: 16px;
            }
            
            .section-title {
                font-size: 1rem;
                font-weight: 700;
            }
            
            /* Touch-friendly improvements */
            html {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            body {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            /* Remove tap highlights and selections */
            .workshop-card,
            .action-button,
            .book-button,
            .choreo-button,
            .back-button,
            .instagram-icon {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Touch feedback */
            .action-button:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            .book-button:active,
            .choreo-button:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            .back-button:active,
            .instagram-icon:active {
                transform: scale(0.85);
                transition: transform 0.1s ease;
            }
            
            .workshop-card:active {
                background: rgba(255, 255, 255, 0.18);
                transition: background 0.1s ease;
            }
            
            /* Remove desktop hover effects on mobile */
            .workshop-card:hover,
            .book-button:hover,
            .choreo-button:hover,
            .action-button:hover {
                transform: none !important;
            }
            
            /* Share modal mobile */
            .share-modal {
                padding: 0;
                align-items: flex-end;
            }
            
            .share-content {
                margin: 0;
                width: 100%;
                max-width: none;
                border-radius: 20px 20px 0 0;
                padding: 1.5rem 1rem calc(env(safe-area-inset-bottom, 0px) + 1rem);
            }
        }
        
        /* Desktop responsive */
        @media (min-width: 769px) {
            .content {
                padding-left: 2rem;
                padding-right: 2rem;
            }
            
            .workshops-grid {
                grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            }
        }
        
        @media (min-width: 1024px) {
            .workshops-grid {
                grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            }
        }
        
        /* Accessibility */
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            padding: 2rem;
            max-width: 500px;
            width: calc(100% - 2rem);
            position: relative;
            color: white;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            text-align: center;
        }

        .modal-body p {
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        .primary-btn {
            background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        /* Bundle Modal Styles */
        .bundle-modal {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .bundle-modal .modal-body {
            text-align: left;
        }

        .current-workshop-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .current-workshop-info h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .workshop-summary .workshop-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .workshop-summary .workshop-details {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .bundle-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .option-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .option-header h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .price-tag, .bundle-badge {
            background: var(--primary-gradient);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .bundle-badge {
            background: var(--accent-green);
        }

        .bundle-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .pricing-comparison {
            margin-bottom: 1rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }

        .price-row:last-child {
            margin-bottom: 0;
        }

        .price-label {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .price-value {
            font-weight: 600;
        }

        .price-value.strikethrough {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .price-value.highlight {
            color: var(--like-color);
        }

        .savings-badge {
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 0.5rem;
        }

        .workshop-count {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .option-button {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .option-button.primary {
            background: var(--primary-gradient);
            color: white;
        }

        .option-button.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .option-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .option-button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .individual-option {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Focus States */
        .action-button:focus,
        .book-button:focus,
        .choreo-button:focus,
        .back-button:focus,
        .instagram-icon:focus {
            outline: 2px solid #FF006E;
            outline-offset: 2px;
        }

        /* Auth Modal Styles */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .auth-modal.show {
            display: flex;
        }

        .auth-modal-content {
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px);
            padding: 2rem;
            max-width: 400px;
            width: calc(100% - 2rem);
            position: relative;
        }

        .auth-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.25rem;
            font-weight: 700;
        }

        .auth-modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .auth-modal-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .auth-modal-body {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .phone-input-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .country-code {
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .form-input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .form-input:focus {
            background: rgba(255, 255, 255, 0.05);
        }

        /* OTP Input Styles */
        .otp-input-container {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 1rem 0;
        }

        .otp-input {
            width: 40px;
            height: 40px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            font-size: 1.25rem;
            font-weight: 600;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .otp-input:focus {
            border-color: #00D4FF;
        }

        .otp-actions {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }

        /* Button Styles */
        .auth-primary-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
        }

        .auth-primary-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .auth-primary-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-secondary-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .auth-secondary-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }

        .auth-secondary-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .resend-text {
            display: none;
        }

        .countdown-text {
            display: block;
        }

        .auth-secondary-btn:not([disabled]) .resend-text {
            display: block;
        }

        .auth-secondary-btn:not([disabled]) .countdown-text {
            display: none;
        }

        .btn-loader {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .auth-error {
            color: #FF006E;
            font-size: 0.875rem;
            text-align: center;
            margin-top: 0.5rem;
        }

        /* Auth Container */
        .auth-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }

        .auth-button {
            padding: 0.5rem 1rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
        }

        .auth-button:hover {
            background: var(--glass-bg);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .auth-icon {
            width: 16px;
            height: 16px;
        }

        .auth-text {
            font-size: 0.875rem;
        }

        /* Profile Modal Styles */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .profile-modal.show {
            display: flex;
        }

        .profile-modal-content {
            background: var(--glass-bg);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(15px);
            padding: 0;
            max-width: 420px;
            width: calc(100% - 2rem);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .profile-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 1.25rem;
            font-weight: 700;
            z-index: 1;
        }

        .profile-modal-header {
            padding: 2rem 2rem 1rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .profile-modal-body {
            padding: 1.5rem 2rem 2rem;
        }

        /* Profile Header */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .profile-avatar-large {
            flex-shrink: 0;
        }

        .profile-avatar-large img,
        .profile-avatar-large .profile-fallback-large {
            width: 80px;
            height: 80px;
            border-radius: 16px;
            object-fit: cover;
            border: 3px solid var(--primary-gradient);
        }

        .profile-fallback-large {
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 2rem;
        }

        .profile-info {
            flex: 1;
            min-width: 0;
        }

        .profile-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            word-break: break-word;
        }

        .profile-mobile {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .profile-status {
            display: inline-block;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.complete {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
        }

        .status-badge.incomplete {
            background: linear-gradient(135deg, #FF006E 0%, #DC2626 100%);
            color: white;
        }

        /* Profile Actions */
        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .profile-action-btn {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
        }

        .profile-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .action-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-profile .action-icon {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
        }

        .view-orders .action-icon {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .view-rewards .action-icon {
            background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
        }

        .action-icon svg {
            width: 20px;
            height: 20px;
            stroke: white;
        }

        .action-text {
            flex: 1;
            min-width: 0;
        }

        .action-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .action-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .action-arrow {
            flex-shrink: 0;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .profile-action-btn:hover .action-arrow {
            color: var(--text-primary);
        }

        /* Profile Footer */
        .profile-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 1.5rem;
        }

        .logout-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, #FF006E 0%, #DC2626 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(255, 0, 110, 0.3);
        }

        /* Orders Modal Styles */
        .orders-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
        }

        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }

        .orders-loading,
        .orders-error,
        .orders-empty {
            text-align: center;
            padding: 2rem;
        }

        .orders-loading p,
        .orders-error p,
        .orders-empty p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .orders-error button {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Rewards Modal Styles */
        .rewards-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .rewards-loading,
        .rewards-error {
            text-align: center;
            padding: 2rem;
        }

        .rewards-loading p,
        .rewards-error p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .rewards-error button {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .rewards-balance {
            margin-bottom: 2rem;
        }

        .balance-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .balance-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .balance-info {
            flex: 1;
        }

        .balance-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .balance-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .balance-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .stat-icon {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .stat-icon.earned {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        .stat-icon.redeemed {
            background: linear-gradient(135deg, #FF006E 0%, #DC2626 100%);
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Transaction History Styles */
        .rewards-transactions {
            margin-top: 2rem;
        }

        .transactions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .transactions-header h4 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .transaction-tabs {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 2px;
        }

        .transaction-tab {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .transaction-tab.active {
            background: var(--primary-gradient);
            color: white;
        }

        .transaction-tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .transaction-tab.active:hover {
            background: var(--primary-gradient);
        }

        .transactions-list {
            margin-bottom: 1rem;
        }

        .load-more-btn {
            text-align: center;
            margin-top: 1rem;
        }

        .load-more-btn button {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .load-more-btn button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }

        /* Profile Completion Modal Styles */
        .profile-completion-message {
            text-align: center;
            margin-bottom: 2rem;
        }

        .completion-icon {
            color: var(--primary-gradient);
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
        }

        .completion-icon svg {
            stroke: #00D4FF;
        }

        .profile-completion-message h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .profile-completion-message p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        .profile-requirements {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .requirement-item svg {
            color: var(--primary-gradient);
            stroke: #00D4FF;
            flex-shrink: 0;
        }

        .requirement-item span {
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .profile-completion-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .completion-cancel-btn,
        .completion-update-btn {
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 120px;
        }

        .completion-cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .completion-cancel-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .completion-update-btn {
            background: var(--primary-gradient);
            color: white;
        }

        .completion-update-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .completion-update-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .update-loader {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        /* Edit Profile Modal Styles */
        .edit-profile-picture-section {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .edit-profile-avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .edit-avatar-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .avatar-edit-btn,
        .avatar-remove-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: none;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .avatar-edit-btn {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            color: white;
        }

        .avatar-edit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .avatar-remove-btn {
            background: linear-gradient(135deg, #FF006E 0%, #DC2626 100%);
            color: white;
        }

        .avatar-remove-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 0, 110, 0.3);
        }

        .edit-profile-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .gender-options {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .gender-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .gender-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .gender-option input[type="radio"] {
            margin: 0;
            width: 16px;
            height: 16px;
        }

        .gender-option input[type="radio"]:checked {
            accent-color: #00D4FF;
        }

        .gender-label {
            font-size: 0.9rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .edit-profile-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .edit-cancel-btn,
        .edit-save-btn {
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 120px;
        }

        .edit-cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .edit-cancel-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .edit-save-btn {
            background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
            color: white;
        }

        .edit-save-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .edit-save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .save-loader {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .profile-modal-content {
                width: calc(100% - 1rem);
                max-height: 95vh;
            }

            .profile-modal-header,
            .profile-modal-body {
                padding-left: 1.5rem;
                padding-right: 1.5rem;
            }

            .profile-header {
                gap: 0.75rem;
            }

            .profile-avatar-large img,
            .profile-avatar-large .profile-fallback-large {
                width: 60px;
                height: 60px;
            }

            .profile-name {
                font-size: 1.1rem;
            }

            .profile-action-btn {
                padding: 0.875rem;
            }

            .balance-stats {
                grid-template-columns: 1fr;
            }

            .edit-profile-avatar-container {
                gap: 0.75rem;
            }

            .edit-avatar-buttons {
                flex-direction: column;
                gap: 0.375rem;
            }

            .gender-options {
                flex-direction: column;
                gap: 0.5rem;
            }

            .edit-profile-actions {
                flex-direction: column-reverse;
            }

            .edit-cancel-btn,
            .edit-save-btn {
                width: 100%;
            }

            /* Profile completion modal mobile */
            .profile-requirements {
                gap: 0.5rem;
            }

            .requirement-item {
                padding: 0.5rem 0.75rem;
            }

            .profile-completion-actions {
                flex-direction: column-reverse;
            }

            .completion-cancel-btn,
            .completion-update-btn {
                width: 100%;
            }

            /* Transaction tabs mobile */
            .transactions-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .transaction-tabs {
                width: 100%;
            }

            .transaction-tab {
                flex: 1;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading artist details...</div>
        </div>
    </div>

    <!-- Main Container -->
    <div id="main-container" class="main-container" style="display: none;">
        <!-- Back Button -->
        <a href="/" class="back-button" aria-label="Go back to home">
            <svg viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
            </svg>
        </a>

        <!-- Login/Profile Button -->
        <div id="auth-container" class="auth-container">
            <button id="auth-button" class="auth-button">
                <span class="auth-text">Login</span>
                <svg class="auth-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Artist Header -->
            <div class="artist-header">
                <div class="artist-header-content">
                    <!-- Artist Image -->
                    <div class="artist-image-container">
                        <img id="artist-image" class="artist-image" src="" alt="Artist" style="display: none;">
                        <div id="artist-image-fallback" class="artist-image-fallback">
                            <svg width="50" height="50" viewBox="0 0 24 24" fill="white">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Artist Info -->
                    <div class="artist-info">
                        <h1 id="artist-name" class="artist-name">Loading...</h1>
                        
                        <div class="artist-badges-row">
                            <div class="instructor-badge">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                </svg>
                                Dance Instructor
                            </div>
                            <div id="instagram-icon" class="instagram-icon" style="display: none;">
                                <svg viewBox="0 0 24 24">
                                    <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3z"/>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Action Buttons (Like, Follow, Share) -->
                        <div class="action-buttons-row">
                            <button id="like-button" class="action-button like-button">
                                <svg id="like-icon" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                <span id="like-text">Like</span>
                            </button>
                            <button id="follow-button" class="action-button follow-button">
                                <svg id="follow-icon" viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </svg>
                                <span id="follow-text">Follow</span>
                            </button>
                            <button id="share-button-action" class="action-button share-button-action" onclick="openShareModal()">
                                <svg viewBox="0 0 24 24">
                                    <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.50-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                                </svg>
                                Share
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Workshops Section -->
            <div id="workshops-section" style="display: none;">
                <div class="section-header">
                    <div class="section-icon-container">
                        <svg class="section-icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <h2 class="section-title">Workshops</h2>
                </div>
                <div id="workshops-content" class="workshops-grid"></div>
            </div>
            
            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon"></div>
                <h3 class="empty-title">No Workshops Scheduled</h3>
                <p class="empty-message">This artist doesn't have any workshops scheduled at the moment. Follow them to get notified when new workshops are available!</p>
            </div>
            
            <!-- Error State -->
            <div id="error-state" class="error-state" style="display: none;">
                <div class="error-icon"></div>
                <h3 class="error-title">Error Loading Workshops</h3>
                <p id="error-message" class="error-message">Failed to load workshops. Please check your internet connection and try again.</p>
                <button class="retry-button" onclick="loadData()">Try Again</button>
            </div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div id="share-modal" class="share-modal">
        <div class="share-content">
            <div class="share-close" onclick="closeShareModal()"></div>
            <div class="share-header">
                <h3 class="share-title">Share Artist</h3>
                <p class="share-subtitle">Let others discover this amazing dance instructor!</p>
            </div>
            <div class="share-options">
                <a href="#" id="whatsapp-share" class="share-option">
                    <div class="share-option-icon" style="background: #25D366;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.488"/>
                        </svg>
                    </div>
                    <span class="share-option-text">Share on WhatsApp</span>
                </a>
                
                <a href="#" id="instagram-share" class="share-option">
                    <div class="share-option-icon" style="background: linear-gradient(45deg, #E4405F, #C13584, #833AB4);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3z"/>
                        </svg>
                    </div>
                    <span class="share-option-text">Share to Instagram Story</span>
                </a>
                
                <a href="#" id="generic-share" class="share-option">
                    <div class="share-option-icon" style="background: var(--artist-gradient);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.50-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                        </svg>
                    </div>
                    <span class="share-option-text">More...</span>
                </a>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let artistData = null;
        let workshopsData = null;
        // Extract artist ID from URL
        function getArtistIdFromUrl() {
            const path = window.location.pathname;
            const match = path.match(/\/artist\/([^\/]+)/);
            return match ? match[1] : null;
        }

        const artistId = "{{ artist_id }}" || getArtistIdFromUrl();
        let isLiked = false;
        let isFollowing = false;
        
        // DOM Elements
        const loadingOverlay = document.getElementById('loading-overlay');
        const mainContainer = document.getElementById('main-container');
        const artistImage = document.getElementById('artist-image');
        const artistImageFallback = document.getElementById('artist-image-fallback');
        const artistName = document.getElementById('artist-name');
        const instagramIcon = document.getElementById('instagram-icon');
        const workshopsSection = document.getElementById('workshops-section');
        const workshopsContent = document.getElementById('workshops-content');
        const emptyState = document.getElementById('empty-state');
        const errorState = document.getElementById('error-state');
        const errorMessage = document.getElementById('error-message');
        // shareModal is defined in auth_components.js
        const likeButton = document.getElementById('like-button');
        const followButton = document.getElementById('follow-button');
        const likeIcon = document.getElementById('like-icon');
        const followIcon = document.getElementById('follow-icon');
        const likeText = document.getElementById('like-text');
        const followText = document.getElementById('follow-text');
        
        // Utility functions
        function toTitleCase(str) {
            if (!str) return '';
            return str.toLowerCase().split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }
        
        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ').map(word => word.charAt(0).toUpperCase()).join('').slice(0, 2);
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return 'TBA';
            return timeStr;
        }
        
        function formatDate(dateStr) {
            // The date is already properly formatted by the backend
            // Just return it as-is, or 'TBA' if empty
            return dateStr || 'TBA';
        }
        
        function showLoading() {
            loadingOverlay.style.display = 'flex';
            mainContainer.style.display = 'none';
        }
        
        function hideLoading() {
            loadingOverlay.style.display = 'none';
            mainContainer.style.display = 'block';
            
            // Additional safety check - ensure artist image is loaded after UI is visible
            if (artistData && artistImage.src === '') {
                setTimeout(function() {
                    loadArtistImage();
                }, 200);
            }
        }
        
        function showError(message) {
            hideLoading();
            errorMessage.textContent = message;
            errorState.style.display = 'block';
            workshopsSection.style.display = 'none';
            emptyState.style.display = 'none';
        }
        
        function showEmpty() {
            hideLoading();
            emptyState.style.display = 'block';
            workshopsSection.style.display = 'none';
            errorState.style.display = 'none';
        }
        
        // Load specific artist data
        async function loadArtistData() {
            try {
                // Try to get specific artist first
                const response = await fetch(`/api/artist/${artistId}`, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                if (response.ok) {
                    artistData = await response.json();
                    displayArtistInfo(); // Display immediately like studio page
                    return;
                }
                
                // Fallback to loading all artists and finding the one we need
                const fallbackResponse = await fetch(`/api/artists`, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                if (!fallbackResponse.ok) {
                    throw new Error(`Failed to load artists (${fallbackResponse.status})`);
                }

                const allArtists = await fallbackResponse.json();
                artistData = allArtists.find(artist => artist.id === artistId);
                
                if (!artistData) {
                    throw new Error(`Artist with ID ${artistId} not found`);
                }
                
                displayArtistInfo(); // Display immediately like studio page
            } catch (error) {
                throw error;
            }
        }
        
        // Load workshops data
        async function loadWorkshopsData() {
            try {
                const response = await fetch(`/api/workshops_by_artist/${artistId}`, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                if (!response.ok) {
                    throw new Error(`Failed to load workshops (${response.status})`);
                }
                workshopsData = await response.json();
                // displayWorkshops() will be called from loadData() after studio data is loaded
            } catch (error) {
                throw error;
            }
        }
        
        // Centralized image loading function for artist images
        function loadImage(options) {
            const {
                element,           // Image element to load into
                type,             // 'artist' or 'studio'
                entityId,         // Artist ID or Studio ID
                altText,          // Alt text for image
                onSuccess,        // Callback when image loads successfully
                onError,          // Callback when image fails to load
                fallbackElement   // Optional fallback element to show on error
            } = options;
            
            // Validate required parameters
            if (!element || !type || !entityId) {
                if (onError) onError();
                return;
            }
            
            // Validate image type
            if (!['artist', 'studio', 'user'].includes(type)) {
                if (onError) onError();
                return;
            }
            
            // Create test image first to verify URL works
            const testImg = new Image();
            
            testImg.onload = function() {
                // Test successful, now update the actual element
                element.onload = function() {
                    if (onSuccess) {
                        onSuccess(this);
                    } else {
                        this.style.display = 'block';
                        if (fallbackElement) {
                            fallbackElement.style.display = 'none';
                        }
                    }
                };
                
                element.onerror = function() {
                    if (onError) {
                        onError(this);
                    } else {
                        this.style.display = 'none';
                        if (fallbackElement) {
                            fallbackElement.style.display = 'flex';
                        }
                    }
                };
                
                // Set properties and load
                element.alt = altText || `${type} image`;
                element.src = `/api/image/${type}/${entityId}`;
                
                // Fallback timeout in case onload doesn't fire
                setTimeout(function() {
                    if (element.complete && element.naturalHeight > 0) {
                        if (onSuccess) {
                            onSuccess(element);
                        } else {
                            element.style.display = 'block';
                            if (fallbackElement) {
                                fallbackElement.style.display = 'none';
                            }
                        }
                    }
                }, 2000);
            };
            
            testImg.onerror = function() {
                if (onError) {
                    onError(element);
                } else {
                    element.style.display = 'none';
                    if (fallbackElement) {
                        fallbackElement.style.display = 'flex';
                    }
                }
            };
            
            // Start the test load
            testImg.src = `/api/image/${type}/${entityId}?t=${Date.now()}`;
        }
        
        // Show artist image and hide fallback
        function showArtistImage() {
            artistImage.style.display = 'block';
            artistImageFallback.style.display = 'none';
        }
        
        // Show artist fallback and hide image
        function showArtistFallback() {
            artistImage.style.display = 'none';
            artistImageFallback.style.display = 'flex';
        }
        
        // Load artist image using centralized loader
        function loadArtistImage() {
            if (!artistData || !artistData.id) {
                showArtistFallback();
                return;
            }
            
            // Ensure elements are available
            if (!artistImage || !artistImageFallback) {
                setTimeout(loadArtistImage, 100);
                return;
            }
            
            loadImage({
                element: artistImage,
                type: 'artist',
                entityId: artistData.id,
                altText: artistData.name || 'Artist Image',
                onSuccess: function(img) {
                    showArtistImage();
                },
                onError: function(img) {
                    showArtistFallback();
                },
                fallbackElement: artistImageFallback
            });
        }
        
        // Display artist information
        function displayArtistInfo() {
            if (!artistData) return;
            
            // Update artist name
            artistName.textContent = toTitleCase(artistData.name);
            document.title = `${toTitleCase(artistData.name)} - Dance Artist | Nachna`;
            
            // Load artist image with delay to ensure DOM is ready
            setTimeout(function() {
                loadArtistImage();
            }, 100);
            
            // Handle Instagram icon
            if (artistData.instagram_link) {
                instagramIcon.style.display = 'flex';
                instagramIcon.onclick = function() {
                    window.open(artistData.instagram_link, '_blank', 'noopener,noreferrer');
                };
            } else {
                instagramIcon.style.display = 'none';
            }
        }
        
        // Load studio data for workshop details
        let studiosData = []; // Initialize as empty array to prevent null errors
        
        // Load specific studio data by ID
        async function loadStudioData(studioId) {
            try {
                if (!studioId) {
                    console.warn('loadStudioData called with empty studioId');
                    return null;
                }

                // Check if we already have this studio data
                const existingStudio = studiosData.find(s =>
                    s.id === studioId ||
                    s._id === studioId ||
                    s.studio_id === studioId
                );
                if (existingStudio) {
                    console.log('Studio data already exists for:', studioId);
                    return existingStudio;
                }

                // First try to get individual studio data
                console.log('Fetching individual studio data for:', studioId);
                let response = await fetch(`/api/studio/${studioId}`, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });

                if (response.ok) {
                const studioData = await response.json();

                // Add to our studios array
                if (!studiosData) studiosData = [];
                studiosData.push(studioData);

                return studioData;
                }

                // Fallback: Get all studios and find the specific one (like studio page)
                console.log('Individual studio endpoint failed, trying fallback...');
                response = await fetch('/api/studios', {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });

                if (!response.ok) {
                    console.warn(`Failed to load studios (${response.status})`);
                    return null;
                }

                const allStudios = await response.json();
                const studioData = allStudios.find(studio =>
                    studio.id === studioId ||
                    studio._id === studioId ||
                    studio.studio_id === studioId
                );

                if (studioData) {
                // Add to our studios array
                if (!studiosData) studiosData = [];
                studiosData.push(studioData);

                return studioData;
                }

                console.warn(`Studio with ID ${studioId} not found in fallback`);
                return null;
            } catch (error) {
                console.error(`Error loading studio ${studioId}:`, error);
                return null;
            }
        }
        
        // Load multiple studios data for workshops
        async function loadStudiosDataForWorkshops() {
            try {
                if (!workshopsData || workshopsData.length === 0) {
                    return;
                }
                
                // Get unique studio IDs from workshops
                const studioIds = [...new Set(workshopsData
                    .map(workshop => workshop.studioId || workshop.studio_id)
                    .filter(Boolean))];
                
                if (studioIds.length === 0) {
                    console.warn('No studio IDs found in workshops data');
                    return;
                }
                
                // Load all required studios in parallel
                console.log('Loading studios in parallel:', studioIds);
                const studioPromises = studioIds.map(studioId => loadStudioData(studioId));
                await Promise.all(studioPromises);
                console.log('All studio data loaded, studiosData:', studiosData.length, 'items');
                
            } catch (error) {
                console.error('Error loading studios data for workshops:', error);
                if (!studiosData) studiosData = [];
            }
        }
        
        function getStudioName(studioId) {
            if (!studiosData || !studioId) {
                return 'Loading...';
            }

            // Try multiple possible ID field names
            const studio = studiosData.find(s =>
                s.id === studioId ||
                s._id === studioId ||
                s.studio_id === studioId
            );

            return studio ? toTitleCase(studio.name) : 'Unknown Studio';
        }
        
        function getStudioData(studioId) {
            if (!studiosData || !studioId) return null;
            // Try multiple possible ID field names
            return studiosData.find(s =>
                s.id === studioId ||
                s._id === studioId ||
                s.studio_id === studioId
            );
        }
        
        // Create studio avatar component
        function createStudioAvatar(studioId, studioName) {
            if (!studioId) return '';
            
            const studioData = getStudioData(studioId);
            const displayName = studioName || getStudioName(studioId);
            const initials = getInitials(displayName);
            
            return `
                <div class="studio-avatar-container" onclick="navigateToStudio('${studioId}')">
                    <img id="studio-avatar-${studioId}" class="studio-avatar" src="" alt="${displayName}" style="display: none;">
                    <div id="studio-avatar-fallback-${studioId}" class="studio-avatar-fallback">
                        ${initials}
                    </div>
                </div>
            `;
        }
        
        // Load studio avatar using centralized loader
        function loadStudioAvatar(studioId) {
            if (!studioId) {
                console.warn('loadStudioAvatar called with empty studioId');
                return;
            }

            console.log('Loading studio avatar for:', studioId);

            // Wait for DOM elements to be available
            let retryCount = 0;
            const maxRetries = 10; // Give up after 10 retries (500ms)

            const checkAndLoad = () => {
                const avatarImg = document.getElementById(`studio-avatar-${studioId}`);
                const avatarFallback = document.getElementById(`studio-avatar-fallback-${studioId}`);

                if (!avatarImg || !avatarFallback) {
                    retryCount++;
                    if (retryCount >= maxRetries) {
                        console.error(`Avatar elements not found for studio: ${studioId} after ${maxRetries} retries - giving up`);
                        return;
                    }
                    console.warn(`Avatar elements not found for studio: ${studioId}, retrying (${retryCount}/${maxRetries})...`, {img: !!avatarImg, fallback: !!avatarFallback});
                    // Try again in a bit if elements aren't ready
                    setTimeout(checkAndLoad, 50);
                    return;
                }

                console.log('Found avatar elements for studio:', studioId, 'proceeding with loadImage');
                
                console.log('Calling loadImage for studio:', studioId, 'with altText:', getStudioName(studioId));
                loadImage({
                    element: avatarImg,
                    type: 'studio',
                    entityId: studioId,
                    altText: getStudioName(studioId),
                    onSuccess: function(img) {
                        console.log('Studio avatar loaded successfully for:', studioId);
                        img.style.display = 'block';
                        avatarFallback.style.display = 'none';
                    },
                    onError: function(img) {
                        console.log('Studio avatar failed to load for:', studioId, '- showing fallback');
                        img.style.display = 'none';
                        avatarFallback.style.display = 'flex';
                    },
                    fallbackElement: avatarFallback
                });
            };
            
            checkAndLoad();
        }
        
        // Navigate to studio page
        function navigateToStudio(studioId) {
            if (!studioId) return;
            
            // Track studio click
            if (typeof gtag !== 'undefined') {
                gtag('event', 'studio_avatar_click', {
                    studio_id: studioId,
                    source_page: 'artist_detail',
                    artist_id: artistId,
                    artist_name: artistData?.name
                });
            }
            
            window.location.href = `/web/${studioId}`;
        }
        
        // Create workshop card
        function createWorkshopCard(workshop) {
            
            const card = document.createElement('div');
            card.className = 'workshop-card';

            // Store workshop data in card dataset for later use
            const workshopUuid = workshop.uuid;
            card.dataset.uuid = workshopUuid || '';
            card.dataset.song = workshop.song || workshop.songName || workshop.song_name || '';
            card.dataset.artist = workshop.by || workshop.artist || '';
            card.dataset.date = workshop.date;
            card.dataset.studioId = workshop.studioId || workshop.studio_id || '';
            
            // Check multiple possible field name variations
            const songName = workshop.song || workshop.songName || workshop.song_name || 'Dance Workshop';
            const studioId = workshop.studioId || workshop.studio_id;
            const studioName = getStudioName(studioId);
            const pricing = workshop.pricingInfo || workshop.pricing_info || workshop.price || workshop.pricing || 'Contact for pricing';
            const eventType = workshop.eventType || workshop.event_type || workshop.type || 'workshop';
            const paymentLink = workshop.paymentLink || workshop.payment_link || '';
            const paymentLinkType = workshop.paymentLinkType || workshop.payment_link_type || '';
            const choreoLink = workshop.choreoInstaLink || workshop.choreo_insta_link || '';
            const date = workshop.date;
            const time = workshop.time || workshop.workshop_time || '';
            // Format the date before using it in template
            const formattedDate = workshop.date;
            console.log('Formatted date result:', workshop.date);
            card.innerHTML = `
                <!-- Header Row: Date + Choreo Button + Time Badge -->
                <div class="workshop-header-row">
                    <div class="workshop-date-main">${formattedDate}</div>
                    <div class="header-actions">
                        ${choreoLink && choreoLink.trim() ? `
                            <button class="choreo-button-header" onclick="trackChoreoClick('${choreoLink}', ${JSON.stringify(workshop).replace(/"/g, '&quot;')})">
                                <svg viewBox="0 0 24 24">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                            </button>
                        ` : ''}
                        <div class="time-badge">${formatTime(time)}</div>
                    </div>
                </div>
                
                <!-- Main Content Row: Studio Avatar + Workshop Details + Register Button -->
                <div class="workshop-main-row">
                    <!-- Studio Avatar Column -->
                    ${studioId ? `
                        <div class="workshop-studio-column">
                            ${createStudioAvatar(studioId, studioName)}
                        </div>
                    ` : ''}
                    
                    <div class="workshop-info-column">
                        <!-- Song Name -->
                        ${songName && songName !== 'Dance Workshop' ? `
                            <div class="workshop-song-title">${toTitleCase(songName)}</div>
                        ` : ''}
                        
                        <!-- Studio Information with Enhanced Visibility -->
                        ${studioId ? `
                            <div class="workshop-detail-row studio-info-enhanced">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                                </svg>
                                <span class="workshop-detail-text workshop-studio-name" onclick="navigateToStudio('${studioId}')">${studioName}</span>
                            </div>
                        ` : ''}
                        
                        <!-- Pricing Information -->
                        ${pricing && pricing !== 'Contact for pricing' ? `
                            <div class="workshop-detail-row">
                                <svg viewBox="0 0 24 24">
                                    <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                                </svg>
                                <span class="workshop-pricing-text">${pricing}</span>
                            </div>
                        ` : ''}
                        
                        <!-- Event Type -->
                        ${eventType && eventType !== 'workshop' ? `
                            <div class="workshop-detail-row">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                <span class="workshop-detail-text">${toTitleCase(eventType)}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="workshop-register-column">
                        ${paymentLink && paymentLink.trim() ? `
                            <a href="#"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="register-button-main ${paymentLinkType?.toLowerCase() === 'nachna' ? 'nachna' : paymentLinkType?.toLowerCase() === 'whatsapp' ? 'whatsapp' : paymentLinkType?.toLowerCase() === 'url' ? 'url' : 'external'}"
                               onclick="handleRegistrationClick('${paymentLink.replace(/'/g, "\\'")}', '${paymentLinkType?.toLowerCase() || 'external'}', ${JSON.stringify(workshop).replace(/"/g, '&quot;')})">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2-7h-3V2h-2v2H8V2H6v2H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H3V8h14v12z"/>
                                </svg>
                                ${paymentLinkType?.toLowerCase() === 'nachna' ? 'Register with Nachna' : paymentLinkType?.toLowerCase() === 'whatsapp' ? 'Register via WhatsApp' : paymentLinkType?.toLowerCase() === 'url' ? 'Register' : 'Book Now'}
                            </a>
                        ` : `
                            <button class="register-button-main disabled" disabled>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                Coming Soon
                            </button>
                        `}
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Display workshops
        function displayWorkshops() {
            if (!workshopsData || workshopsData.length === 0) {
                showEmpty();
                return;
            }
            
            hideLoading();
            errorState.style.display = 'none';
            emptyState.style.display = 'none';
            workshopsSection.style.display = 'block';
            
            workshopsContent.innerHTML = '';
            
            const studioIds = new Set();
            
            workshopsData.forEach((workshop, index) => {
                const workshopCard = createWorkshopCard(workshop);
                workshopsContent.appendChild(workshopCard);
                
                // Collect studio IDs for avatar loading
                const studioId = workshop.studioId || workshop.studio_id;
                if (studioId) {
                    studioIds.add(studioId);
                }
            });
            
            // Load studio avatars after cards are created and studios data is available
            console.log('Setting up studio avatar loading for:', studioIds);
            const loadAllStudioAvatars = () => {
                console.log('Checking if studios data is ready, studiosData length:', studiosData?.length || 0);
                if (!studiosData || studiosData.length === 0) {
                    console.log('Studios data not ready yet, waiting...');
                    // Wait for studios data to be loaded
                    setTimeout(loadAllStudioAvatars, 100);
                    return;
                }

                console.log('Studios data ready, loading avatars for:', studioIds.length, 'studios');
                studioIds.forEach((studioId, index) => {
                    // Stagger the loading to avoid overwhelming the DOM
                    setTimeout(() => {
                        console.log(`Loading avatar ${index + 1}/${studioIds.length} for studio:`, studioId);
                        loadStudioAvatar(studioId);
                    }, index * 100); // 100ms delay between each avatar
                });
            };

            // Give the DOM a moment to settle before starting avatar loading
            setTimeout(loadAllStudioAvatars, 300);
        }
        
        // Action button handlers
        function handleLike() {
            isLiked = !isLiked;
            updateLikeButton();
            trackLikeClick();
        }
        
        function handleFollow() {
            isFollowing = !isFollowing;
            updateFollowButton();
            trackFollowClick();
        }
        
        function updateLikeButton() {
            if (isLiked) {
                likeButton.classList.add('liked');
                likeIcon.innerHTML = `<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>`;
                likeText.textContent = 'Liked';
            } else {
                likeButton.classList.remove('liked');
                likeIcon.innerHTML = `<path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>`;
                likeText.textContent = 'Like';
            }
        }
        
        function updateFollowButton() {
            if (isFollowing) {
                followButton.classList.add('following');
                followIcon.innerHTML = `<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>`;
                followText.textContent = 'Following';
            } else {
                followButton.classList.remove('following');
                followIcon.innerHTML = `<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>`;
                followText.textContent = 'Follow';
            }
        }
        
        // Handle registration click with proper URL handling
        function handleRegistrationClick(paymentLink, linkType, workshop) {
            event.preventDefault(); // Prevent default link behavior

            // Track the workshop click
            trackWorkshopClick(workshop);

            if (linkType === 'whatsapp') {
                // Handle WhatsApp registration
                handleWhatsAppRegistration(workshop);
            } else if (linkType === 'nachna') {
                // Handle Nachna payment link creation
                handleNachnaRegistration(workshop, event.target);
            } else if (linkType === 'url') {
                // Handle direct URL links - ensure proper URL format
                let url = paymentLink;
                // If URL doesn't start with http:// or https://, add https://
                if (!url.match(/^https?:\/\//)) {
                    url = 'https://' + url;
                }
                window.open(url, '_blank', 'noopener,noreferrer');
            } else {
                // Handle external registration links
                window.open(paymentLink, '_blank', 'noopener,noreferrer');
            }
        }

        // WhatsApp registration handler
        function handleWhatsAppRegistration(workshop) {
            try {
                // Check if payment_link contains a phone number (WhatsApp link format)
                let whatsappUrl = '';
                let whatsappBizUrl = '';
                let webFallback = '';

                if (workshop.payment_link && workshop.payment_link.includes('wa.me')) {
                    // If it's already a wa.me link, extract phone number and add message
                    const phoneMatch = workshop.payment_link.match(/wa\.me\/(\d+)/);
                    if (phoneMatch) {
                        const phoneNumber = phoneMatch[1];
                        const workshopDetails = buildWhatsAppMessage(workshop);
                        const encodedMessage = encodeURIComponent(workshopDetails);

                        whatsappBizUrl = `whatsapp-business://send?text=${encodedMessage}`;
                        whatsappUrl = `whatsapp://send?text=${encodedMessage}`;
                        webFallback = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                    }
                } else {
                    // For phone number format, clean and format it
                    const phoneNumber = workshop.payment_link ? workshop.payment_link.replace(/\D/g, '') : '';
                    if (phoneNumber && phoneNumber.length >= 10) {
                        // Add Indian country code if not present
                        const fullPhoneNumber = phoneNumber.length === 10 ? `91${phoneNumber}` : phoneNumber;
                        const workshopDetails = buildWhatsAppMessage(workshop);
                        const encodedMessage = encodeURIComponent(workshopDetails);

                        whatsappBizUrl = `whatsapp-business://send?text=${encodedMessage}`;
                        whatsappUrl = `whatsapp://send?text=${encodedMessage}`;
                        webFallback = `https://wa.me/${fullPhoneNumber}?text=${encodedMessage}`;
                    }
                }

                if (webFallback) {
                    // If we have a specific phone number, use wa.me with phone number
                    console.log('Using WhatsApp Web with phone number:', webFallback);
                    window.open(webFallback, '_blank', 'noopener,noreferrer');
                } else if (whatsappBizUrl) {
                    // Try WhatsApp Business first (general message, user chooses recipient)
                    console.log('Trying WhatsApp Business:', whatsappBizUrl);
                    const whatsappWindow = window.open(whatsappBizUrl, '_blank', 'noopener,noreferrer');

                    // Check if WhatsApp Business opened, fallback to regular WhatsApp
                    setTimeout(() => {
                        if (!whatsappWindow || whatsappWindow.closed) {
                            console.log('WhatsApp Business not available, trying regular WhatsApp');
                            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                        }
                    }, 1000);
                } else {
                    // Fallback to original payment link
                    console.log('Using original payment link:', workshop.payment_link);
                    window.open(workshop.payment_link, '_blank', 'noopener,noreferrer');
                }

            } catch (error) {
                console.error('Error opening WhatsApp:', error);
                // Fallback to regular link
                window.open(workshop.payment_link, '_blank', 'noopener,noreferrer');
            }
        }

        // Build WhatsApp message with workshop details
        function buildWhatsAppMessage(workshop) {
            if (!workshop) {
                return "Hi! I'm interested in registering for your dance workshop. Could you please share the registration details?";
            }

            let message = "Hi! I'm interested in registering for the following dance workshop:\n\n";

            // Add workshop details with proper formatting
            if (workshop.song && workshop.song.trim() && workshop.song !== 'TBA') {
                message += ` Song: ${toTitleCase(workshop.song)}\n`;
            }

            if (workshop.by && workshop.by.trim() && workshop.by !== 'TBA') {
                message += ` Artist: ${toTitleCase(workshop.by)}\n`;
            }

            // For artist page, we don't have studio info, so we'll use artist name
            if (artistData && artistData.name) {
                message += ` Artist: ${toTitleCase(artistData.name)}\n`;
            }

            if (workshop.date) {
                message += ` Date: ${formatDate(workshop.date)}\n`;
            }

            if (workshop.time) {
                message += ` Time: ${formatTime(workshop.time)}\n`;
            }

            message += "\nCould you please help me with the registration process? Thank you! ";

            return message;
        }

        // Global variables for current workshop
        let currentWorkshopUuid = null;
        let currentWorkshop = null;

        // Handle Nachna payment link creation
        async function handleNachnaRegistration(workshop, button) {
            try {
                // Check if user is logged in using auth_components.js
                // Add a small delay to ensure auth state is loaded
                await new Promise(resolve => setTimeout(resolve, 100));

                console.log('Checking auth state:', {
                    authToken: window.authToken ? 'present' : 'null',
                    currentUser: window.currentUser ? window.currentUser.name || window.currentUser.mobile_number : 'null'
                });

                if (!window.authToken || !window.currentUser) {
                    console.log('User not logged in, showing login modal');
                    alert('Please login to register with nachna.');
                    if (window.showLoginModal) {
                        window.showLoginModal();
                    } else {
                        console.error('showLoginModal function not available');
                    }
                    return;
                }

                // Check if profile is complete for nachna registration
                console.log('Checking profile completeness:', {
                    profile_complete: window.currentUser.profile_complete,
                    name: window.currentUser.name,
                    dateOfBirth: window.currentUser.dateOfBirth,
                    gender: window.currentUser.gender
                });

                if (!window.currentUser.profile_complete) {
                    console.log('Profile incomplete, showing profile completion modal');
                    showProfileCompletionModal();
                    return;
                }

                console.log('User is logged in and profile is complete, proceeding with registration');

                // Show loading state
                const originalText = button.textContent;
                button.textContent = 'Checking bundles...';
                button.disabled = true;
                button.setAttribute('data-original-text', originalText);

                // Store current workshop for later use
                currentWorkshopUuid = workshop.uuid;
                currentWorkshop = workshop;

                // Create workshop identifier (must be UUID format)
                const workshopIdentifier = workshop.uuid;

                if (!workshopIdentifier) {
                    throw new Error('Workshop UUID is required for bundle checking');
                }

                // First, check if there are available bundles for this workshop
                console.log(`Checking bundles for workshop ${workshopIdentifier}`);

                const bundleResponse = await fetch(`/api/orders/bundles/check/${workshopIdentifier}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${window.authToken}`,
                        'Content-Type': 'application/json',
                    }
                });

                if (!bundleResponse.ok) {
                    // If bundle check fails, proceed with individual purchase
                    console.warn('Bundle check failed, proceeding with individual purchase');
                    await proceedIndividualPurchase(workshop, button);
                    return;
                }

                const bundleData = await bundleResponse.json();

                if (bundleData.bundles_available && bundleData.bundles && bundleData.bundles.length > 0) {
                    // Show bundle selection modal
                    console.log(`Found ${bundleData.bundles.length} bundle(s) containing workshop ${workshopIdentifier}:`, bundleData.bundles);
                    showBundleSelectionModal(workshop, bundleData.bundles, button);
                } else {
                    // No bundles available for this workshop, proceed with individual purchase
                    console.log(`No bundles found containing workshop ${workshopIdentifier}, proceeding with individual purchase`);
                    await proceedIndividualPurchase(workshop, button);
                }

            } catch (error) {
                console.error('Error in Nachna registration flow:', error);

                // Show error message
                const errorMessage = error.message || 'Failed to process registration. Please try again.';
                showError(errorMessage);

                // Fallback to direct link if available
                if (workshop.payment_link) {
                    console.log('Using fallback payment link:', workshop.payment_link);
                    setTimeout(() => {
                        try {
                            window.open(workshop.payment_link, '_blank', 'noopener,noreferrer');
                        } catch (fallbackError) {
                            console.error('Fallback link also failed:', fallbackError);
                        }
                    }, 2000);
                }
            } finally {
                // Reset button state if not already reset
                if (button.disabled) {
                    button.textContent = button.getAttribute('data-original-text') || 'Register with nachna';
                    button.disabled = false;
                }
            }
        }

        async function proceedIndividualPurchase(workshop, button) {
            try {
                // Update button text
                button.textContent = 'Creating payment link...';

                // Create workshop identifier (must be UUID format)
                const workshopIdentifier = workshop.uuid;

                if (!workshopIdentifier) {
                    throw new Error('Workshop UUID is required for payment link creation');
                }

                // Create individual payment link via API
                const response = await fetch('/api/orders/create-payment-link', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${window.authToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        workshop_uuid: workshopIdentifier,
                        points_redeemed: 0.0,
                        discount_amount: 0.0
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create payment link');
                }

                const result = await response.json();
                console.log('Individual payment link API response:', result);

                if (result.payment_link_url) {
                    // Try to open payment link in new tab
                    const paymentWindow = window.open(result.payment_link_url, '_blank', 'noopener,noreferrer');

                    // Check if popup was blocked (after a short delay to allow window to open)
                    setTimeout(() => {
                        if (!paymentWindow || paymentWindow.closed || typeof paymentWindow.closed === 'undefined') {
                            // Popup was blocked - show helpful message
                            showPaymentLinkModal(result.payment_link_url, result.order_id);
                        } else {
                            // Popup opened successfully - send analytics
                            if (typeof gtag !== 'undefined') {
                                gtag('event', 'nachna_payment_created', {
                                    workshop_id: workshopIdentifier,
                                    workshop_identifier: workshopIdentifier,
                                    song_name: workshop.song,
                                    artist_id: artistId,
                                    artist_name: artistData?.name,
                                    purchase_type: 'individual',
                                    user_id: window.currentUser?.user_id,
                                    user_name: window.currentUser?.name
                                });
                            }
                        }
                    }, 100);

                } else {
                    console.error('No payment_link_url in response:', result);
                    throw new Error(result.error || result.message || 'Payment link URL not found in response');
                }

            } catch (error) {
                console.error('Error creating individual payment link:', error);
                throw error; // Re-throw to be handled by caller
            }
        }

        // Show bundle selection modal
        function showBundleSelectionModal(workshop, bundles, button) {
            // Reset button state
            button.textContent = button.getAttribute('data-original-text') || 'Register with nachna';
            button.disabled = false;

            // Create or update bundle selection modal
            let modal = document.getElementById('bundle-selection-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'bundle-selection-modal';
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-content bundle-modal">
                        <div class="modal-header">
                            <h2> Choose Your Option</h2>
                            <button class="modal-close" onclick="closeBundleSelectionModal()"></button>
                        </div>
                        <div class="modal-body">
                            <div class="current-workshop-info">
                                <h3>Selected Workshop</h3>
                                <div class="workshop-summary">
                                    <div class="workshop-title" id="current-workshop-title"></div>
                                    <div class="workshop-details" id="current-workshop-details"></div>
                                </div>
                            </div>

                            <div class="bundle-options" id="bundle-options"></div>

                            <div class="individual-option">
                                <div class="option-card individual-card">
                                    <div class="option-header">
                                        <h4>Individual Workshop</h4>
                                        <div class="price-tag" id="individual-price">799</div>
                                    </div>
                                    <div class="option-description">
                                        Purchase only the selected workshop above
                                    </div>
                                    <button class="option-button secondary" onclick="selectIndividualPurchase()">
                                        Continue Individual Purchase
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // Populate current workshop info
            document.getElementById('current-workshop-title').textContent =
                workshop.song || workshop.title || 'Workshop';
            document.getElementById('current-workshop-details').textContent =
                `${workshop.by || workshop.instructor || 'Instructor'}  ${workshop.date || ''} ${workshop.time || ''}`;

            // Populate bundle options
            const bundleOptions = document.getElementById('bundle-options');
            bundleOptions.innerHTML = '';

            bundles.forEach((bundle, index) => {
                const bundleCard = document.createElement('div');
                bundleCard.className = 'option-card bundle-card';
                bundleCard.innerHTML = `
                    <div class="option-header">
                        <h4>${bundle.name}</h4>
                        <div class="bundle-badge">Bundle Deal</div>
                    </div>
                    <div class="bundle-description">${bundle.description}</div>
                    <div class="pricing-comparison">
                        <div class="price-row">
                            <span class="price-label">Individual Total:</span>
                            <span class="price-value strikethrough">${bundle.individual_total_price}</span>
                        </div>
                        <div class="price-row bundle-price">
                            <span class="price-label">Bundle Price:</span>
                            <span class="price-value highlight">${bundle.bundle_price}</span>
                        </div>
                        <div class="savings-badge">
                            Save ${bundle.savings_amount} (${bundle.savings_percentage}%)
                        </div>
                    </div>
                    <div class="workshop-count">${bundle.workshop_count} workshops included</div>
                    <button class="option-button primary" onclick="selectBundlePurchase('${bundle.bundle_id}')">
                        Get Bundle & Save ${bundle.savings_amount}
                    </button>
                `;
                bundleOptions.appendChild(bundleCard);
            });

            // Set individual price
            const individualPrice = bundles[0]?.individual_total_price / bundles[0]?.workshop_count || 799;
            document.getElementById('individual-price').textContent = `${individualPrice}`;

            modal.style.display = 'flex';
        }

        function closeBundleSelectionModal() {
            const modal = document.getElementById('bundle-selection-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function selectBundlePurchase(bundleId) {
            if (!bundleId) {
                alert('Bundle ID is required');
                return;
            }

            // Show loading state
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span></span> Processing...';
            button.disabled = true;

            // Close modal
            closeBundleSelectionModal();

            // Create bundle payment link (now creates single order with multiple workshops)
            fetch(`/api/orders/bundles/${bundleId}/create-payment-link`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${window.authToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})  // Empty body for now
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.payment_link_url) {
                    // Success - redirect to payment
                    console.log('Single bundle order payment link created:', data.payment_link_url);

                    // Try to open payment link in new tab
                    const paymentWindow = window.open(data.payment_link_url, '_blank', 'noopener,noreferrer');

                    // Check if popup was blocked
                    setTimeout(() => {
                        if (!paymentWindow || paymentWindow.closed || typeof paymentWindow.closed === 'undefined') {
                            // Popup was blocked - show helpful message
                            showPaymentLinkModal(data.payment_link_url, data.order_id);
                        } else {
                            // Send analytics
                            if (typeof gtag !== 'undefined') {
                                gtag('event', 'bundle_purchase_started', {
                                    bundle_id: bundleId,
                                    purchase_type: 'single_bundle_order',
                                    artist_id: artistId,
                                    artist_name: artistData?.name,
                                    order_id: data.order_id,
                                    workshop_uuid: workshopIdentifier,
                                    user_id: window.currentUser?.user_id,
                                    user_name: window.currentUser?.name
                                });
                            }
                        }
                    }, 100);
                } else {
                    alert('Failed to create bundle payment link: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Bundle purchase failed:', error);
                alert('Bundle purchase failed. Please try again.');
            });
        }

        async function selectIndividualPurchase() {
            // Close modal
            closeBundleSelectionModal();

            // Find the original button that triggered the flow
            const workshopCards = document.querySelectorAll('.workshop-card');
            let originalButton = null;

            for (const card of workshopCards) {
                const workshopData = card.dataset;
                const cardUuid = workshopData.uuid;
                if (cardUuid === currentWorkshopUuid) {
                    originalButton = card.querySelector('.register-button-main.nachna');
                    break;
                }
            }

            if (originalButton) {
                // Use the original button for the individual purchase flow
                await proceedIndividualPurchase(currentWorkshop, originalButton);
            } else {
                // Fallback - create a temporary button for the flow
                const tempButton = document.createElement('button');
                tempButton.textContent = 'Creating payment link...';
                tempButton.disabled = true;
                await proceedIndividualPurchase(currentWorkshop, tempButton);
            }
        }

        // Show payment link modal when popups are blocked
        function showPaymentLinkModal(paymentUrl, orderId) {
            // Create modal overlay
            const modal = document.createElement('div');
            modal.className = 'payment-link-modal-overlay';
            modal.innerHTML = `
                <div class="payment-link-modal">
                    <div class="modal-header">
                        <h3>Payment Link Ready</h3>
                        <button class="modal-close" onclick="this.closest('.payment-link-modal-overlay').remove()"></button>
                    </div>
                    <div class="modal-body">
                        <p>Your payment link has been created successfully!</p>
                        <div class="payment-actions">
                            <button class="action-btn primary" onclick="openPaymentLink('${paymentUrl}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                    <polyline points="15,3 21,3 21,9"/>
                                    <line x1="10" y1="14" x2="21" y2="3"/>
                                </svg>
                                Open Payment Link
                            </button>
                            <button class="action-btn secondary" onclick="copyPaymentLink('${paymentUrl}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                                Copy Link
                            </button>
                        </div>
                        <div class="modal-note">
                            <small> Tip: Allow popups for this site to open payment links automatically</small>
                        </div>
                    </div>
                </div>
            `;

            // Add modal styles
            const style = document.createElement('style');
            style.textContent = `
                .payment-link-modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    backdrop-filter: blur(5px);
                }

                .payment-link-modal {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 20px;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    backdrop-filter: blur(15px);
                    padding: 2rem;
                    max-width: 400px;
                    width: calc(100% - 2rem);
                    position: relative;
                }

                .payment-link-modal .modal-header {
                    text-align: center;
                    margin-bottom: 1.5rem;
                }

                .payment-link-modal .modal-header h3 {
                    color: white;
                    font-size: 1.25rem;
                    font-weight: 700;
                    margin-bottom: 0.5rem;
                }

                .payment-link-modal .modal-close {
                    position: absolute;
                    top: 1rem;
                    right: 1rem;
                    background: rgba(255, 255, 255, 0.1);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 50%;
                    width: 32px;
                    height: 32px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    color: rgba(255, 255, 255, 0.7);
                }

                .payment-link-modal .modal-close:hover {
                    background: rgba(255, 255, 255, 0.2);
                }

                .payment-link-modal .modal-body {
                    color: white;
                }

                .payment-link-modal .order-info {
                    background: rgba(255, 255, 255, 0.1);
                    padding: 1rem;
                    border-radius: 8px;
                    margin: 1rem 0;
                    text-align: center;
                }

                .payment-link-modal .payment-actions {
                    display: flex;
                    gap: 0.75rem;
                    margin: 1.5rem 0;
                }

                .payment-link-modal .action-btn {
                    flex: 1;
                    padding: 0.75rem 1rem;
                    border-radius: 8px;
                    border: none;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                    font-size: 0.9rem;
                    transition: all 0.3s ease;
                }

                .payment-link-modal .action-btn.primary {
                    background: linear-gradient(135deg, #00D4FF 0%, #9C27B0 100%);
                    color: white;
                }

                .payment-link-modal .action-btn.primary:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
                }

                .payment-link-modal .action-btn.secondary {
                    background: rgba(255, 255, 255, 0.1);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    color: white;
                }

                .payment-link-modal .action-btn.secondary:hover {
                    background: rgba(255, 255, 255, 0.2);
                }

                .payment-link-modal .modal-note {
                    text-align: center;
                    margin-top: 1rem;
                }

                .payment-link-modal .modal-note small {
                    color: rgba(255, 255, 255, 0.6);
                }

                /* QR Modal Styles */
                .qr-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    display: none;
                    align-items: center;
                    justify-content: center;
                    z-index: 11000;
                    backdrop-filter: blur(15px);
                }

                .qr-modal.show {
                    display: flex;
                }

                /* Prevent body scroll when QR modal is open */
                body.modal-open {
                    overflow: hidden;
                    position: fixed;
                    width: 100%;
                }

                .qr-modal-content {
                    background: rgba(10, 10, 15, 0.95);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 20px;
                    width: 90%;
                    max-width: 400px;
                    max-height: 90vh;
                    overflow-y: auto;
                    position: relative;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                }

                .qr-modal-close {
                    position: absolute;
                    top: 1rem;
                    right: 1rem;
                    background: rgba(255, 255, 255, 0.1);
                    border: none;
                    color: white;
                    font-size: 1.5rem;
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 11001;
                    transition: all 0.3s ease;
                }

                .qr-modal-close:hover {
                    background: rgba(255, 255, 255, 0.2);
                    transform: scale(1.1);
                }

                .qr-modal-header {
                    padding: 2rem 1.5rem 1rem;
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    text-align: center;
                }

                .qr-modal-title {
                    color: white;
                    font-size: 1.25rem;
                    font-weight: 700;
                    margin: 0 0 1rem 0;
                    letter-spacing: 1.2;
                }

                .qr-workshop-info {
                    background: rgba(255, 255, 255, 0.08);
                    border-radius: 12px;
                    padding: 1rem;
                }

                .qr-workshop-title {
                    color: white;
                    font-size: 1rem;
                    font-weight: 600;
                    margin-bottom: 0.5rem;
                }

                .qr-workshop-details {
                    color: rgba(255, 255, 255, 0.7);
                    font-size: 0.875rem;
                }

                .qr-modal-body {
                    padding: 1.5rem;
                }

                .qr-loading, .qr-error {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 3rem 1rem;
                    color: rgba(255, 255, 255, 0.7);
                }

                .qr-loading .loading-spinner {
                    width: 32px;
                    height: 32px;
                    border: 3px solid rgba(255, 255, 255, 0.1);
                    border-radius: 50%;
                    border-top-color: #00D4FF;
                    animation: spin 1s linear infinite;
                    margin-bottom: 1rem;
                }

                .qr-code-container {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 1.5rem;
                }

                .qr-code-display {
                    background: rgba(255, 255, 255, 0.08);
                    border: 1px solid rgba(255, 255, 255, 0.15);
                    padding: 1rem;
                    border-radius: 12px;
                    display: inline-block;
                }

                .qr-code-display canvas {
                    display: block;
                    border-radius: 8px;
                }

                .qr-actions {
                    display: flex;
                    gap: 1rem;
                    width: 100%;
                    justify-content: center;
                }

                .qr-action-btn {
                    background: var(--primary-gradient);
                    border: none;
                    color: white;
                    padding: 0.75rem 1.25rem;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 0.875rem;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.3s ease;
                }

                .qr-action-btn:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
                }

                .qr-action-btn svg {
                    width: 16px;
                    height: 16px;
                    stroke: white;
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(modal);
        }

        function openPaymentLink(url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        function copyPaymentLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Payment link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Payment link copied to clipboard!');
            });
        }

        // Error handling
        function showError(message) {
            console.error('Error:', message);
            alert(message || 'An error occurred. Please try again.');
        }



        // Analytics tracking
        function trackWorkshopClick(workshop) {
            const workshopIdentifier = workshop.uuid || workshop._id || workshop.id;

            if (typeof gtag !== 'undefined') {
                gtag('event', 'workshop_book_click', {
                    workshop_id: workshopIdentifier,
                    song_name: workshop.song,
                    artist_id: artistId,
                    artist_name: artistData?.name
                });
            }
        }
        
        function trackChoreoClick(choreoUrl, workshop) {
            const workshopIdentifier = workshop.uuid || workshop._id || workshop.id;
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'choreo_video_click', {
                    choreo_url: choreoUrl,
                    workshop_id: workshopIdentifier,
                    artist_id: artistId,
                    artist_name: artistData?.name
                });
            }
            
            window.open(choreoUrl, '_blank', 'noopener,noreferrer');
        }
        
        function trackLikeClick() {
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'artist_like', {
                    artist_id: artistId,
                    artist_name: artistData?.name,
                    action: isLiked ? 'like' : 'unlike'
                });
            }
        }
        
        function trackFollowClick() {
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'artist_follow', {
                    artist_id: artistId,
                    artist_name: artistData?.name,
                    action: isFollowing ? 'follow' : 'unfollow'
                });
            }
        }
        
        // Share functionality
        function openShareModal() {
            if (!artistData) return;
            
            // Use the auth_components.js function to open share modal
            if (window.openShareModal) {
                window.openShareModal();
            }
        }
        
        function closeShareModal() {
            // Use the auth_components.js function to close share modal
            if (window.closeShareModal) {
                window.closeShareModal();
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Link copied to clipboard!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Link copied to clipboard!');
            });
        }
        
        // Main load function - optimized to load only required data
        async function loadData() {
            showLoading();
            errorState.style.display = 'none';

            // Validate artistId
            if (!artistId) {
                console.error('No artistId found in template or URL');
                showError('Artist ID not found. Please check the URL and try again.');
                return;
            }


            try {
                // Load artist and workshop data first in parallel
                const results = await Promise.allSettled([
                    loadArtistData(),
                    loadWorkshopsData()
                ]);
                
                // Check if artist data loaded successfully
                if (results[0].status === 'rejected') {
                    throw new Error('Failed to load artist data: ' + results[0].reason);
                }

                // Workshop data failure is less critical
                if (results[1].status === 'rejected') {
                    console.warn('Workshop load failed - continuing with artist info only:', results[1].reason);
                }

                // Load studios data for the workshops (only if workshops loaded successfully)
                if (results[1].status === 'fulfilled') {
                    await loadStudiosDataForWorkshops();
                    // Now that studio data is loaded, display workshops
                displayWorkshops();
                }

                console.log('All data loaded successfully');
                hideLoading();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError(error.message || 'Failed to load artist data. Please try again.');
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            // Setup modal event listeners after auth components are loaded
            setTimeout(setupModalEventListeners, 100);
            // Ensure auth state is synchronized
            setTimeout(syncAuthState, 200);
        });

        // Function to synchronize authentication state
        function syncAuthState() {
            if (window.debugAuthStatus) {
                console.log('Syncing auth state from artist page');
                window.debugAuthStatus();
            }

            // Force update of window auth state from auth_components
            if (typeof window.authToken === 'undefined' || window.authToken === null) {
                // Try to get auth state from localStorage directly as fallback
                const baseUrl = window.location.origin;
                const cleanBaseUrl = baseUrl.replace(/https?:\/\//, '').replace(/[^a-zA-Z0-9]/g, '_');
                const authTokenKey = `authToken_${cleanBaseUrl}`;
                const currentUserKey = `currentUser_${cleanBaseUrl}`;

                const savedToken = localStorage.getItem(authTokenKey);
                const savedUser = localStorage.getItem(currentUserKey);

                if (savedToken && savedUser) {
                    try {
                        window.authToken = savedToken;
                        window.currentUser = JSON.parse(savedUser);
                        console.log('Auth state synchronized from localStorage');
                    } catch (error) {
                        console.error('Error syncing auth state:', error);
                    }
                }
            }
        }
        
        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                const now = new Date().getTime();
                const lastLoad = parseInt(localStorage.getItem('lastArtistLoad') || '0');
                if (now - lastLoad > 5 * 60 * 1000) {
                    loadData();
                    localStorage.setItem('lastArtistLoad', now.toString());
                }
            }
        });
        
        // Set initial load timestamp
        localStorage.setItem('lastArtistLoad', new Date().getTime().toString());
        
        // Edit Profile Modal Functions
        function openEditProfileModal() {
            if (!window.currentUser) {
                alert('Please login to edit your profile.');
                if (window.showLoginModal) {
                    window.showLoginModal();
                }
                return;
            }

            closeProfileModal();

            // Populate form with current user data
            populateEditProfileForm();

            // Show modal
            const modal = document.getElementById('edit-profile-modal');
            modal.classList.add('show');
        }

        function closeEditProfileModal() {
            const modal = document.getElementById('edit-profile-modal');
            modal.classList.remove('show');

            // Reset form
            const saveBtn = document.querySelector('.edit-save-btn');
            const saveText = saveBtn.querySelector('.save-text');
            const saveLoader = saveBtn.querySelector('.save-loader');

            saveBtn.disabled = false;
            saveText.style.display = 'inline';
            saveLoader.style.display = 'none';
        }

        function populateEditProfileForm() {
            const user = window.currentUser;
            if (!user) return;

            // Set name
            const nameInput = document.getElementById('edit-profile-name');
            nameInput.value = user.name || '';

            // Set date of birth
            const dobInput = document.getElementById('edit-profile-dob');
            if (user.dateOfBirth) {
                // Convert date format if needed
                let dateStr = user.dateOfBirth;
                if (dateStr.includes('T')) {
                    dateStr = dateStr.split('T')[0];
                }
                dobInput.value = dateStr;
            } else {
                dobInput.value = '';
            }

            // Set gender
            const genderInputs = document.querySelectorAll('input[name="edit-gender"]');
            genderInputs.forEach(input => {
                input.checked = input.value === user.gender;
            });

            // Load profile picture
            loadEditProfilePicture();
        }

        function loadEditProfilePicture() {
            const avatarContainer = document.getElementById('edit-profile-avatar');

            if (window.currentUser?.user_id) {
                // Try to load profile picture using the API
                loadImage({
                    element: avatarContainer,
                    type: 'user',
                    entityId: window.currentUser.user_id,
                    altText: window.currentUser.name || 'Profile',
                    containerClass: 'profile-avatar-large',
                    fallbackClass: 'profile-fallback-large',
                    onSuccess: function(container) {
                        container.className = 'profile-avatar-large';
                        const img = container.querySelector('img');
                        if (img) img.className = 'profile-avatar-large';

                        // Show remove button if there's an image
                        document.getElementById('remove-avatar-btn').style.display = 'inline-flex';
                    },
                    onError: function(container) {
                        // Show fallback avatar
                        container.innerHTML = '';
                        const fallback = document.createElement('div');
                        fallback.className = 'profile-fallback-large';
                        fallback.textContent = getInitials(window.currentUser.name || window.currentUser.mobile_number);
                        container.appendChild(fallback);

                        // Hide remove button
                        document.getElementById('remove-avatar-btn').style.display = 'none';
                    }
                });
            } else {
                // Show fallback avatar
                avatarContainer.innerHTML = '';
                const fallback = document.createElement('div');
                fallback.className = 'profile-fallback-large';
                fallback.textContent = getInitials(window.currentUser?.name || window.currentUser?.mobile_number || '?');
                avatarContainer.appendChild(fallback);

                // Hide remove button
                document.getElementById('remove-avatar-btn').style.display = 'none';
            }
        }

        function editProfilePicture() {
            const fileInput = document.getElementById('profile-picture-input');
            fileInput.click();
        }

        function removeProfilePicture() {
            if (confirm('Are you sure you want to remove your profile picture?')) {
                // Show loading
                const removeBtn = document.getElementById('remove-avatar-btn');
                const originalText = removeBtn.innerHTML;
                removeBtn.innerHTML = '<div class="save-loader"></div>';
                removeBtn.disabled = true;

                // Call remove API
                fetch('/api/auth/profile-picture', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${window.authToken}`,
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update local user data
                        if (window.currentUser) {
                            window.currentUser.profile_picture_url = null;
                        }

                        // Reload profile picture
                        loadEditProfilePicture();

                        // Refresh profile modal
                        if (window.loadProfileData) {
                            window.loadProfileData();
                        }

                        alert('Profile picture removed successfully!');
                    } else {
                        throw new Error(data.message || 'Failed to remove profile picture');
                    }
                })
                .catch(error => {
                    console.error('Error removing profile picture:', error);
                    alert('Failed to remove profile picture: ' + error.message);
                })
                .finally(() => {
                    // Reset button
                    removeBtn.innerHTML = originalText;
                    removeBtn.disabled = false;
                });
            }
        }

        async function saveProfileChanges() {
            const saveBtn = document.querySelector('.edit-save-btn');
            const saveText = saveBtn.querySelector('.save-text');
            const saveLoader = saveBtn.querySelector('.save-loader');

            // Show loading state
            saveBtn.disabled = true;
            saveText.style.display = 'none';
            saveLoader.style.display = 'inline-block';

            try {
                // Get form data
                const name = document.getElementById('edit-profile-name').value.trim();
                const dateOfBirth = document.getElementById('edit-profile-dob').value;
                const genderInput = document.querySelector('input[name="edit-gender"]:checked');
                const gender = genderInput ? genderInput.value : null;

                // Validate required fields
                if (!name) {
                    throw new Error('Please enter your name');
                }

                // Prepare update data
                const updateData = {
                    name: name,
                    ...(dateOfBirth && { dateOfBirth }),
                    ...(gender && { gender })
                };

                // Call update API
                const response = await fetch('/api/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${window.authToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'Failed to update profile');
                }

                // Update local user data
                if (window.currentUser) {
                    window.currentUser.name = name;
                    if (dateOfBirth) window.currentUser.dateOfBirth = dateOfBirth;
                    if (gender) window.currentUser.gender = gender;
                }

                // Refresh profile modal
                if (window.loadProfileData) {
                    window.loadProfileData();
                }

                // Close edit modal
                closeEditProfileModal();

                alert('Profile updated successfully!');

            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Failed to update profile: ' + error.message);
            } finally {
                // Reset loading state
                saveBtn.disabled = false;
                saveText.style.display = 'inline';
                saveLoader.style.display = 'none';
            }
        }

        // Handle file input change for profile picture
        document.getElementById('profile-picture-input').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file');
                return;
            }

            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image file size must be less than 5MB');
                return;
            }

            // Show loading on edit button
            const editBtn = document.querySelector('.avatar-edit-btn');
            const originalText = editBtn.innerHTML;
            editBtn.innerHTML = '<div class="save-loader"></div>';
            editBtn.disabled = true;

            try {
                // Create FormData for file upload
                const formData = new FormData();
                formData.append('profile_picture', file);

                        // Upload image
                        const response = await fetch('/api/auth/profile-picture', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${window.authToken}`,
                    },
                    body: formData
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'Failed to upload profile picture');
                }

                // Update local user data
                if (window.currentUser && result.profile_picture_url) {
                    window.currentUser.profile_picture_url = result.profile_picture_url;
                }

                // Reload profile picture
                loadEditProfilePicture();

                // Refresh profile modal
                if (window.loadProfileData) {
                    window.loadProfileData();
                }

                alert('Profile picture uploaded successfully!');

            } catch (error) {
                console.error('Error uploading profile picture:', error);
                alert('Failed to upload profile picture: ' + error.message);
            } finally {
                // Reset button
                editBtn.innerHTML = originalText;
                editBtn.disabled = false;
                // Clear file input
                e.target.value = '';
            }
        });

        // Profile Completion Modal Functions
        function showProfileCompletionModal() {
            const modal = document.getElementById('profile-completion-modal');
            if (modal) {
                modal.classList.add('show');
            }
        }

        function closeProfileCompletionModal() {
            const modal = document.getElementById('profile-completion-modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Utility function to get initials
        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2);
        }

        // Setup modal event listeners after auth components are loaded
        function setupModalEventListeners() {
            // Close modal when clicking outside
            if (window.shareModal) {
                window.shareModal.addEventListener('click', function(e) {
                    if (e.target === window.shareModal) {
                        window.closeShareModal();
                    }
                });
            }

            // Close orders, rewards, and QR modals when clicking outside
            if (window.ordersModal) {
                window.ordersModal.addEventListener('click', function(e) {
                    if (e.target === window.ordersModal) {
                        window.closeOrdersModal();
                    }
                });
            }

            if (window.rewardsModal) {
                window.rewardsModal.addEventListener('click', function(e) {
                    if (e.target === window.rewardsModal) {
                        window.closeRewardsModal();
                    }
                });
            }

            if (window.qrModal) {
                window.qrModal.addEventListener('click', function(e) {
                    if (e.target === window.qrModal) {
                        window.closeQRModal();
                    }
                });
            }

            // Profile completion modal click outside to close
            const profileCompletionModal = document.getElementById('profile-completion-modal');
            if (profileCompletionModal) {
                profileCompletionModal.addEventListener('click', function(e) {
                    if (e.target === profileCompletionModal) {
                        closeProfileCompletionModal();
                    }
                });
            }
        }

        // Keyboard navigation - Escape key handling is done by auth_components.js
    </script>

    <!-- Login Modal -->
    <div id="login-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-close" onclick="closeLoginModal()"></div>
            <div class="auth-modal-header">
                <h3 class="auth-modal-title">Welcome to Nachna</h3>
                <p class="auth-modal-subtitle">Enter your mobile number to continue</p>
            </div>
            <div class="auth-modal-body">
                <form id="login-form" onsubmit="handleSendOTP(event)">
                    <div class="form-group">
                        <label for="mobile-number" class="form-label">Mobile Number</label>
                        <div class="phone-input-container">
                            <span class="country-code">+91</span>
                            <input
                                type="tel"
                                id="mobile-number"
                                class="form-input"
                                placeholder="Enter your mobile number"
                                maxlength="10"
                                pattern="[0-9]{10}"
                                required
                            >
                        </div>
                    </div>
                    <button type="submit" id="send-otp-btn" class="auth-primary-btn">
                        <span class="btn-text">Send OTP</span>
                        <div class="btn-loader" style="display: none;"></div>
                    </button>
                </form>
                <div id="login-error" class="auth-error" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- OTP Modal -->
    <div id="otp-modal" class="auth-modal">
        <div class="auth-modal-content">
            <div class="auth-modal-close" onclick="closeOTPModal()"></div>
            <div class="auth-modal-header">
                <h3 class="auth-modal-title">Verify Your Number</h3>
                <p class="auth-modal-subtitle">Enter the 6-digit code sent to <span id="otp-mobile-number"></span></p>
            </div>
            <div class="auth-modal-body">
                <form id="otp-form" onsubmit="handleVerifyOTP(event)">
                    <div class="otp-input-container">
                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                    </div>
                    <div class="otp-actions">
                        <button type="button" id="resend-otp-btn" class="auth-secondary-btn" onclick="resendOTP()" disabled>
                            <span class="resend-text">Resend OTP</span>
                            <span class="countdown-text">Resend in 30s</span>
                        </button>
                    </div>
                    <button type="submit" id="verify-otp-btn" class="auth-primary-btn">
                        <span class="btn-text">Verify & Login</span>
                        <div class="btn-loader" style="display: none;"></div>
                    </button>
                </form>
                <div id="otp-error" class="auth-error" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-close" onclick="closeProfileModal()"></div>
            <div class="profile-modal-header">
                <h3 class="profile-modal-title">Profile</h3>
            </div>
            <div class="profile-modal-body">
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="profile-avatar-large">
                        <div id="profile-avatar-container"></div>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-name">Loading...</div>
                        <div class="profile-mobile" id="profile-mobile">Loading...</div>
                        <div class="profile-status" id="profile-status">
                            <span class="status-badge">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Profile Actions -->
                <div class="profile-actions">
                    <button class="profile-action-btn view-orders" onclick="openOrdersModal()">
                        <div class="action-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <div class="action-title">View all Orders</div>
                            <div class="action-subtitle">Manage your bookings</div>
                        </div>
                        <div class="action-arrow">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </div>
                    </button>

                    <button class="profile-action-btn view-rewards" onclick="openRewardsModal()">
                        <div class="action-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <div class="action-title">View Rewards Centre</div>
                            <div class="action-subtitle">Earn points & save</div>
                        </div>
                        <div class="action-arrow">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </div>
                    </button>

                    <button class="profile-action-btn edit-profile" onclick="openEditProfileModal()">
                        <div class="action-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </div>
                        <div class="action-text">
                            <div class="action-title">Edit Profile</div>
                            <div class="action-subtitle">Update your information</div>
                        </div>
                        <div class="action-arrow">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </div>
                    </button>
                </div>

                <!-- Logout Button -->
                <div class="profile-footer">
                    <button class="logout-btn" onclick="logout()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Modal -->
    <div id="orders-modal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-close" onclick="closeOrdersModal()"></div>
            <div class="profile-modal-header">
                <div class="orders-header">
                    <h3 class="profile-modal-title">My Orders</h3>
                    <button class="refresh-btn" onclick="refreshOrders()" id="orders-refresh-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <polyline points="1 20 1 14 7 14"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                        </svg>
                    </button>
                </div>

                <!-- Filter Chips -->
                <div class="filter-chips" id="orders-filter-chips">
                    <button class="filter-chip active" onclick="applyOrderFilter('all')">All Orders</button>
                    <button class="filter-chip" onclick="applyOrderFilter('pending')">Pending</button>
                    <button class="filter-chip" onclick="applyOrderFilter('completed')">Completed</button>
                    <button class="filter-chip" onclick="applyOrderFilter('failed')">Failed</button>
                </div>
            </div>

            <div class="profile-modal-body">
                <div id="orders-loading" class="orders-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading orders...</p>
                </div>
                <div id="orders-error" class="orders-error" style="display: none;">
                    <p>Failed to load orders. <button onclick="refreshOrders()">Try Again</button></p>
                </div>
                <div id="orders-empty" class="orders-empty" style="display: none;">
                    <p>No orders found</p>
                </div>
                <div id="orders-list" class="orders-list"></div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-close" onclick="closeEditProfileModal()"></div>
            <div class="profile-modal-header">
                <h3 class="profile-modal-title">Edit Profile</h3>
            </div>
            <div class="profile-modal-body">
                <!-- Profile Picture Section -->
                <div class="edit-profile-picture-section">
                    <div class="edit-profile-avatar-container">
                        <div id="edit-profile-avatar" class="profile-avatar-large">
                            <div class="profile-fallback-large">?</div>
                        </div>
                        <div class="edit-avatar-buttons">
                            <button type="button" class="avatar-edit-btn" onclick="editProfilePicture()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 1 2 2h14a2 2 0 0 1 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                Change
                            </button>
                            <button type="button" class="avatar-remove-btn" onclick="removeProfilePicture()" id="remove-avatar-btn" style="display: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                Remove
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Profile Form -->
                <div class="edit-profile-form">
                    <div class="form-group">
                        <label for="edit-profile-name" class="form-label">Full Name</label>
                        <input
                            type="text"
                            id="edit-profile-name"
                            class="form-input"
                            placeholder="Enter your full name"
                            maxlength="50"
                        >
                    </div>

                    <div class="form-group">
                        <label for="edit-profile-dob" class="form-label">Date of Birth</label>
                        <input
                            type="date"
                            id="edit-profile-dob"
                            class="form-input"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">Gender</label>
                        <div class="gender-options">
                            <label class="gender-option">
                                <input type="radio" name="edit-gender" value="male">
                                <span class="gender-label">Male</span>
                            </label>
                            <label class="gender-option">
                                <input type="radio" name="edit-gender" value="female">
                                <span class="gender-label">Female</span>
                            </label>
                            <label class="gender-option">
                                <input type="radio" name="edit-gender" value="other">
                                <span class="gender-label">Other</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="edit-profile-actions">
                    <button type="button" class="edit-cancel-btn" onclick="closeEditProfileModal()">
                        Cancel
                    </button>
                    <button type="button" class="edit-save-btn" onclick="saveProfileChanges()">
                        <span class="save-text">Save Changes</span>
                        <div class="save-loader" style="display: none;"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for profile picture -->
    <input type="file" id="profile-picture-input" accept="image/*" style="display: none;">

    <!-- Profile Completion Modal -->
    <div id="profile-completion-modal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-close" onclick="closeProfileCompletionModal()"></div>
            <div class="profile-modal-header">
                <h3 class="profile-modal-title">Complete Your Profile</h3>
            </div>
            <div class="profile-modal-body">
                <div class="profile-completion-message">
                    <div class="completion-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="m9 12 2 2 4-4"/>
                        </svg>
                    </div>
                    <h4>Profile Required for Registration</h4>
                    <p>To register for workshops, please complete your profile information. This helps us provide you with the best experience and ensures smooth registration process.</p>

                    <div class="profile-requirements">
                        <div class="requirement-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="m9 12 2 2 4-4"/>
                            </svg>
                            <span>Full Name</span>
                        </div>
                        <div class="requirement-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="m9 12 2 2 4-4"/>
                            </svg>
                            <span>Date of Birth</span>
                        </div>
                        <div class="requirement-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="m9 12 2 2 4-4"/>
                            </svg>
                            <span>Gender</span>
                        </div>
                    </div>
                </div>

                <div class="profile-completion-actions">
                    <button type="button" class="completion-cancel-btn" onclick="closeProfileCompletionModal()">
                        Cancel
                    </button>
                    <button type="button" class="completion-update-btn" onclick="openEditProfileModal()">
                        <span class="update-text">Update Profile</span>
                        <div class="update-loader" style="display: none;"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rewards Modal -->
    <div id="rewards-modal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-close" onclick="closeRewardsModal()"></div>
            <div class="profile-modal-header">
                <div class="rewards-header">
                    <h3 class="profile-modal-title">Rewards Center</h3>
                    <button class="refresh-btn" onclick="refreshRewards()" id="rewards-refresh-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <polyline points="1 20 1 14 7 14"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="profile-modal-body">
                <div id="rewards-loading" class="rewards-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading rewards...</p>
                </div>
                <div id="rewards-error" class="rewards-error" style="display: none;">
                    <p>Failed to load rewards. <button onclick="refreshRewards()">Try Again</button></p>
                </div>

                <!-- Balance Overview -->
                <div id="rewards-balance" class="rewards-balance" style="display: none;">
                    <div class="balance-card">
                        <div class="balance-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="5" width="20" height="14" rx="2" ry="2"/>
                                <line x1="2" y1="10" x2="22" y2="10"/>
                            </svg>
                        </div>
                        <div class="balance-info">
                            <div class="balance-label">Available Balance</div>
                            <div class="balance-amount" id="available-balance">0</div>
                        </div>
                    </div>

                    <div class="balance-stats">
                        <div class="stat-card">
                            <div class="stat-icon earned">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                    <polyline points="17 6 23 6 23 12"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Earned</div>
                                <div class="stat-value" id="earned-amount">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon redeemed">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="9" cy="12" r="1"/>
                                    <circle cx="15" cy="12" r="1"/>
                                    <path d="M12 2l3 3-3 3-3-3 3-3z"/>
                                    <path d="M12 22l3-3-3-3-3 3 3 3z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Redeemed</div>
                                <div class="stat-value" id="redeemed-amount">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transaction History -->
                <div class="rewards-transactions">
                    <div class="transactions-header">
                        <h4>Transaction History</h4>
                        <div class="transaction-tabs">
                            <button class="transaction-tab active" onclick="switchTransactionTab('all')">All</button>
                            <button class="transaction-tab" onclick="switchTransactionTab('credit')">Earned</button>
                            <button class="transaction-tab" onclick="switchTransactionTab('debit')">Redeemed</button>
                        </div>
                    </div>
                    <div id="transactions-list" class="transactions-list"></div>
                    <div class="load-more-btn" id="load-more-btn" style="display: none;">
                        <button onclick="loadMoreTransactions()">Load More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="qr-modal" class="qr-modal">
        <div class="qr-modal-content">
            <div class="qr-modal-close" onclick="closeQRModal()"></div>
            <div class="qr-modal-header">
                <h3 class="qr-modal-title">Workshop QR Code</h3>
                <div class="qr-workshop-info" id="qr-workshop-info">
                    <div class="qr-workshop-title" id="qr-workshop-title">Loading...</div>
                    <div class="qr-workshop-details" id="qr-workshop-details">Loading...</div>
                </div>
            </div>
            <div class="qr-modal-body">
                <div id="qr-loading" class="qr-loading">
                    <div class="loading-spinner"></div>
                    <p>Generating QR Code...</p>
                </div>
                <div id="qr-error" class="qr-error" style="display: none;">
                    <p>Failed to generate QR code</p>
                </div>
                <div id="qr-code-container" class="qr-code-container" style="display: none;">
                    <div id="qr-code-display" class="qr-code-display"></div>
                    <div class="qr-actions">
                        <button class="qr-action-btn download-btn" onclick="downloadQRCode()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            <span>Download</span>
                        </button>
                        <button class="qr-action-btn share-btn" onclick="shareQRCode()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"/>
                                <circle cx="6" cy="12" r="3"/>
                                <circle cx="18" cy="19" r="3"/>
                                <path d="m8.59 13.51 6.83 3.98"/>
                                <path d="m15.41 6.51-6.82 3.98"/>
                            </svg>
                            <span>Share</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/auth_components.js?v=20240916"></script>
</body>
</html>